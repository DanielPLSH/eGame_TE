<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="zh"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>BaseEntry.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">sourcecode</a> &gt; <a href="index.html" class="el_package">com.mpos.lottery.te.gamespec.sale</a> &gt; <span class="el_source">BaseEntry.java</span></div><h1>BaseEntry.java</h1><pre class="source lang-java linenums">package com.mpos.lottery.te.gamespec.sale;

import com.google.protobuf.Message;

import com.mpos.lottery.te.common.dao.VersionEntity;
import com.mpos.lottery.te.config.exception.MessageFormatException;
import com.mpos.lottery.te.config.exception.SystemException;
import com.mpos.lottery.te.gamespec.sale.support.validator.SelectedNumber;
import com.mpos.lottery.te.port.Context;
import com.mpos.lottery.te.thirdpartyservice.amqp.TeTransactionMessage;
import com.mpos.lottery.te.thirdpartyservice.amqp.TeTransactionMessageSerializer;

import java.math.BigDecimal;

import javax.persistence.Column;
import javax.persistence.MappedSuperclass;
import javax.persistence.Transient;

/**
 * A base ticket definition for all game type.
 * 
 * @author Ramon Li
 */
@SuppressWarnings(&quot;serial&quot;)
@MappedSuperclass
<span class="fc" id="L26">public class BaseEntry extends VersionEntity implements Cloneable, TeTransactionMessageSerializer {</span>
    public static final String DEFAULT_SELECTED_NUMBER = &quot;PLAY&quot;;

    public static final int INPUT_CHANNEL_NOTQP_NOTOMR = 0;
    public static final int INPUT_CHANNEL_QP_NOTOMR = 1;
    public static final int INPUT_CHANNEL_NOTQP_OMR = 2;
    public static final int INPUT_CHANNEL_QP_OMR = 3;

    public static final int BETOPTION_SINGLE = 1; // Single
    public static final int BETOPTION_MULTIPLE = 2; // Multiple
    public static final int BETOPTION_BANKER = 3; // Banker
    public static final int BETOPTION_ROLL = 4; // Roll

    public static final int QUICKPICK_YES = 1;
    public static final int QUICKPICK_NO = 0;

    @Column(name = &quot;TICKET_SERIALNO&quot;)
    private String ticketSerialNo;

    @Column(name = &quot;SELECTED_NUMBER&quot;)
    private String selectNumber;

    @Column(name = &quot;IS_QUIDPICK&quot;)
    private int inputChannel;

    @Column(name = &quot;BET_OPTION&quot;)
    private int betOption;

    @Column(name = &quot;ENTRY_NO&quot;)
    private String entryNo;

<span class="fc" id="L57">    @Column(name = &quot;TOTAL_BETS&quot;)</span>
    private long totalBets = 1;

    @Column(name = &quot;ENTRY_AMOUNT&quot;)
    private BigDecimal entryAmount;

    /**
     * If want the backend to generate QP numbers, the count of QP numbers must be knew.
     */
    @Transient
    private int countOfQPNumber;
    @Transient
    private SelectedNumber parsedSelectedNumber;

    public static BaseEntry defaultEntry() {
<span class="fc" id="L72">        BaseEntry entry = new BaseEntry();</span>
<span class="fc" id="L73">        entry.setBetOption(BETOPTION_SINGLE);</span>
<span class="fc" id="L74">        entry.setInputChannel(INPUT_CHANNEL_NOTQP_NOTOMR);</span>
<span class="fc" id="L75">        entry.setSelectNumber(DEFAULT_SELECTED_NUMBER);</span>
<span class="fc" id="L76">        entry.setTotalBets(1);</span>
<span class="fc" id="L77">        return entry;</span>
    }

    public SelectedNumber parseSelectedNumber() {
<span class="pc bpc" id="L81" title="1 of 4 branches missed.">        if (this.selectNumber != null &amp;&amp; this.parsedSelectedNumber == null) {</span>
<span class="fc" id="L82">            this.parsedSelectedNumber = new SelectedNumber(this);</span>
        }
<span class="fc" id="L84">        return this.parsedSelectedNumber;</span>
    }

    public boolean isQP() {
<span class="pc bpc" id="L88" title="1 of 4 branches missed.">        if (INPUT_CHANNEL_QP_NOTOMR == this.inputChannel || INPUT_CHANNEL_QP_OMR == this.inputChannel) {</span>
<span class="fc" id="L89">            return true;</span>
        }
<span class="fc" id="L91">        return false;</span>
    }

    public SelectedNumber getParsedSelectedNumber() {
<span class="fc" id="L95">        return this.parsedSelectedNumber;</span>
    }

    public String getTicketSerialNo() {
<span class="fc" id="L99">        return ticketSerialNo;</span>
    }

    public void setTicketSerialNo(String ticketSerialNo) {
<span class="fc" id="L103">        this.ticketSerialNo = ticketSerialNo;</span>
<span class="fc" id="L104">    }</span>

    public String getSelectNumber() {
<span class="fc" id="L107">        return selectNumber;</span>
    }

    public void setSelectNumber(String selectNumber) {
<span class="fc" id="L111">        this.selectNumber = selectNumber;</span>
<span class="fc" id="L112">    }</span>

    public int getInputChannel() {
<span class="fc" id="L115">        return inputChannel;</span>
    }

    public void setInputChannel(int inputChannel) {
<span class="fc" id="L119">        this.setInputChannel(inputChannel, true);</span>
<span class="fc" id="L120">    }</span>

    public void setInputChannel(int inputChannel, boolean check) {
<span class="fc bfc" id="L123" title="All 2 branches covered.">        if (check) {</span>
<span class="fc bfc" id="L124" title="All 8 branches covered.">            if (inputChannel == INPUT_CHANNEL_NOTQP_NOTOMR || inputChannel == INPUT_CHANNEL_NOTQP_OMR</span>
                    || inputChannel == INPUT_CHANNEL_QP_NOTOMR || inputChannel == INPUT_CHANNEL_QP_OMR) {
<span class="fc" id="L126">                this.inputChannel = inputChannel;</span>
            } else {
<span class="fc" id="L128">                throw new MessageFormatException(SystemException.CODE_UNSUPPORTED_INPUT_CHANNEL,</span>
                        &quot;unsupported input channel of entry:&quot; + inputChannel);
            }
        } else {
<span class="fc" id="L132">            this.inputChannel = inputChannel;</span>
        }
<span class="fc" id="L134">    }</span>

    public int getBetOption() {
<span class="fc" id="L137">        return betOption;</span>
    }

    public void setBetOption(int betOption) {
<span class="fc" id="L141">        this.betOption = betOption;</span>
<span class="fc" id="L142">    }</span>

    public String getEntryNo() {
<span class="fc" id="L145">        return entryNo;</span>
    }

    public void setEntryNo(String entryNo) {
<span class="fc" id="L149">        this.entryNo = entryNo;</span>
<span class="fc" id="L150">    }</span>

    public long getTotalBets() {
<span class="fc" id="L153">        return totalBets;</span>
    }

    public void setTotalBets(long totalBets) {
<span class="fc" id="L157">        this.totalBets = totalBets;</span>
<span class="fc" id="L158">    }</span>

    public BigDecimal getEntryAmount() {
<span class="fc" id="L161">        return entryAmount;</span>
    }

    public void setEntryAmount(BigDecimal entryAmount) {
<span class="fc" id="L165">        this.entryAmount = entryAmount;</span>
<span class="fc" id="L166">    }</span>

    @Override
    public Object clone() {
<span class="fc" id="L170">        Object o = null;</span>
        try {
<span class="fc" id="L172">            o = super.clone();</span>
<span class="nc" id="L173">        } catch (CloneNotSupportedException e) {</span>
<span class="nc" id="L174">            throw new RuntimeException(e);</span>
<span class="fc" id="L175">        }</span>
<span class="fc" id="L176">        return o;</span>
    }

    public int getCountOfQPNumber() {
<span class="fc" id="L180">        return countOfQPNumber;</span>
    }

    public void setCountOfQPNumber(int countOfQPNumber) {
<span class="fc" id="L184">        this.countOfQPNumber = countOfQPNumber;</span>
<span class="fc" id="L185">    }</span>

    @Override
    public Message toProtoMessage(Context respCtx) {
<span class="fc" id="L189">        return TeTransactionMessage.Sale.Entry.newBuilder().setBetOption(this.getBetOption())</span>
                .setSelectedNumber(this.getSelectNumber()).setTotalBets((int) this.getTotalBets())
                .setEntryAmount(this.getEntryAmount().toString()).setInputChannel(this.getInputChannel() + &quot;&quot;).build();
    }

    @Override
    public String toString() {
<span class="fc" id="L196">        return &quot;BaseEntry [ticketSerialNo=&quot; + ticketSerialNo + &quot;, selectNumber=&quot; + selectNumber + &quot;, betOption=&quot;</span>
                + betOption + &quot;, totalBets=&quot; + totalBets + &quot;, entryAmount=&quot; + entryAmount + &quot;]&quot;;
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.2.201302030002</span></div></body></html>