<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta http-equiv="x-ua-compatible" content="IE=edge"/>
<title>Test results - Class com.mpos.lottery.te.gameimpl.union.prize.UnionPrizeEnquiryIntegrationTest</title>
<link href="../css/base-style.css" rel="stylesheet" type="text/css"/>
<link href="../css/style.css" rel="stylesheet" type="text/css"/>
<script src="../js/report.js" type="text/javascript"></script>
</head>
<body>
<div id="content">
<h1>Class com.mpos.lottery.te.gameimpl.union.prize.UnionPrizeEnquiryIntegrationTest</h1>
<div class="breadcrumbs">
<a href="../index.html">all</a> &gt; 
<a href="../packages/com.mpos.lottery.te.gameimpl.union.prize.html">com.mpos.lottery.te.gameimpl.union.prize</a> &gt; UnionPrizeEnquiryIntegrationTest</div>
<div id="summary">
<table>
<tr>
<td>
<div class="summaryGroup">
<table>
<tr>
<td>
<div class="infoBox" id="tests">
<div class="counter">13</div>
<p>tests</p>
</div>
</td>
<td>
<div class="infoBox" id="failures">
<div class="counter">0</div>
<p>failures</p>
</div>
</td>
<td>
<div class="infoBox" id="ignored">
<div class="counter">0</div>
<p>ignored</p>
</div>
</td>
<td>
<div class="infoBox" id="duration">
<div class="counter">1.388s</div>
<p>duration</p>
</div>
</td>
</tr>
</table>
</div>
</td>
<td>
<div class="infoBox success" id="successRate">
<div class="percent">100%</div>
<p>successful</p>
</div>
</td>
</tr>
</table>
</div>
<div id="tabs">
<ul class="tabLinks">
<li>
<a href="#tab0">Tests</a>
</li>
<li>
<a href="#tab1">Standard output</a>
</li>
</ul>
<div id="tab0" class="tab">
<h2>Tests</h2>
<table>
<thead>
<tr>
<th>Test</th>
<th>Duration</th>
<th>Result</th>
</tr>
</thead>
<tr>
<td class="success">testEnquiry_NoExistTicket</td>
<td>0.021s</td>
<td class="success">passed</td>
</tr>
<tr>
<td class="success">testEnquiry_NoWIN_PrintNewTicket</td>
<td>0.090s</td>
<td class="success">passed</td>
</tr>
<tr>
<td class="success">testEnquiry_NoWIN_PrintNewTicket_LuckyDraw</td>
<td>0.110s</td>
<td class="success">passed</td>
</tr>
<tr>
<td class="success">testEnquiry_NoWIN_Return</td>
<td>0.078s</td>
<td class="success">passed</td>
</tr>
<tr>
<td class="success">testEnquiry_WIN_TaxWhenAnalysis_PrintNewTicket</td>
<td>0.090s</td>
<td class="success">passed</td>
</tr>
<tr>
<td class="success">testEnquiry_WIN_TaxWhenAnalysis_PrintNewTicket_ByBarcode</td>
<td>0.110s</td>
<td class="success">passed</td>
</tr>
<tr>
<td class="success">testEnquiry_WIN_TaxWhenAnalysis_PrintNewTicket_LuckyDraw</td>
<td>0.131s</td>
<td class="success">passed</td>
</tr>
<tr>
<td class="success">testEnquiry_WIN_TaxWhenAnalysis_Return</td>
<td>0.170s</td>
<td class="success">passed</td>
</tr>
<tr>
<td class="success">testEnquiry_WIN_TaxWhenPayout_BasePerTIcket_OnlyLuckyDraw</td>
<td>0.134s</td>
<td class="success">passed</td>
</tr>
<tr>
<td class="success">testEnquiry_WIN_TaxWhenPayout_BasePerTIcket_PrintNewTicket_LuckyDraw</td>
<td>0.127s</td>
<td class="success">passed</td>
</tr>
<tr>
<td class="success">testEnquiry_WIN_TaxWhenPayout_BasedPerTicket_PrintNewTicket</td>
<td>0.090s</td>
<td class="success">passed</td>
</tr>
<tr>
<td class="success">testEnquiry_WIN_TaxWhenPayout_PrintNewTicket</td>
<td>0.121s</td>
<td class="success">passed</td>
</tr>
<tr>
<td class="success">testEnquiry_WIN_TaxWhenPayout_Return</td>
<td>0.116s</td>
<td class="success">passed</td>
</tr>
</table>
</div>
<div id="tab1" class="tab">
<h2>Standard output</h2>
<span class="code">
<pre>[2015-05-29 17:13:47,275][Test worker][DEBUG][TEPortServlet] Startup job scheduer(org.quartz.impl.StdScheduler@4d1e5820) successfully.
[2015-05-29 17:13:47,275][Test worker][WARN ][TEPortServlet] can NOT find META file:F:\project\M.Lottery\TE\TRUNK_TE\sourcecode\build\classes\main\META-INF\MANIFEST.MF
[2015-05-29 17:13:47,275][Test worker][DEBUG][TEPortServlet] Register MBean(com.mpos.lottery.te.common.jmx.TransactionTimeout@4a9cbb01) with name(com.mpos.lottery.te:type=TransactionTimeoutMBean) successfully.
[2015-05-29 17:13:47,276][Test worker][DEBUG][BaseTransactionalIntegrationTest] Retrieve a ApplicationContext(org.springframework.web.context.support.GenericWebApplicationContext@34f645a8: startup date [Fri May 29 17:12:38 CST 2015]; root of context hierarchy).
[2015-05-29 17:13:47,276][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:47,276][Test worker][INFO ][BaseTransactionalIntegrationTest] | UnionPrizeEnquiryIntegrationTest.testEnquiry_WIN_TaxWhenAnalysis_Return                                                |
[2015-05-29 17:13:47,276][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:47,286][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:47,287][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.union.sale.UnionTicket, mappingFile=xml-mapping/game/union/EnquiryPrize_Req.xml).
[2015-05-29 17:13:47,287][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890827286|Timestamp:20150529171347|Transaction-Type:301|Transaction-Id:|Response-Code:|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;,hash=1247837272), get digest:4fbda0ca381c50f028c4d4724048ae21
[2015-05-29 17:13:47,287][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=301).
[2015-05-29 17:13:47,287][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:47,287][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171347).
[2015-05-29 17:13:47,287][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:47,287][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890827286).
[2015-05-29 17:13:47,287][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:47,287][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:47,287][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=4fbda0ca381c50f028c4d4724048ae21).
[2015-05-29 17:13:47,287][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=8).
[2015-05-29 17:13:47,287][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:47,287][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:47,290][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6ttFDFcpmi1MamgAomcAmY7ZtCcdDkhkRrCXDK2x4EDMo0KLMTKd7D9/oiuZDONWBtcYexf6q8QR.
[2015-05-29 17:13:47,290][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890827286|Timestamp:20150529171347|Transaction-Type:301|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:47,291][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;
[2015-05-29 17:13:47,291][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890827286|Timestamp:20150529171347|Transaction-Type:301|Transaction-Id:|Response-Code:|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;,hash=1247837272), get digest:4fbda0ca381c50f028c4d4724048ae21
[2015-05-29 17:13:47,291][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:47,291][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/union/EnquiryPrize_Req.xml
[2015-05-29 17:13:47,291][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:47,319][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(8_301_1.5.0).
[2015-05-29 17:13:47,319][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(8_301_).
[2015-05-29 17:13:47,319][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(8_301_), found controller(com.mpos.lottery.te.gameimpl.union.UnionController@f81b221) and method(public void com.mpos.lottery.te.gameimpl.union.UnionController.enquiryPrize(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:47,319][Test worker][DEBUG][AbstractPrizeService] Enquiry prize information of ticket:9pkxn/npytVqVbOF5fPlsg==
[2015-05-29 17:13:47,381][Test worker][DEBUG][AbstractPrizeService] Handle winnings of lucky draw of ticket(serialNo:9pkxn/npytVqVbOF5fPlsg==), total 0 winning items found.
[2015-05-29 17:13:47,388][Test worker][DEBUG][CommonFacadeService] No need to publish AMQP message of transaction(PRIZE_ENQUIRY)
[2015-05-29 17:13:47,388][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:47,388][Test worker][DEBUG][ProtocolSerializer] Start to serialize model(class com.mpos.lottery.te.gamespec.prize.web.PrizeDto),mappingFile=xml-mapping/game/union/EnquiryPrize_Res.xml
[2015-05-29 17:13:47,389][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:47,413][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gamespec.prize.web.PrizeDto, mappingFile=xml-mapping/game/union/EnquiryPrize_Res.xml).
[2015-05-29 17:13:47,414][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890827286|Timestamp:20150529171347|Transaction-Type:4301|Transaction-Id:0115052900000000002225|Response-Code:200|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Prize returnAmount=&quot;2500.1&quot; mode=&quot;0&quot; prizeAmount=&quot;7232000&quot; taxAmount=&quot;1054040&quot; actualAmount=&quot;4890473.1&quot; luckyAmount=&quot;0&quot; isVerifyPIN=&quot;1&quot;&gt;&lt;Ticket serialNo=&quot;S-123456&quot; totalAmount=&quot;7500.3&quot;/&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090401&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;7&quot; prizeAmount=&quot;3000&quot; taxAmount=&quot;10&quot; actualAmount=&quot;2991&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;1&quot; prizeAmount=&quot;5000000&quot; taxAmount=&quot;1000000&quot; actualAmount=&quot;4000001&quot; numberOfPrize=&quot;1&quot;/&gt;&lt;Winning level=&quot;5&quot; prizeAmount=&quot;10000&quot; taxAmount=&quot;2000&quot; actualAmount=&quot;8001&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;/PrizeItem&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090403&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;2&quot; prizeAmount=&quot;1000000&quot; taxAmount=&quot;5000&quot; actualAmount=&quot;350001&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;Winning level=&quot;4&quot; prizeAmount=&quot;50000&quot; taxAmount=&quot;10000&quot; actualAmount=&quot;40001&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;8&quot; prizeAmount=&quot;0&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;3&quot;/&gt;&lt;/PrizeItem&gt;&lt;/Prize&gt;):cc0706bc857d5108fe39c385587f2ea7
[2015-05-29 17:13:47,414][Test worker][DEBUG][TEPortServlet] Write response to client(host1=localhost,sizeOfPack=1304) succesfully.
[2015-05-29 17:13:47,415][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=1304): &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Prize returnAmount=&quot;2500.1&quot; mode=&quot;0&quot; prizeAmount=&quot;7232000&quot; taxAmount=&quot;1054040&quot; actualAmount=&quot;4890473.1&quot; luckyAmount=&quot;0&quot; isVerifyPIN=&quot;1&quot;&gt;&lt;Ticket serialNo=&quot;S-123456&quot; totalAmount=&quot;7500.3&quot;/&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090401&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;7&quot; prizeAmount=&quot;3000&quot; taxAmount=&quot;10&quot; actualAmount=&quot;2991&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;1&quot; prizeAmount=&quot;5000000&quot; taxAmount=&quot;1000000&quot; actualAmount=&quot;4000001&quot; numberOfPrize=&quot;1&quot;/&gt;&lt;Winning level=&quot;5&quot; prizeAmount=&quot;10000&quot; taxAmount=&quot;2000&quot; actualAmount=&quot;8001&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;/PrizeItem&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090403&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;2&quot; prizeAmount=&quot;1000000&quot; taxAmount=&quot;5000&quot; actualAmount=&quot;350001&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;Winning level=&quot;4&quot; prizeAmount=&quot;50000&quot; taxAmount=&quot;10000&quot; actualAmount=&quot;40001&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;8&quot; prizeAmount=&quot;0&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;3&quot;/&gt;&lt;/PrizeItem&gt;&lt;/Prize&gt;
[2015-05-29 17:13:47,415][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:47,445][Test worker][DEBUG][TEPortServlet] Startup job scheduer(org.quartz.impl.StdScheduler@4d1e5820) successfully.
[2015-05-29 17:13:47,445][Test worker][WARN ][TEPortServlet] can NOT find META file:F:\project\M.Lottery\TE\TRUNK_TE\sourcecode\build\classes\main\META-INF\MANIFEST.MF
[2015-05-29 17:13:47,445][Test worker][DEBUG][TEPortServlet] Register MBean(com.mpos.lottery.te.common.jmx.TransactionTimeout@389aeac1) with name(com.mpos.lottery.te:type=TransactionTimeoutMBean) successfully.
[2015-05-29 17:13:47,446][Test worker][DEBUG][BaseTransactionalIntegrationTest] Retrieve a ApplicationContext(org.springframework.web.context.support.GenericWebApplicationContext@34f645a8: startup date [Fri May 29 17:12:38 CST 2015]; root of context hierarchy).
[2015-05-29 17:13:47,446][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:47,446][Test worker][INFO ][BaseTransactionalIntegrationTest] | UnionPrizeEnquiryIntegrationTest.testEnquiry_WIN_TaxWhenPayout_BasePerTIcket_OnlyLuckyDraw                             |
[2015-05-29 17:13:47,446][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:47,456][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:47,456][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.union.sale.UnionTicket, mappingFile=xml-mapping/game/union/EnquiryPrize_Req.xml).
[2015-05-29 17:13:47,457][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890827456|Timestamp:20150529171347|Transaction-Type:301|Transaction-Id:|Response-Code:|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;,hash=-467045059), get digest:6ccc1f217e4f30827ede5b2860f6ae26
[2015-05-29 17:13:47,457][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=301).
[2015-05-29 17:13:47,457][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:47,457][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171347).
[2015-05-29 17:13:47,457][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:47,457][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890827456).
[2015-05-29 17:13:47,457][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:47,457][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:47,457][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=6ccc1f217e4f30827ede5b2860f6ae26).
[2015-05-29 17:13:47,457][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=8).
[2015-05-29 17:13:47,457][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:47,458][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:47,461][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6ttFDFcpmi1MamgAomcAmY7ZtCcdDkhkRrCXDK2x4EDMo0KLMTKd7D9/oiuZDONWBtcYexf6q8QR.
[2015-05-29 17:13:47,461][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890827456|Timestamp:20150529171347|Transaction-Type:301|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:47,461][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;
[2015-05-29 17:13:47,462][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890827456|Timestamp:20150529171347|Transaction-Type:301|Transaction-Id:|Response-Code:|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;,hash=-467045059), get digest:6ccc1f217e4f30827ede5b2860f6ae26
[2015-05-29 17:13:47,462][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:47,462][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/union/EnquiryPrize_Req.xml
[2015-05-29 17:13:47,462][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:47,491][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(8_301_1.5.0).
[2015-05-29 17:13:47,491][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(8_301_).
[2015-05-29 17:13:47,491][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(8_301_), found controller(com.mpos.lottery.te.gameimpl.union.UnionController@f81b221) and method(public void com.mpos.lottery.te.gameimpl.union.UnionController.enquiryPrize(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:47,491][Test worker][DEBUG][AbstractPrizeService] Enquiry prize information of ticket:9pkxn/npytVqVbOF5fPlsg==
[2015-05-29 17:13:47,516][Test worker][DEBUG][AbstractPrizeService] Handle winnings of lucky draw of ticket(serialNo:9pkxn/npytVqVbOF5fPlsg==), total 2 winning items found.
[2015-05-29 17:13:47,540][Test worker][DEBUG][DefaultTaxService] Calculate tax for amount:2800000 based on threshold(com.mpos.lottery.te.gamespec.prize.TaxThreshold@3438e93b[id=WTT-1,taxPolicyId=TP-1,taxDateRange=com.mpos.lottery.te.gamespec.prize.TaxDateRange@18efaecd[id=TDR-1,beginDate=2009-03-20 21:00:00.0,endDate=2099-03-20 21:00:00.0],minAmount=1000,maxAmount=9999999999,ruleType=1,taxAmount=0.2,taxBase=1])...tax:466666.67
[2015-05-29 17:13:47,549][Test worker][DEBUG][CommonFacadeService] No need to publish AMQP message of transaction(PRIZE_ENQUIRY)
[2015-05-29 17:13:47,549][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:47,549][Test worker][DEBUG][ProtocolSerializer] Start to serialize model(class com.mpos.lottery.te.gamespec.prize.web.PrizeDto),mappingFile=xml-mapping/game/union/EnquiryPrize_Res.xml
[2015-05-29 17:13:47,549][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:47,550][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gamespec.prize.web.PrizeDto, mappingFile=xml-mapping/game/union/EnquiryPrize_Res.xml).
[2015-05-29 17:13:47,550][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890827456|Timestamp:20150529171347|Transaction-Type:4301|Transaction-Id:0115052900000000002226|Response-Code:200|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Prize mode=&quot;1&quot; prizeAmount=&quot;2800000&quot; taxAmount=&quot;466666.67&quot; actualAmount=&quot;2333333.33&quot; luckyAmount=&quot;8000.00&quot; isVerifyPIN=&quot;1&quot;&gt;&lt;Ticket serialNo=&quot;S-123456&quot; totalAmount=&quot;7500.3&quot;/&gt;&lt;PrizeItem type=&quot;2&quot;&gt;&lt;GameDraw number=&quot;001&quot; gameId=&quot;LD-1&quot;/&gt;&lt;Winning level=&quot;1&quot; prizeAmount=&quot;400000&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;Winning level=&quot;4&quot; prizeAmount=&quot;1000000&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;2&quot;&gt;&lt;PrizeObject name=&quot;Sony Camera&quot; count=&quot;2&quot; taxAmount=&quot;500&quot; price=&quot;2000&quot;/&gt;&lt;/Winning&gt;&lt;/PrizeItem&gt;&lt;/Prize&gt;):10aa4cb4634f185fa796f63a34333d03
[2015-05-29 17:13:47,551][Test worker][DEBUG][TEPortServlet] Write response to client(host1=localhost,sizeOfPack=748) succesfully.
[2015-05-29 17:13:47,552][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=748): &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Prize mode=&quot;1&quot; prizeAmount=&quot;2800000&quot; taxAmount=&quot;466666.67&quot; actualAmount=&quot;2333333.33&quot; luckyAmount=&quot;8000.00&quot; isVerifyPIN=&quot;1&quot;&gt;&lt;Ticket serialNo=&quot;S-123456&quot; totalAmount=&quot;7500.3&quot;/&gt;&lt;PrizeItem type=&quot;2&quot;&gt;&lt;GameDraw number=&quot;001&quot; gameId=&quot;LD-1&quot;/&gt;&lt;Winning level=&quot;1&quot; prizeAmount=&quot;400000&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;Winning level=&quot;4&quot; prizeAmount=&quot;1000000&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;2&quot;&gt;&lt;PrizeObject name=&quot;Sony Camera&quot; count=&quot;2&quot; taxAmount=&quot;500&quot; price=&quot;2000&quot;/&gt;&lt;/Winning&gt;&lt;/PrizeItem&gt;&lt;/Prize&gt;
[2015-05-29 17:13:47,552][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:47,574][Test worker][DEBUG][TEPortServlet] Startup job scheduer(org.quartz.impl.StdScheduler@4d1e5820) successfully.
[2015-05-29 17:13:47,574][Test worker][WARN ][TEPortServlet] can NOT find META file:F:\project\M.Lottery\TE\TRUNK_TE\sourcecode\build\classes\main\META-INF\MANIFEST.MF
[2015-05-29 17:13:47,574][Test worker][DEBUG][TEPortServlet] Register MBean(com.mpos.lottery.te.common.jmx.TransactionTimeout@64e4c9b1) with name(com.mpos.lottery.te:type=TransactionTimeoutMBean) successfully.
[2015-05-29 17:13:47,575][Test worker][DEBUG][BaseTransactionalIntegrationTest] Retrieve a ApplicationContext(org.springframework.web.context.support.GenericWebApplicationContext@34f645a8: startup date [Fri May 29 17:12:38 CST 2015]; root of context hierarchy).
[2015-05-29 17:13:47,575][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:47,575][Test worker][INFO ][BaseTransactionalIntegrationTest] | UnionPrizeEnquiryIntegrationTest.testEnquiry_NoExistTicket                                                             |
[2015-05-29 17:13:47,575][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:47,582][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:47,582][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.union.sale.UnionTicket, mappingFile=xml-mapping/game/union/EnquiryPrize_Req.xml).
[2015-05-29 17:13:47,583][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890827582|Timestamp:20150529171347|Transaction-Type:301|Transaction-Id:|Response-Code:|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456-NO&quot; validationCode=&quot;111111&quot;/&gt;,hash=407092075), get digest:6850bdb74b9801f39d3be0dc8bc59dc1
[2015-05-29 17:13:47,583][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=301).
[2015-05-29 17:13:47,583][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:47,583][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171347).
[2015-05-29 17:13:47,583][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:47,583][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890827582).
[2015-05-29 17:13:47,583][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:47,583][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:47,583][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=6850bdb74b9801f39d3be0dc8bc59dc1).
[2015-05-29 17:13:47,583][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=66).
[2015-05-29 17:13:47,584][Test worker][ERROR][TEPortServlet] Unsupported game type:66
com.mpos.lottery.te.config.exception.SystemException: Unsupported game type:66
	at com.mpos.lottery.te.gamespec.game.GameType.fromType(GameType.java:208)
	at com.mpos.lottery.te.port.Context.setGameTypeId(Context.java:392)
	at com.mpos.lottery.te.port.TEPortServlet.parseHeader(TEPortServlet.java:387)
	at com.mpos.lottery.te.port.TEPortServlet.doPost(TEPortServlet.java:101)
	at com.mpos.lottery.te.test.integration.BaseServletIntegrationTest.doPost(BaseServletIntegrationTest.java:80)
	at com.mpos.lottery.te.gameimpl.union.prize.UnionPrizeEnquiryIntegrationTest.testEnquiry_NoExistTicket(UnionPrizeEnquiryIntegrationTest.java:407)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:74)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
	at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:83)
	at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:72)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:233)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:87)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:71)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:176)
	at org.junit.runners.Suite.runChild(Suite.java:127)
	at org.junit.runners.Suite.runChild(Suite.java:26)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecuter.runTestClass(JUnitTestClassExecuter.java:86)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecuter.execute(JUnitTestClassExecuter.java:49)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassProcessor.processTestClass(JUnitTestClassProcessor.java:69)
	at org.gradle.api.internal.tasks.testing.SuiteTestClassProcessor.processTestClass(SuiteTestClassProcessor.java:48)
	at sun.reflect.GeneratedMethodAccessor8.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:35)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)
	at org.gradle.messaging.dispatch.ContextClassLoaderDispatch.dispatch(ContextClassLoaderDispatch.java:32)
	at org.gradle.messaging.dispatch.ProxyDispatchAdapter$DispatchingInvocationHandler.invoke(ProxyDispatchAdapter.java:93)
	at com.sun.proxy.$Proxy2.processTestClass(Unknown Source)
	at org.gradle.api.internal.tasks.testing.worker.TestWorker.processTestClass(TestWorker.java:105)
	at sun.reflect.GeneratedMethodAccessor7.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:35)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)
	at org.gradle.messaging.remote.internal.hub.MessageHub$Handler.run(MessageHub.java:360)
	at org.gradle.internal.concurrent.DefaultExecutorFactory$StoppableExecutorImpl$1.run(DefaultExecutorFactory.java:64)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
	at java.lang.Thread.run(Thread.java:745)
[2015-05-29 17:13:47,585][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=208,length=0): 
[2015-05-29 17:13:47,592][Test worker][DEBUG][TEPortServlet] Startup job scheduer(org.quartz.impl.StdScheduler@4d1e5820) successfully.
[2015-05-29 17:13:47,593][Test worker][WARN ][TEPortServlet] can NOT find META file:F:\project\M.Lottery\TE\TRUNK_TE\sourcecode\build\classes\main\META-INF\MANIFEST.MF
[2015-05-29 17:13:47,593][Test worker][DEBUG][TEPortServlet] Register MBean(com.mpos.lottery.te.common.jmx.TransactionTimeout@276058f6) with name(com.mpos.lottery.te:type=TransactionTimeoutMBean) successfully.
[2015-05-29 17:13:47,593][Test worker][DEBUG][BaseTransactionalIntegrationTest] Retrieve a ApplicationContext(org.springframework.web.context.support.GenericWebApplicationContext@34f645a8: startup date [Fri May 29 17:12:38 CST 2015]; root of context hierarchy).
[2015-05-29 17:13:47,593][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:47,593][Test worker][INFO ][BaseTransactionalIntegrationTest] | UnionPrizeEnquiryIntegrationTest.testEnquiry_WIN_TaxWhenPayout_Return                                                  |
[2015-05-29 17:13:47,593][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:47,602][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:47,602][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.union.sale.UnionTicket, mappingFile=xml-mapping/game/union/EnquiryPrize_Req.xml).
[2015-05-29 17:13:47,603][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890827602|Timestamp:20150529171347|Transaction-Type:301|Transaction-Id:|Response-Code:|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;,hash=-2110652320), get digest:fe008a7aa984865960dffd874730c2a8
[2015-05-29 17:13:47,603][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=301).
[2015-05-29 17:13:47,603][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:47,603][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171347).
[2015-05-29 17:13:47,603][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:47,603][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890827602).
[2015-05-29 17:13:47,603][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:47,603][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:47,603][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=fe008a7aa984865960dffd874730c2a8).
[2015-05-29 17:13:47,603][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=8).
[2015-05-29 17:13:47,603][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:47,603][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:47,604][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6ttFDFcpmi1MamgAomcAmY7ZtCcdDkhkRrCXDK2x4EDMo0KLMTKd7D9/oiuZDONWBtcYexf6q8QR.
[2015-05-29 17:13:47,605][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890827602|Timestamp:20150529171347|Transaction-Type:301|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:47,605][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;
[2015-05-29 17:13:47,605][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890827602|Timestamp:20150529171347|Transaction-Type:301|Transaction-Id:|Response-Code:|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;,hash=-2110652320), get digest:fe008a7aa984865960dffd874730c2a8
[2015-05-29 17:13:47,605][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:47,605][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/union/EnquiryPrize_Req.xml
[2015-05-29 17:13:47,605][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:47,625][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(8_301_1.5.0).
[2015-05-29 17:13:47,625][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(8_301_).
[2015-05-29 17:13:47,625][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(8_301_), found controller(com.mpos.lottery.te.gameimpl.union.UnionController@f81b221) and method(public void com.mpos.lottery.te.gameimpl.union.UnionController.enquiryPrize(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:47,625][Test worker][DEBUG][AbstractPrizeService] Enquiry prize information of ticket:9pkxn/npytVqVbOF5fPlsg==
[2015-05-29 17:13:47,649][Test worker][DEBUG][DefaultTaxService] Calculate tax for amount:3000 based on threshold(com.mpos.lottery.te.gamespec.prize.TaxThreshold@1cc2055b[id=WTT-1,taxPolicyId=TP-1,taxDateRange=com.mpos.lottery.te.gamespec.prize.TaxDateRange@449cbc72[id=TDR-1,beginDate=2009-03-20 21:00:00.0,endDate=2099-03-20 21:00:00.0],minAmount=1000,maxAmount=9999999999,ruleType=1,taxAmount=0.2,taxBase=1])...tax:500.00
[2015-05-29 17:13:47,654][Test worker][DEBUG][DefaultTaxService] Calculate tax for amount:5000000 based on threshold(com.mpos.lottery.te.gamespec.prize.TaxThreshold@1cc2055b[id=WTT-1,taxPolicyId=TP-1,taxDateRange=com.mpos.lottery.te.gamespec.prize.TaxDateRange@449cbc72[id=TDR-1,beginDate=2009-03-20 21:00:00.0,endDate=2099-03-20 21:00:00.0],minAmount=1000,maxAmount=9999999999,ruleType=1,taxAmount=0.2,taxBase=1])...tax:833333.33
[2015-05-29 17:13:47,659][Test worker][DEBUG][DefaultTaxService] Calculate tax for amount:10000 based on threshold(com.mpos.lottery.te.gamespec.prize.TaxThreshold@1cc2055b[id=WTT-1,taxPolicyId=TP-1,taxDateRange=com.mpos.lottery.te.gamespec.prize.TaxDateRange@449cbc72[id=TDR-1,beginDate=2009-03-20 21:00:00.0,endDate=2099-03-20 21:00:00.0],minAmount=1000,maxAmount=9999999999,ruleType=1,taxAmount=0.2,taxBase=1])...tax:1666.67
[2015-05-29 17:13:47,669][Test worker][DEBUG][DefaultTaxService] Calculate tax for amount:1000000 based on threshold(com.mpos.lottery.te.gamespec.prize.TaxThreshold@1cc2055b[id=WTT-1,taxPolicyId=TP-1,taxDateRange=com.mpos.lottery.te.gamespec.prize.TaxDateRange@449cbc72[id=TDR-1,beginDate=2009-03-20 21:00:00.0,endDate=2099-03-20 21:00:00.0],minAmount=1000,maxAmount=9999999999,ruleType=1,taxAmount=0.2,taxBase=1])...tax:166666.67
[2015-05-29 17:13:47,676][Test worker][DEBUG][DefaultTaxService] Calculate tax for amount:50000 based on threshold(com.mpos.lottery.te.gamespec.prize.TaxThreshold@1cc2055b[id=WTT-1,taxPolicyId=TP-1,taxDateRange=com.mpos.lottery.te.gamespec.prize.TaxDateRange@449cbc72[id=TDR-1,beginDate=2009-03-20 21:00:00.0,endDate=2099-03-20 21:00:00.0],minAmount=1000,maxAmount=9999999999,ruleType=1,taxAmount=0.2,taxBase=1])...tax:8333.33
[2015-05-29 17:13:47,684][Test worker][DEBUG][DefaultTaxService] Calculate tax for amount:50000 based on threshold(com.mpos.lottery.te.gamespec.prize.TaxThreshold@1cc2055b[id=WTT-1,taxPolicyId=TP-1,taxDateRange=com.mpos.lottery.te.gamespec.prize.TaxDateRange@449cbc72[id=TDR-1,beginDate=2009-03-20 21:00:00.0,endDate=2099-03-20 21:00:00.0],minAmount=1000,maxAmount=9999999999,ruleType=1,taxAmount=0.2,taxBase=1])...tax:8333.33
[2015-05-29 17:13:47,688][Test worker][DEBUG][AbstractPrizeService] Handle winnings of lucky draw of ticket(serialNo:9pkxn/npytVqVbOF5fPlsg==), total 0 winning items found.
[2015-05-29 17:13:47,693][Test worker][DEBUG][CommonFacadeService] No need to publish AMQP message of transaction(PRIZE_ENQUIRY)
[2015-05-29 17:13:47,694][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:47,694][Test worker][DEBUG][ProtocolSerializer] Start to serialize model(class com.mpos.lottery.te.gamespec.prize.web.PrizeDto),mappingFile=xml-mapping/game/union/EnquiryPrize_Res.xml
[2015-05-29 17:13:47,694][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:47,695][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gamespec.prize.web.PrizeDto, mappingFile=xml-mapping/game/union/EnquiryPrize_Res.xml).
[2015-05-29 17:13:47,695][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890827602|Timestamp:20150529171347|Transaction-Type:4301|Transaction-Id:0115052900000000002227|Response-Code:200|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Prize returnAmount=&quot;2500.1&quot; mode=&quot;0&quot; prizeAmount=&quot;7232000&quot; taxAmount=&quot;1205333.33&quot; actualAmount=&quot;6029166.77&quot; luckyAmount=&quot;0&quot; isVerifyPIN=&quot;1&quot;&gt;&lt;Ticket serialNo=&quot;S-123456&quot; totalAmount=&quot;7500.3&quot;/&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090401&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;7&quot; prizeAmount=&quot;3000&quot; taxAmount=&quot;500.00&quot; actualAmount=&quot;2500.00&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;1&quot; prizeAmount=&quot;5000000&quot; taxAmount=&quot;833333.33&quot; actualAmount=&quot;4166666.67&quot; numberOfPrize=&quot;1&quot;/&gt;&lt;Winning level=&quot;5&quot; prizeAmount=&quot;10000&quot; taxAmount=&quot;1666.67&quot; actualAmount=&quot;8333.33&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;/PrizeItem&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090403&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;2&quot; prizeAmount=&quot;1000000&quot; taxAmount=&quot;166666.67&quot; actualAmount=&quot;833333.33&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;Winning level=&quot;4&quot; prizeAmount=&quot;50000&quot; taxAmount=&quot;8333.33&quot; actualAmount=&quot;41666.67&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;8&quot; prizeAmount=&quot;0&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;3&quot;/&gt;&lt;/PrizeItem&gt;&lt;/Prize&gt;):8f20e75c545a054ecf7274e1c0e1c0c6
[2015-05-29 17:13:47,695][Test worker][DEBUG][TEPortServlet] Write response to client(host1=localhost,sizeOfPack=1356) succesfully.
[2015-05-29 17:13:47,696][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=1356): &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Prize returnAmount=&quot;2500.1&quot; mode=&quot;0&quot; prizeAmount=&quot;7232000&quot; taxAmount=&quot;1205333.33&quot; actualAmount=&quot;6029166.77&quot; luckyAmount=&quot;0&quot; isVerifyPIN=&quot;1&quot;&gt;&lt;Ticket serialNo=&quot;S-123456&quot; totalAmount=&quot;7500.3&quot;/&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090401&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;7&quot; prizeAmount=&quot;3000&quot; taxAmount=&quot;500.00&quot; actualAmount=&quot;2500.00&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;1&quot; prizeAmount=&quot;5000000&quot; taxAmount=&quot;833333.33&quot; actualAmount=&quot;4166666.67&quot; numberOfPrize=&quot;1&quot;/&gt;&lt;Winning level=&quot;5&quot; prizeAmount=&quot;10000&quot; taxAmount=&quot;1666.67&quot; actualAmount=&quot;8333.33&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;/PrizeItem&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090403&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;2&quot; prizeAmount=&quot;1000000&quot; taxAmount=&quot;166666.67&quot; actualAmount=&quot;833333.33&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;Winning level=&quot;4&quot; prizeAmount=&quot;50000&quot; taxAmount=&quot;8333.33&quot; actualAmount=&quot;41666.67&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;8&quot; prizeAmount=&quot;0&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;3&quot;/&gt;&lt;/PrizeItem&gt;&lt;/Prize&gt;
[2015-05-29 17:13:47,696][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:47,708][Test worker][DEBUG][TEPortServlet] Startup job scheduer(org.quartz.impl.StdScheduler@4d1e5820) successfully.
[2015-05-29 17:13:47,709][Test worker][WARN ][TEPortServlet] can NOT find META file:F:\project\M.Lottery\TE\TRUNK_TE\sourcecode\build\classes\main\META-INF\MANIFEST.MF
[2015-05-29 17:13:47,709][Test worker][DEBUG][TEPortServlet] Register MBean(com.mpos.lottery.te.common.jmx.TransactionTimeout@373c4947) with name(com.mpos.lottery.te:type=TransactionTimeoutMBean) successfully.
[2015-05-29 17:13:47,709][Test worker][DEBUG][BaseTransactionalIntegrationTest] Retrieve a ApplicationContext(org.springframework.web.context.support.GenericWebApplicationContext@34f645a8: startup date [Fri May 29 17:12:38 CST 2015]; root of context hierarchy).
[2015-05-29 17:13:47,710][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:47,710][Test worker][INFO ][BaseTransactionalIntegrationTest] | UnionPrizeEnquiryIntegrationTest.testEnquiry_WIN_TaxWhenAnalysis_PrintNewTicket                                        |
[2015-05-29 17:13:47,710][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:47,714][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:47,715][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.union.sale.UnionTicket, mappingFile=xml-mapping/game/union/EnquiryPrize_Req.xml).
[2015-05-29 17:13:47,715][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890827714|Timestamp:20150529171347|Transaction-Type:301|Transaction-Id:|Response-Code:|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;,hash=-1882592830), get digest:a0bca509a0651b845729a5b8d19c7a23
[2015-05-29 17:13:47,716][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=301).
[2015-05-29 17:13:47,716][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:47,716][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171347).
[2015-05-29 17:13:47,716][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:47,716][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890827714).
[2015-05-29 17:13:47,716][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:47,716][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:47,716][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=a0bca509a0651b845729a5b8d19c7a23).
[2015-05-29 17:13:47,716][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=8).
[2015-05-29 17:13:47,716][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:47,716][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:47,717][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6ttFDFcpmi1MamgAomcAmY7ZtCcdDkhkRrCXDK2x4EDMo0KLMTKd7D9/oiuZDONWBtcYexf6q8QR.
[2015-05-29 17:13:47,718][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890827714|Timestamp:20150529171347|Transaction-Type:301|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:47,718][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;
[2015-05-29 17:13:47,718][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890827714|Timestamp:20150529171347|Transaction-Type:301|Transaction-Id:|Response-Code:|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;,hash=-1882592830), get digest:a0bca509a0651b845729a5b8d19c7a23
[2015-05-29 17:13:47,718][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:47,718][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/union/EnquiryPrize_Req.xml
[2015-05-29 17:13:47,718][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:47,737][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(8_301_1.5.0).
[2015-05-29 17:13:47,737][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(8_301_).
[2015-05-29 17:13:47,737][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(8_301_), found controller(com.mpos.lottery.te.gameimpl.union.UnionController@f81b221) and method(public void com.mpos.lottery.te.gameimpl.union.UnionController.enquiryPrize(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:47,737][Test worker][DEBUG][AbstractPrizeService] Enquiry prize information of ticket:9pkxn/npytVqVbOF5fPlsg==
[2015-05-29 17:13:47,779][Test worker][DEBUG][AbstractPrizeService] Handle winnings of lucky draw of ticket(serialNo:9pkxn/npytVqVbOF5fPlsg==), total 0 winning items found.
[2015-05-29 17:13:47,785][Test worker][DEBUG][CommonFacadeService] No need to publish AMQP message of transaction(PRIZE_ENQUIRY)
[2015-05-29 17:13:47,785][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:47,785][Test worker][DEBUG][ProtocolSerializer] Start to serialize model(class com.mpos.lottery.te.gamespec.prize.web.PrizeDto),mappingFile=xml-mapping/game/union/EnquiryPrize_Res.xml
[2015-05-29 17:13:47,785][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:47,786][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gamespec.prize.web.PrizeDto, mappingFile=xml-mapping/game/union/EnquiryPrize_Res.xml).
[2015-05-29 17:13:47,787][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890827714|Timestamp:20150529171347|Transaction-Type:4301|Transaction-Id:0115052900000000002228|Response-Code:200|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Prize mode=&quot;1&quot; prizeAmount=&quot;7232000&quot; taxAmount=&quot;1054040&quot; actualAmount=&quot;4887973&quot; luckyAmount=&quot;0&quot; isVerifyPIN=&quot;1&quot;&gt;&lt;Ticket serialNo=&quot;S-123456&quot; totalAmount=&quot;7500.3&quot;/&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090401&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;7&quot; prizeAmount=&quot;3000&quot; taxAmount=&quot;10&quot; actualAmount=&quot;2991&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;1&quot; prizeAmount=&quot;5000000&quot; taxAmount=&quot;1000000&quot; actualAmount=&quot;4000001&quot; numberOfPrize=&quot;1&quot;/&gt;&lt;Winning level=&quot;5&quot; prizeAmount=&quot;10000&quot; taxAmount=&quot;2000&quot; actualAmount=&quot;8001&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;/PrizeItem&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090403&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;2&quot; prizeAmount=&quot;1000000&quot; taxAmount=&quot;5000&quot; actualAmount=&quot;350001&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;Winning level=&quot;4&quot; prizeAmount=&quot;50000&quot; taxAmount=&quot;10000&quot; actualAmount=&quot;40001&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;8&quot; prizeAmount=&quot;0&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;3&quot;/&gt;&lt;/PrizeItem&gt;&lt;/Prize&gt;):184e4b857f943bef3653b96aeb8074dd
[2015-05-29 17:13:47,787][Test worker][DEBUG][TEPortServlet] Write response to client(host1=localhost,sizeOfPack=1272) succesfully.
[2015-05-29 17:13:47,787][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=1272): &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Prize mode=&quot;1&quot; prizeAmount=&quot;7232000&quot; taxAmount=&quot;1054040&quot; actualAmount=&quot;4887973&quot; luckyAmount=&quot;0&quot; isVerifyPIN=&quot;1&quot;&gt;&lt;Ticket serialNo=&quot;S-123456&quot; totalAmount=&quot;7500.3&quot;/&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090401&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;7&quot; prizeAmount=&quot;3000&quot; taxAmount=&quot;10&quot; actualAmount=&quot;2991&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;1&quot; prizeAmount=&quot;5000000&quot; taxAmount=&quot;1000000&quot; actualAmount=&quot;4000001&quot; numberOfPrize=&quot;1&quot;/&gt;&lt;Winning level=&quot;5&quot; prizeAmount=&quot;10000&quot; taxAmount=&quot;2000&quot; actualAmount=&quot;8001&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;/PrizeItem&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090403&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;2&quot; prizeAmount=&quot;1000000&quot; taxAmount=&quot;5000&quot; actualAmount=&quot;350001&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;Winning level=&quot;4&quot; prizeAmount=&quot;50000&quot; taxAmount=&quot;10000&quot; actualAmount=&quot;40001&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;8&quot; prizeAmount=&quot;0&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;3&quot;/&gt;&lt;/PrizeItem&gt;&lt;/Prize&gt;
[2015-05-29 17:13:47,787][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:47,802][Test worker][DEBUG][TEPortServlet] Startup job scheduer(org.quartz.impl.StdScheduler@4d1e5820) successfully.
[2015-05-29 17:13:47,802][Test worker][WARN ][TEPortServlet] can NOT find META file:F:\project\M.Lottery\TE\TRUNK_TE\sourcecode\build\classes\main\META-INF\MANIFEST.MF
[2015-05-29 17:13:47,802][Test worker][DEBUG][TEPortServlet] Register MBean(com.mpos.lottery.te.common.jmx.TransactionTimeout@72a01063) with name(com.mpos.lottery.te:type=TransactionTimeoutMBean) successfully.
[2015-05-29 17:13:47,803][Test worker][DEBUG][BaseTransactionalIntegrationTest] Retrieve a ApplicationContext(org.springframework.web.context.support.GenericWebApplicationContext@34f645a8: startup date [Fri May 29 17:12:38 CST 2015]; root of context hierarchy).
[2015-05-29 17:13:47,803][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:47,803][Test worker][INFO ][BaseTransactionalIntegrationTest] | UnionPrizeEnquiryIntegrationTest.testEnquiry_NoWIN_Return                                                              |
[2015-05-29 17:13:47,803][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:47,812][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:47,812][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.union.sale.UnionTicket, mappingFile=xml-mapping/game/union/EnquiryPrize_Req.xml).
[2015-05-29 17:13:47,813][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890827812|Timestamp:20150529171347|Transaction-Type:301|Transaction-Id:|Response-Code:|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;,hash=2027478721), get digest:ee45a452ec9c5d7d30f1f495a0a7452a
[2015-05-29 17:13:47,813][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=301).
[2015-05-29 17:13:47,813][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:47,813][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171347).
[2015-05-29 17:13:47,813][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:47,813][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890827812).
[2015-05-29 17:13:47,813][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:47,813][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:47,813][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=ee45a452ec9c5d7d30f1f495a0a7452a).
[2015-05-29 17:13:47,813][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=8).
[2015-05-29 17:13:47,813][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:47,813][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:47,815][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6ttFDFcpmi1MamgAomcAmY7ZtCcdDkhkRrCXDK2x4EDMo0KLMTKd7D9/oiuZDONWBtcYexf6q8QR.
[2015-05-29 17:13:47,815][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890827812|Timestamp:20150529171347|Transaction-Type:301|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:47,815][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;
[2015-05-29 17:13:47,815][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890827812|Timestamp:20150529171347|Transaction-Type:301|Transaction-Id:|Response-Code:|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;,hash=2027478721), get digest:ee45a452ec9c5d7d30f1f495a0a7452a
[2015-05-29 17:13:47,815][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:47,815][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/union/EnquiryPrize_Req.xml
[2015-05-29 17:13:47,815][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:47,830][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(8_301_1.5.0).
[2015-05-29 17:13:47,830][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(8_301_).
[2015-05-29 17:13:47,830][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(8_301_), found controller(com.mpos.lottery.te.gameimpl.union.UnionController@f81b221) and method(public void com.mpos.lottery.te.gameimpl.union.UnionController.enquiryPrize(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:47,830][Test worker][DEBUG][AbstractPrizeService] Enquiry prize information of ticket:9pkxn/npytVqVbOF5fPlsg==
[2015-05-29 17:13:47,855][Test worker][DEBUG][AbstractPrizeService] Handle winnings of lucky draw of ticket(serialNo:9pkxn/npytVqVbOF5fPlsg==), total 0 winning items found.
[2015-05-29 17:13:47,863][Test worker][DEBUG][CommonFacadeService] No need to publish AMQP message of transaction(PRIZE_ENQUIRY)
[2015-05-29 17:13:47,863][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:47,864][Test worker][DEBUG][ProtocolSerializer] Start to serialize model(class com.mpos.lottery.te.gamespec.prize.web.PrizeDto),mappingFile=xml-mapping/game/union/EnquiryPrize_Res.xml
[2015-05-29 17:13:47,864][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:47,864][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gamespec.prize.web.PrizeDto, mappingFile=xml-mapping/game/union/EnquiryPrize_Res.xml).
[2015-05-29 17:13:47,864][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890827812|Timestamp:20150529171347|Transaction-Type:4301|Transaction-Id:0115052900000000002229|Response-Code:200|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Prize returnAmount=&quot;2500.1&quot; mode=&quot;0&quot; prizeAmount=&quot;0&quot; taxAmount=&quot;0&quot; actualAmount=&quot;2500.1&quot; luckyAmount=&quot;0&quot; isVerifyPIN=&quot;1&quot;&gt;&lt;Ticket serialNo=&quot;S-123456&quot; totalAmount=&quot;7500.3&quot;/&gt;&lt;/Prize&gt;):5ff446a7db8eed544612d57e0811f60a
[2015-05-29 17:13:47,865][Test worker][DEBUG][TEPortServlet] Write response to client(host1=localhost,sizeOfPack=300) succesfully.
[2015-05-29 17:13:47,865][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=300): &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Prize returnAmount=&quot;2500.1&quot; mode=&quot;0&quot; prizeAmount=&quot;0&quot; taxAmount=&quot;0&quot; actualAmount=&quot;2500.1&quot; luckyAmount=&quot;0&quot; isVerifyPIN=&quot;1&quot;&gt;&lt;Ticket serialNo=&quot;S-123456&quot; totalAmount=&quot;7500.3&quot;/&gt;&lt;/Prize&gt;
[2015-05-29 17:13:47,865][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:47,876][Test worker][DEBUG][TEPortServlet] Startup job scheduer(org.quartz.impl.StdScheduler@4d1e5820) successfully.
[2015-05-29 17:13:47,876][Test worker][WARN ][TEPortServlet] can NOT find META file:F:\project\M.Lottery\TE\TRUNK_TE\sourcecode\build\classes\main\META-INF\MANIFEST.MF
[2015-05-29 17:13:47,876][Test worker][DEBUG][TEPortServlet] Register MBean(com.mpos.lottery.te.common.jmx.TransactionTimeout@48e84a86) with name(com.mpos.lottery.te:type=TransactionTimeoutMBean) successfully.
[2015-05-29 17:13:47,877][Test worker][DEBUG][BaseTransactionalIntegrationTest] Retrieve a ApplicationContext(org.springframework.web.context.support.GenericWebApplicationContext@34f645a8: startup date [Fri May 29 17:12:38 CST 2015]; root of context hierarchy).
[2015-05-29 17:13:47,877][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:47,877][Test worker][INFO ][BaseTransactionalIntegrationTest] | UnionPrizeEnquiryIntegrationTest.testEnquiry_WIN_TaxWhenPayout_BasedPerTicket_PrintNewTicket                           |
[2015-05-29 17:13:47,877][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:47,882][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:47,882][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.union.sale.UnionTicket, mappingFile=xml-mapping/game/union/EnquiryPrize_Req.xml).
[2015-05-29 17:13:47,883][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890827882|Timestamp:20150529171347|Transaction-Type:301|Transaction-Id:|Response-Code:|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;,hash=1532833882), get digest:2d87f7e5e90a014a0625d21e3e21eded
[2015-05-29 17:13:47,883][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=301).
[2015-05-29 17:13:47,883][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:47,883][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171347).
[2015-05-29 17:13:47,883][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:47,883][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890827882).
[2015-05-29 17:13:47,883][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:47,883][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:47,883][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=2d87f7e5e90a014a0625d21e3e21eded).
[2015-05-29 17:13:47,883][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=8).
[2015-05-29 17:13:47,883][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:47,883][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:47,885][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6ttFDFcpmi1MamgAomcAmY7ZtCcdDkhkRrCXDK2x4EDMo0KLMTKd7D9/oiuZDONWBtcYexf6q8QR.
[2015-05-29 17:13:47,885][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890827882|Timestamp:20150529171347|Transaction-Type:301|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:47,885][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;
[2015-05-29 17:13:47,885][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890827882|Timestamp:20150529171347|Transaction-Type:301|Transaction-Id:|Response-Code:|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;,hash=1532833882), get digest:2d87f7e5e90a014a0625d21e3e21eded
[2015-05-29 17:13:47,885][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:47,885][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/union/EnquiryPrize_Req.xml
[2015-05-29 17:13:47,885][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:47,899][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(8_301_1.5.0).
[2015-05-29 17:13:47,899][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(8_301_).
[2015-05-29 17:13:47,899][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(8_301_), found controller(com.mpos.lottery.te.gameimpl.union.UnionController@f81b221) and method(public void com.mpos.lottery.te.gameimpl.union.UnionController.enquiryPrize(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:47,899][Test worker][DEBUG][AbstractPrizeService] Enquiry prize information of ticket:9pkxn/npytVqVbOF5fPlsg==
[2015-05-29 17:13:47,930][Test worker][DEBUG][DefaultTaxService] Calculate tax for amount:5032000 based on threshold(com.mpos.lottery.te.gamespec.prize.TaxThreshold@771a7e9b[id=WTT-1,taxPolicyId=TP-1,taxDateRange=com.mpos.lottery.te.gamespec.prize.TaxDateRange@207f8195[id=TDR-1,beginDate=2009-03-20 21:00:00.0,endDate=2099-03-20 21:00:00.0],minAmount=1000,maxAmount=9999999999,ruleType=1,taxAmount=0.2,taxBase=1])...tax:838666.67
[2015-05-29 17:13:47,944][Test worker][DEBUG][DefaultTaxService] Calculate tax for amount:2200000 based on threshold(com.mpos.lottery.te.gamespec.prize.TaxThreshold@771a7e9b[id=WTT-1,taxPolicyId=TP-1,taxDateRange=com.mpos.lottery.te.gamespec.prize.TaxDateRange@207f8195[id=TDR-1,beginDate=2009-03-20 21:00:00.0,endDate=2099-03-20 21:00:00.0],minAmount=1000,maxAmount=9999999999,ruleType=1,taxAmount=0.2,taxBase=1])...tax:366666.67
[2015-05-29 17:13:47,947][Test worker][DEBUG][AbstractPrizeService] Handle winnings of lucky draw of ticket(serialNo:9pkxn/npytVqVbOF5fPlsg==), total 0 winning items found.
[2015-05-29 17:13:47,952][Test worker][DEBUG][CommonFacadeService] No need to publish AMQP message of transaction(PRIZE_ENQUIRY)
[2015-05-29 17:13:47,953][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:47,953][Test worker][DEBUG][ProtocolSerializer] Start to serialize model(class com.mpos.lottery.te.gamespec.prize.web.PrizeDto),mappingFile=xml-mapping/game/union/EnquiryPrize_Res.xml
[2015-05-29 17:13:47,953][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:47,954][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gamespec.prize.web.PrizeDto, mappingFile=xml-mapping/game/union/EnquiryPrize_Res.xml).
[2015-05-29 17:13:47,954][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890827882|Timestamp:20150529171347|Transaction-Type:4301|Transaction-Id:0115052900000000002230|Response-Code:200|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Prize mode=&quot;1&quot; prizeAmount=&quot;7232000&quot; taxAmount=&quot;1205333.34&quot; actualAmount=&quot;6026666.66&quot; luckyAmount=&quot;0&quot; isVerifyPIN=&quot;1&quot;&gt;&lt;Ticket serialNo=&quot;S-123456&quot; totalAmount=&quot;7500.3&quot;/&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090401&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;7&quot; prizeAmount=&quot;3000&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;1&quot; prizeAmount=&quot;5000000&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;1&quot;/&gt;&lt;Winning level=&quot;5&quot; prizeAmount=&quot;10000&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;/PrizeItem&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090403&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;2&quot; prizeAmount=&quot;1000000&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;Winning level=&quot;4&quot; prizeAmount=&quot;50000&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;8&quot; prizeAmount=&quot;0&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;3&quot;/&gt;&lt;/PrizeItem&gt;&lt;/Prize&gt;):6b314cdba849616aab96beb9523ea114
[2015-05-29 17:13:47,955][Test worker][DEBUG][TEPortServlet] Write response to client(host1=localhost,sizeOfPack=1228) succesfully.
[2015-05-29 17:13:47,955][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=1228): &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Prize mode=&quot;1&quot; prizeAmount=&quot;7232000&quot; taxAmount=&quot;1205333.34&quot; actualAmount=&quot;6026666.66&quot; luckyAmount=&quot;0&quot; isVerifyPIN=&quot;1&quot;&gt;&lt;Ticket serialNo=&quot;S-123456&quot; totalAmount=&quot;7500.3&quot;/&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090401&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;7&quot; prizeAmount=&quot;3000&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;1&quot; prizeAmount=&quot;5000000&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;1&quot;/&gt;&lt;Winning level=&quot;5&quot; prizeAmount=&quot;10000&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;/PrizeItem&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090403&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;2&quot; prizeAmount=&quot;1000000&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;Winning level=&quot;4&quot; prizeAmount=&quot;50000&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;8&quot; prizeAmount=&quot;0&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;3&quot;/&gt;&lt;/PrizeItem&gt;&lt;/Prize&gt;
[2015-05-29 17:13:47,955][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:47,967][Test worker][DEBUG][TEPortServlet] Startup job scheduer(org.quartz.impl.StdScheduler@4d1e5820) successfully.
[2015-05-29 17:13:47,968][Test worker][WARN ][TEPortServlet] can NOT find META file:F:\project\M.Lottery\TE\TRUNK_TE\sourcecode\build\classes\main\META-INF\MANIFEST.MF
[2015-05-29 17:13:47,968][Test worker][DEBUG][TEPortServlet] Register MBean(com.mpos.lottery.te.common.jmx.TransactionTimeout@2aec909c) with name(com.mpos.lottery.te:type=TransactionTimeoutMBean) successfully.
[2015-05-29 17:13:47,968][Test worker][DEBUG][BaseTransactionalIntegrationTest] Retrieve a ApplicationContext(org.springframework.web.context.support.GenericWebApplicationContext@34f645a8: startup date [Fri May 29 17:12:38 CST 2015]; root of context hierarchy).
[2015-05-29 17:13:47,968][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:47,968][Test worker][INFO ][BaseTransactionalIntegrationTest] | UnionPrizeEnquiryIntegrationTest.testEnquiry_WIN_TaxWhenPayout_PrintNewTicket                                          |
[2015-05-29 17:13:47,968][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:47,974][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:47,974][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.union.sale.UnionTicket, mappingFile=xml-mapping/game/union/EnquiryPrize_Req.xml).
[2015-05-29 17:13:47,975][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890827974|Timestamp:20150529171347|Transaction-Type:301|Transaction-Id:|Response-Code:|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;,hash=-1165613314), get digest:5333737925136828932efbda7a11ec9d
[2015-05-29 17:13:47,975][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=301).
[2015-05-29 17:13:47,975][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:47,975][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171347).
[2015-05-29 17:13:47,975][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:47,975][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890827974).
[2015-05-29 17:13:47,975][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:47,975][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:47,975][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=5333737925136828932efbda7a11ec9d).
[2015-05-29 17:13:47,975][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=8).
[2015-05-29 17:13:47,975][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:47,975][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:47,977][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6ttFDFcpmi1MamgAomcAmY7ZtCcdDkhkRrCXDK2x4EDMo0KLMTKd7D9/oiuZDONWBtcYexf6q8QR.
[2015-05-29 17:13:47,977][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890827974|Timestamp:20150529171347|Transaction-Type:301|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:47,977][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;
[2015-05-29 17:13:47,977][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890827974|Timestamp:20150529171347|Transaction-Type:301|Transaction-Id:|Response-Code:|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;,hash=-1165613314), get digest:5333737925136828932efbda7a11ec9d
[2015-05-29 17:13:47,977][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:47,977][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/union/EnquiryPrize_Req.xml
[2015-05-29 17:13:47,977][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:48,002][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(8_301_1.5.0).
[2015-05-29 17:13:48,002][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(8_301_).
[2015-05-29 17:13:48,002][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(8_301_), found controller(com.mpos.lottery.te.gameimpl.union.UnionController@f81b221) and method(public void com.mpos.lottery.te.gameimpl.union.UnionController.enquiryPrize(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:48,002][Test worker][DEBUG][AbstractPrizeService] Enquiry prize information of ticket:9pkxn/npytVqVbOF5fPlsg==
[2015-05-29 17:13:48,029][Test worker][DEBUG][DefaultTaxService] Calculate tax for amount:3000 based on threshold(com.mpos.lottery.te.gamespec.prize.TaxThreshold@1a8d44bd[id=WTT-1,taxPolicyId=TP-1,taxDateRange=com.mpos.lottery.te.gamespec.prize.TaxDateRange@7234b470[id=TDR-1,beginDate=2009-03-20 21:00:00.0,endDate=2099-03-20 21:00:00.0],minAmount=1000,maxAmount=9999999999,ruleType=1,taxAmount=0.2,taxBase=1])...tax:500.00
[2015-05-29 17:13:48,033][Test worker][DEBUG][DefaultTaxService] Calculate tax for amount:5000000 based on threshold(com.mpos.lottery.te.gamespec.prize.TaxThreshold@1a8d44bd[id=WTT-1,taxPolicyId=TP-1,taxDateRange=com.mpos.lottery.te.gamespec.prize.TaxDateRange@7234b470[id=TDR-1,beginDate=2009-03-20 21:00:00.0,endDate=2099-03-20 21:00:00.0],minAmount=1000,maxAmount=9999999999,ruleType=1,taxAmount=0.2,taxBase=1])...tax:833333.33
[2015-05-29 17:13:48,039][Test worker][DEBUG][DefaultTaxService] Calculate tax for amount:10000 based on threshold(com.mpos.lottery.te.gamespec.prize.TaxThreshold@1a8d44bd[id=WTT-1,taxPolicyId=TP-1,taxDateRange=com.mpos.lottery.te.gamespec.prize.TaxDateRange@7234b470[id=TDR-1,beginDate=2009-03-20 21:00:00.0,endDate=2099-03-20 21:00:00.0],minAmount=1000,maxAmount=9999999999,ruleType=1,taxAmount=0.2,taxBase=1])...tax:1666.67
[2015-05-29 17:13:48,048][Test worker][DEBUG][DefaultTaxService] Calculate tax for amount:1000000 based on threshold(com.mpos.lottery.te.gamespec.prize.TaxThreshold@1a8d44bd[id=WTT-1,taxPolicyId=TP-1,taxDateRange=com.mpos.lottery.te.gamespec.prize.TaxDateRange@7234b470[id=TDR-1,beginDate=2009-03-20 21:00:00.0,endDate=2099-03-20 21:00:00.0],minAmount=1000,maxAmount=9999999999,ruleType=1,taxAmount=0.2,taxBase=1])...tax:166666.67
[2015-05-29 17:13:48,053][Test worker][DEBUG][DefaultTaxService] Calculate tax for amount:50000 based on threshold(com.mpos.lottery.te.gamespec.prize.TaxThreshold@1a8d44bd[id=WTT-1,taxPolicyId=TP-1,taxDateRange=com.mpos.lottery.te.gamespec.prize.TaxDateRange@7234b470[id=TDR-1,beginDate=2009-03-20 21:00:00.0,endDate=2099-03-20 21:00:00.0],minAmount=1000,maxAmount=9999999999,ruleType=1,taxAmount=0.2,taxBase=1])...tax:8333.33
[2015-05-29 17:13:48,059][Test worker][DEBUG][DefaultTaxService] Calculate tax for amount:50000 based on threshold(com.mpos.lottery.te.gamespec.prize.TaxThreshold@1a8d44bd[id=WTT-1,taxPolicyId=TP-1,taxDateRange=com.mpos.lottery.te.gamespec.prize.TaxDateRange@7234b470[id=TDR-1,beginDate=2009-03-20 21:00:00.0,endDate=2099-03-20 21:00:00.0],minAmount=1000,maxAmount=9999999999,ruleType=1,taxAmount=0.2,taxBase=1])...tax:8333.33
[2015-05-29 17:13:48,064][Test worker][DEBUG][AbstractPrizeService] Handle winnings of lucky draw of ticket(serialNo:9pkxn/npytVqVbOF5fPlsg==), total 0 winning items found.
[2015-05-29 17:13:48,070][Test worker][DEBUG][CommonFacadeService] No need to publish AMQP message of transaction(PRIZE_ENQUIRY)
[2015-05-29 17:13:48,071][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:48,071][Test worker][DEBUG][ProtocolSerializer] Start to serialize model(class com.mpos.lottery.te.gamespec.prize.web.PrizeDto),mappingFile=xml-mapping/game/union/EnquiryPrize_Res.xml
[2015-05-29 17:13:48,071][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:48,072][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gamespec.prize.web.PrizeDto, mappingFile=xml-mapping/game/union/EnquiryPrize_Res.xml).
[2015-05-29 17:13:48,072][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890827974|Timestamp:20150529171347|Transaction-Type:4301|Transaction-Id:0115052900000000002231|Response-Code:200|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Prize mode=&quot;1&quot; prizeAmount=&quot;7232000&quot; taxAmount=&quot;1205333.33&quot; actualAmount=&quot;6026666.67&quot; luckyAmount=&quot;0&quot; isVerifyPIN=&quot;1&quot;&gt;&lt;Ticket serialNo=&quot;S-123456&quot; totalAmount=&quot;7500.3&quot;/&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090401&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;7&quot; prizeAmount=&quot;3000&quot; taxAmount=&quot;500.00&quot; actualAmount=&quot;2500.00&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;1&quot; prizeAmount=&quot;5000000&quot; taxAmount=&quot;833333.33&quot; actualAmount=&quot;4166666.67&quot; numberOfPrize=&quot;1&quot;/&gt;&lt;Winning level=&quot;5&quot; prizeAmount=&quot;10000&quot; taxAmount=&quot;1666.67&quot; actualAmount=&quot;8333.33&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;/PrizeItem&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090403&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;2&quot; prizeAmount=&quot;1000000&quot; taxAmount=&quot;166666.67&quot; actualAmount=&quot;833333.33&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;Winning level=&quot;4&quot; prizeAmount=&quot;50000&quot; taxAmount=&quot;8333.33&quot; actualAmount=&quot;41666.67&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;8&quot; prizeAmount=&quot;0&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;3&quot;/&gt;&lt;/PrizeItem&gt;&lt;/Prize&gt;):9ee88ca5f93a5409f84cb4c850f9c804
[2015-05-29 17:13:48,072][Test worker][DEBUG][TEPortServlet] Write response to client(host1=localhost,sizeOfPack=1324) succesfully.
[2015-05-29 17:13:48,073][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=1324): &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Prize mode=&quot;1&quot; prizeAmount=&quot;7232000&quot; taxAmount=&quot;1205333.33&quot; actualAmount=&quot;6026666.67&quot; luckyAmount=&quot;0&quot; isVerifyPIN=&quot;1&quot;&gt;&lt;Ticket serialNo=&quot;S-123456&quot; totalAmount=&quot;7500.3&quot;/&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090401&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;7&quot; prizeAmount=&quot;3000&quot; taxAmount=&quot;500.00&quot; actualAmount=&quot;2500.00&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;1&quot; prizeAmount=&quot;5000000&quot; taxAmount=&quot;833333.33&quot; actualAmount=&quot;4166666.67&quot; numberOfPrize=&quot;1&quot;/&gt;&lt;Winning level=&quot;5&quot; prizeAmount=&quot;10000&quot; taxAmount=&quot;1666.67&quot; actualAmount=&quot;8333.33&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;/PrizeItem&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090403&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;2&quot; prizeAmount=&quot;1000000&quot; taxAmount=&quot;166666.67&quot; actualAmount=&quot;833333.33&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;Winning level=&quot;4&quot; prizeAmount=&quot;50000&quot; taxAmount=&quot;8333.33&quot; actualAmount=&quot;41666.67&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;8&quot; prizeAmount=&quot;0&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;3&quot;/&gt;&lt;/PrizeItem&gt;&lt;/Prize&gt;
[2015-05-29 17:13:48,073][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:48,088][Test worker][DEBUG][TEPortServlet] Startup job scheduer(org.quartz.impl.StdScheduler@4d1e5820) successfully.
[2015-05-29 17:13:48,089][Test worker][WARN ][TEPortServlet] can NOT find META file:F:\project\M.Lottery\TE\TRUNK_TE\sourcecode\build\classes\main\META-INF\MANIFEST.MF
[2015-05-29 17:13:48,089][Test worker][DEBUG][TEPortServlet] Register MBean(com.mpos.lottery.te.common.jmx.TransactionTimeout@72d829ca) with name(com.mpos.lottery.te:type=TransactionTimeoutMBean) successfully.
[2015-05-29 17:13:48,089][Test worker][DEBUG][BaseTransactionalIntegrationTest] Retrieve a ApplicationContext(org.springframework.web.context.support.GenericWebApplicationContext@34f645a8: startup date [Fri May 29 17:12:38 CST 2015]; root of context hierarchy).
[2015-05-29 17:13:48,089][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:48,089][Test worker][INFO ][BaseTransactionalIntegrationTest] | UnionPrizeEnquiryIntegrationTest.testEnquiry_NoWIN_PrintNewTicket                                                      |
[2015-05-29 17:13:48,089][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:48,094][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:48,095][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.union.sale.UnionTicket, mappingFile=xml-mapping/game/union/EnquiryPrize_Req.xml).
[2015-05-29 17:13:48,095][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890828094|Timestamp:20150529171348|Transaction-Type:301|Transaction-Id:|Response-Code:|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;,hash=-1689296143), get digest:a89169fba78943684a312c3f276bd613
[2015-05-29 17:13:48,095][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=301).
[2015-05-29 17:13:48,095][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:48,095][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171348).
[2015-05-29 17:13:48,095][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:48,096][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890828094).
[2015-05-29 17:13:48,096][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:48,096][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:48,096][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=a89169fba78943684a312c3f276bd613).
[2015-05-29 17:13:48,096][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=8).
[2015-05-29 17:13:48,096][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:48,096][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:48,097][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6ttFDFcpmi1MamgAomcAmY7ZtCcdDkhkRrCXDK2x4EDMo0KLMTKd7D9/oiuZDONWBtcYexf6q8QR.
[2015-05-29 17:13:48,097][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890828094|Timestamp:20150529171348|Transaction-Type:301|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:48,098][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;
[2015-05-29 17:13:48,098][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890828094|Timestamp:20150529171348|Transaction-Type:301|Transaction-Id:|Response-Code:|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;,hash=-1689296143), get digest:a89169fba78943684a312c3f276bd613
[2015-05-29 17:13:48,098][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:48,098][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/union/EnquiryPrize_Req.xml
[2015-05-29 17:13:48,098][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:48,126][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(8_301_1.5.0).
[2015-05-29 17:13:48,126][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(8_301_).
[2015-05-29 17:13:48,126][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(8_301_), found controller(com.mpos.lottery.te.gameimpl.union.UnionController@f81b221) and method(public void com.mpos.lottery.te.gameimpl.union.UnionController.enquiryPrize(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:48,126][Test worker][DEBUG][AbstractPrizeService] Enquiry prize information of ticket:9pkxn/npytVqVbOF5fPlsg==
[2015-05-29 17:13:48,159][Test worker][DEBUG][AbstractPrizeService] Handle winnings of lucky draw of ticket(serialNo:9pkxn/npytVqVbOF5fPlsg==), total 0 winning items found.
[2015-05-29 17:13:48,166][Test worker][DEBUG][CommonFacadeService] No need to publish AMQP message of transaction(PRIZE_ENQUIRY)
[2015-05-29 17:13:48,166][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:48,166][Test worker][DEBUG][ProtocolSerializer] Start to serialize model(class com.mpos.lottery.te.gamespec.prize.web.PrizeDto),mappingFile=xml-mapping/game/union/EnquiryPrize_Res.xml
[2015-05-29 17:13:48,166][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:48,167][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gamespec.prize.web.PrizeDto, mappingFile=xml-mapping/game/union/EnquiryPrize_Res.xml).
[2015-05-29 17:13:48,167][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890828094|Timestamp:20150529171348|Transaction-Type:4301|Transaction-Id:0115052900000000002232|Response-Code:200|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Prize mode=&quot;1&quot; prizeAmount=&quot;0&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; luckyAmount=&quot;0&quot; isVerifyPIN=&quot;1&quot;&gt;&lt;Ticket serialNo=&quot;S-123456&quot; totalAmount=&quot;7500.3&quot;/&gt;&lt;/Prize&gt;):c77471a690f083ec3eeff4b9e2064008
[2015-05-29 17:13:48,167][Test worker][DEBUG][TEPortServlet] Write response to client(host1=localhost,sizeOfPack=268) succesfully.
[2015-05-29 17:13:48,168][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=268): &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Prize mode=&quot;1&quot; prizeAmount=&quot;0&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; luckyAmount=&quot;0&quot; isVerifyPIN=&quot;1&quot;&gt;&lt;Ticket serialNo=&quot;S-123456&quot; totalAmount=&quot;7500.3&quot;/&gt;&lt;/Prize&gt;
[2015-05-29 17:13:48,168][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:48,179][Test worker][DEBUG][TEPortServlet] Startup job scheduer(org.quartz.impl.StdScheduler@4d1e5820) successfully.
[2015-05-29 17:13:48,179][Test worker][WARN ][TEPortServlet] can NOT find META file:F:\project\M.Lottery\TE\TRUNK_TE\sourcecode\build\classes\main\META-INF\MANIFEST.MF
[2015-05-29 17:13:48,179][Test worker][DEBUG][TEPortServlet] Register MBean(com.mpos.lottery.te.common.jmx.TransactionTimeout@5bfb9581) with name(com.mpos.lottery.te:type=TransactionTimeoutMBean) successfully.
[2015-05-29 17:13:48,180][Test worker][DEBUG][BaseTransactionalIntegrationTest] Retrieve a ApplicationContext(org.springframework.web.context.support.GenericWebApplicationContext@34f645a8: startup date [Fri May 29 17:12:38 CST 2015]; root of context hierarchy).
[2015-05-29 17:13:48,180][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:48,180][Test worker][INFO ][BaseTransactionalIntegrationTest] | UnionPrizeEnquiryIntegrationTest.testEnquiry_WIN_TaxWhenPayout_BasePerTIcket_PrintNewTicket_LuckyDraw                  |
[2015-05-29 17:13:48,180][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:48,185][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:48,185][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.union.sale.UnionTicket, mappingFile=xml-mapping/game/union/EnquiryPrize_Req.xml).
[2015-05-29 17:13:48,186][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890828185|Timestamp:20150529171348|Transaction-Type:301|Transaction-Id:|Response-Code:|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;,hash=1730411220), get digest:65efc6d9bc9f27ad009ac320ad36d58d
[2015-05-29 17:13:48,186][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=301).
[2015-05-29 17:13:48,186][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:48,186][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171348).
[2015-05-29 17:13:48,186][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:48,186][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890828185).
[2015-05-29 17:13:48,186][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:48,186][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:48,186][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=65efc6d9bc9f27ad009ac320ad36d58d).
[2015-05-29 17:13:48,186][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=8).
[2015-05-29 17:13:48,186][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:48,186][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:48,189][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6ttFDFcpmi1MamgAomcAmY7ZtCcdDkhkRrCXDK2x4EDMo0KLMTKd7D9/oiuZDONWBtcYexf6q8QR.
[2015-05-29 17:13:48,189][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890828185|Timestamp:20150529171348|Transaction-Type:301|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:48,189][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;
[2015-05-29 17:13:48,190][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890828185|Timestamp:20150529171348|Transaction-Type:301|Transaction-Id:|Response-Code:|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;,hash=1730411220), get digest:65efc6d9bc9f27ad009ac320ad36d58d
[2015-05-29 17:13:48,190][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:48,190][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/union/EnquiryPrize_Req.xml
[2015-05-29 17:13:48,190][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:48,208][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(8_301_1.5.0).
[2015-05-29 17:13:48,208][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(8_301_).
[2015-05-29 17:13:48,208][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(8_301_), found controller(com.mpos.lottery.te.gameimpl.union.UnionController@f81b221) and method(public void com.mpos.lottery.te.gameimpl.union.UnionController.enquiryPrize(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:48,208][Test worker][DEBUG][AbstractPrizeService] Enquiry prize information of ticket:9pkxn/npytVqVbOF5fPlsg==
[2015-05-29 17:13:48,235][Test worker][DEBUG][DefaultTaxService] Calculate tax for amount:5032000 based on threshold(com.mpos.lottery.te.gamespec.prize.TaxThreshold@1bd27ef8[id=WTT-1,taxPolicyId=TP-1,taxDateRange=com.mpos.lottery.te.gamespec.prize.TaxDateRange@8e69813[id=TDR-1,beginDate=2009-03-20 21:00:00.0,endDate=2099-03-20 21:00:00.0],minAmount=1000,maxAmount=9999999999,ruleType=1,taxAmount=0.2,taxBase=1])...tax:838666.67
[2015-05-29 17:13:48,253][Test worker][DEBUG][DefaultTaxService] Calculate tax for amount:2200000 based on threshold(com.mpos.lottery.te.gamespec.prize.TaxThreshold@1bd27ef8[id=WTT-1,taxPolicyId=TP-1,taxDateRange=com.mpos.lottery.te.gamespec.prize.TaxDateRange@8e69813[id=TDR-1,beginDate=2009-03-20 21:00:00.0,endDate=2099-03-20 21:00:00.0],minAmount=1000,maxAmount=9999999999,ruleType=1,taxAmount=0.2,taxBase=1])...tax:366666.67
[2015-05-29 17:13:48,257][Test worker][DEBUG][AbstractPrizeService] Handle winnings of lucky draw of ticket(serialNo:9pkxn/npytVqVbOF5fPlsg==), total 2 winning items found.
[2015-05-29 17:13:48,276][Test worker][DEBUG][DefaultTaxService] Calculate tax for amount:2800000 based on threshold(com.mpos.lottery.te.gamespec.prize.TaxThreshold@1bd27ef8[id=WTT-1,taxPolicyId=TP-1,taxDateRange=com.mpos.lottery.te.gamespec.prize.TaxDateRange@8e69813[id=TDR-1,beginDate=2009-03-20 21:00:00.0,endDate=2099-03-20 21:00:00.0],minAmount=1000,maxAmount=9999999999,ruleType=1,taxAmount=0.2,taxBase=1])...tax:466666.67
[2015-05-29 17:13:48,285][Test worker][DEBUG][CommonFacadeService] No need to publish AMQP message of transaction(PRIZE_ENQUIRY)
[2015-05-29 17:13:48,285][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:48,285][Test worker][DEBUG][ProtocolSerializer] Start to serialize model(class com.mpos.lottery.te.gamespec.prize.web.PrizeDto),mappingFile=xml-mapping/game/union/EnquiryPrize_Res.xml
[2015-05-29 17:13:48,285][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:48,286][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gamespec.prize.web.PrizeDto, mappingFile=xml-mapping/game/union/EnquiryPrize_Res.xml).
[2015-05-29 17:13:48,287][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890828185|Timestamp:20150529171348|Transaction-Type:4301|Transaction-Id:0115052900000000002233|Response-Code:200|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Prize mode=&quot;1&quot; prizeAmount=&quot;10032000&quot; taxAmount=&quot;1672000.01&quot; actualAmount=&quot;8359999.99&quot; luckyAmount=&quot;8000.00&quot; isVerifyPIN=&quot;1&quot;&gt;&lt;Ticket serialNo=&quot;S-123456&quot; totalAmount=&quot;7500.3&quot;/&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090401&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;7&quot; prizeAmount=&quot;3000&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;1&quot; prizeAmount=&quot;5000000&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;1&quot;/&gt;&lt;Winning level=&quot;5&quot; prizeAmount=&quot;10000&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;/PrizeItem&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090403&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;2&quot; prizeAmount=&quot;1000000&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;Winning level=&quot;4&quot; prizeAmount=&quot;50000&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;8&quot; prizeAmount=&quot;0&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;3&quot;/&gt;&lt;/PrizeItem&gt;&lt;PrizeItem type=&quot;2&quot;&gt;&lt;GameDraw number=&quot;001&quot; gameId=&quot;LD-1&quot;/&gt;&lt;Winning level=&quot;1&quot; prizeAmount=&quot;400000&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;Winning level=&quot;4&quot; prizeAmount=&quot;1000000&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;2&quot;&gt;&lt;PrizeObject name=&quot;Sony Camera&quot; count=&quot;2&quot; taxAmount=&quot;500&quot; price=&quot;2000&quot;/&gt;&lt;/Winning&gt;&lt;/PrizeItem&gt;&lt;/Prize&gt;):8a3cbfa7f61d406ea54fdc2a70608b37
[2015-05-29 17:13:48,287][Test worker][DEBUG][TEPortServlet] Write response to client(host1=localhost,sizeOfPack=1688) succesfully.
[2015-05-29 17:13:48,288][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=1688): &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Prize mode=&quot;1&quot; prizeAmount=&quot;10032000&quot; taxAmount=&quot;1672000.01&quot; actualAmount=&quot;8359999.99&quot; luckyAmount=&quot;8000.00&quot; isVerifyPIN=&quot;1&quot;&gt;&lt;Ticket serialNo=&quot;S-123456&quot; totalAmount=&quot;7500.3&quot;/&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090401&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;7&quot; prizeAmount=&quot;3000&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;1&quot; prizeAmount=&quot;5000000&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;1&quot;/&gt;&lt;Winning level=&quot;5&quot; prizeAmount=&quot;10000&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;/PrizeItem&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090403&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;2&quot; prizeAmount=&quot;1000000&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;Winning level=&quot;4&quot; prizeAmount=&quot;50000&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;8&quot; prizeAmount=&quot;0&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;3&quot;/&gt;&lt;/PrizeItem&gt;&lt;PrizeItem type=&quot;2&quot;&gt;&lt;GameDraw number=&quot;001&quot; gameId=&quot;LD-1&quot;/&gt;&lt;Winning level=&quot;1&quot; prizeAmount=&quot;400000&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;Winning level=&quot;4&quot; prizeAmount=&quot;1000000&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;2&quot;&gt;&lt;PrizeObject name=&quot;Sony Camera&quot; count=&quot;2&quot; taxAmount=&quot;500&quot; price=&quot;2000&quot;/&gt;&lt;/Winning&gt;&lt;/PrizeItem&gt;&lt;/Prize&gt;
[2015-05-29 17:13:48,288][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:48,311][Test worker][DEBUG][TEPortServlet] Startup job scheduer(org.quartz.impl.StdScheduler@4d1e5820) successfully.
[2015-05-29 17:13:48,311][Test worker][WARN ][TEPortServlet] can NOT find META file:F:\project\M.Lottery\TE\TRUNK_TE\sourcecode\build\classes\main\META-INF\MANIFEST.MF
[2015-05-29 17:13:48,311][Test worker][DEBUG][TEPortServlet] Register MBean(com.mpos.lottery.te.common.jmx.TransactionTimeout@40bdc93d) with name(com.mpos.lottery.te:type=TransactionTimeoutMBean) successfully.
[2015-05-29 17:13:48,312][Test worker][DEBUG][BaseTransactionalIntegrationTest] Retrieve a ApplicationContext(org.springframework.web.context.support.GenericWebApplicationContext@34f645a8: startup date [Fri May 29 17:12:38 CST 2015]; root of context hierarchy).
[2015-05-29 17:13:48,312][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:48,312][Test worker][INFO ][BaseTransactionalIntegrationTest] | UnionPrizeEnquiryIntegrationTest.testEnquiry_NoWIN_PrintNewTicket_LuckyDraw                                            |
[2015-05-29 17:13:48,312][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:48,320][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:48,320][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.union.sale.UnionTicket, mappingFile=xml-mapping/game/union/EnquiryPrize_Req.xml).
[2015-05-29 17:13:48,321][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890828320|Timestamp:20150529171348|Transaction-Type:301|Transaction-Id:|Response-Code:|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;,hash=-1700745769), get digest:c5e69fb2f111a98ba05e75929538fd0e
[2015-05-29 17:13:48,321][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=301).
[2015-05-29 17:13:48,321][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:48,321][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171348).
[2015-05-29 17:13:48,321][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:48,321][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890828320).
[2015-05-29 17:13:48,321][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:48,321][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:48,321][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=c5e69fb2f111a98ba05e75929538fd0e).
[2015-05-29 17:13:48,321][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=8).
[2015-05-29 17:13:48,321][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:48,321][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:48,323][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6ttFDFcpmi1MamgAomcAmY7ZtCcdDkhkRrCXDK2x4EDMo0KLMTKd7D9/oiuZDONWBtcYexf6q8QR.
[2015-05-29 17:13:48,323][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890828320|Timestamp:20150529171348|Transaction-Type:301|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:48,323][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;
[2015-05-29 17:13:48,323][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890828320|Timestamp:20150529171348|Transaction-Type:301|Transaction-Id:|Response-Code:|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;,hash=-1700745769), get digest:c5e69fb2f111a98ba05e75929538fd0e
[2015-05-29 17:13:48,323][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:48,323][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/union/EnquiryPrize_Req.xml
[2015-05-29 17:13:48,323][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:48,342][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(8_301_1.5.0).
[2015-05-29 17:13:48,342][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(8_301_).
[2015-05-29 17:13:48,342][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(8_301_), found controller(com.mpos.lottery.te.gameimpl.union.UnionController@f81b221) and method(public void com.mpos.lottery.te.gameimpl.union.UnionController.enquiryPrize(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:48,342][Test worker][DEBUG][AbstractPrizeService] Enquiry prize information of ticket:9pkxn/npytVqVbOF5fPlsg==
[2015-05-29 17:13:48,367][Test worker][DEBUG][AbstractPrizeService] Handle winnings of lucky draw of ticket(serialNo:9pkxn/npytVqVbOF5fPlsg==), total 2 winning items found.
[2015-05-29 17:13:48,381][Test worker][DEBUG][DefaultTaxService] Calculate tax for amount:400000 based on threshold(com.mpos.lottery.te.gamespec.prize.TaxThreshold@59fd9c94[id=WTT-1,taxPolicyId=TP-1,taxDateRange=com.mpos.lottery.te.gamespec.prize.TaxDateRange@cdcd468[id=TDR-1,beginDate=2009-03-20 21:00:00.0,endDate=2099-03-20 21:00:00.0],minAmount=1000,maxAmount=9999999999,ruleType=1,taxAmount=0.2,taxBase=1])...tax:66666.67
[2015-05-29 17:13:48,388][Test worker][DEBUG][DefaultTaxService] Calculate tax for amount:1000000 based on threshold(com.mpos.lottery.te.gamespec.prize.TaxThreshold@59fd9c94[id=WTT-1,taxPolicyId=TP-1,taxDateRange=com.mpos.lottery.te.gamespec.prize.TaxDateRange@cdcd468[id=TDR-1,beginDate=2009-03-20 21:00:00.0,endDate=2099-03-20 21:00:00.0],minAmount=1000,maxAmount=9999999999,ruleType=1,taxAmount=0.2,taxBase=1])...tax:166666.67
[2015-05-29 17:13:48,401][Test worker][DEBUG][CommonFacadeService] No need to publish AMQP message of transaction(PRIZE_ENQUIRY)
[2015-05-29 17:13:48,401][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:48,401][Test worker][DEBUG][ProtocolSerializer] Start to serialize model(class com.mpos.lottery.te.gamespec.prize.web.PrizeDto),mappingFile=xml-mapping/game/union/EnquiryPrize_Res.xml
[2015-05-29 17:13:48,401][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:48,402][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gamespec.prize.web.PrizeDto, mappingFile=xml-mapping/game/union/EnquiryPrize_Res.xml).
[2015-05-29 17:13:48,402][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890828320|Timestamp:20150529171348|Transaction-Type:4301|Transaction-Id:0115052900000000002234|Response-Code:200|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Prize mode=&quot;1&quot; prizeAmount=&quot;2800000&quot; taxAmount=&quot;466666.68&quot; actualAmount=&quot;2333333.32&quot; luckyAmount=&quot;8000.00&quot; isVerifyPIN=&quot;1&quot;&gt;&lt;Ticket serialNo=&quot;S-123456&quot; totalAmount=&quot;7500.3&quot;/&gt;&lt;PrizeItem type=&quot;2&quot;&gt;&lt;GameDraw number=&quot;001&quot; gameId=&quot;LD-1&quot;/&gt;&lt;Winning level=&quot;1&quot; prizeAmount=&quot;400000&quot; taxAmount=&quot;66666.67&quot; actualAmount=&quot;333333.33&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;Winning level=&quot;4&quot; prizeAmount=&quot;1000000&quot; taxAmount=&quot;166666.67&quot; actualAmount=&quot;833333.33&quot; numberOfPrize=&quot;2&quot;&gt;&lt;PrizeObject name=&quot;Sony Camera&quot; count=&quot;2&quot; taxAmount=&quot;500&quot; price=&quot;2000&quot;/&gt;&lt;/Winning&gt;&lt;/PrizeItem&gt;&lt;/Prize&gt;):7fce0d39510467574d52d5501636720f
[2015-05-29 17:13:48,403][Test worker][DEBUG][TEPortServlet] Write response to client(host1=localhost,sizeOfPack=792) succesfully.
[2015-05-29 17:13:48,403][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=792): &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Prize mode=&quot;1&quot; prizeAmount=&quot;2800000&quot; taxAmount=&quot;466666.68&quot; actualAmount=&quot;2333333.32&quot; luckyAmount=&quot;8000.00&quot; isVerifyPIN=&quot;1&quot;&gt;&lt;Ticket serialNo=&quot;S-123456&quot; totalAmount=&quot;7500.3&quot;/&gt;&lt;PrizeItem type=&quot;2&quot;&gt;&lt;GameDraw number=&quot;001&quot; gameId=&quot;LD-1&quot;/&gt;&lt;Winning level=&quot;1&quot; prizeAmount=&quot;400000&quot; taxAmount=&quot;66666.67&quot; actualAmount=&quot;333333.33&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;Winning level=&quot;4&quot; prizeAmount=&quot;1000000&quot; taxAmount=&quot;166666.67&quot; actualAmount=&quot;833333.33&quot; numberOfPrize=&quot;2&quot;&gt;&lt;PrizeObject name=&quot;Sony Camera&quot; count=&quot;2&quot; taxAmount=&quot;500&quot; price=&quot;2000&quot;/&gt;&lt;/Winning&gt;&lt;/PrizeItem&gt;&lt;/Prize&gt;
[2015-05-29 17:13:48,403][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:48,423][Test worker][DEBUG][TEPortServlet] Startup job scheduer(org.quartz.impl.StdScheduler@4d1e5820) successfully.
[2015-05-29 17:13:48,423][Test worker][WARN ][TEPortServlet] can NOT find META file:F:\project\M.Lottery\TE\TRUNK_TE\sourcecode\build\classes\main\META-INF\MANIFEST.MF
[2015-05-29 17:13:48,423][Test worker][DEBUG][TEPortServlet] Register MBean(com.mpos.lottery.te.common.jmx.TransactionTimeout@71681086) with name(com.mpos.lottery.te:type=TransactionTimeoutMBean) successfully.
[2015-05-29 17:13:48,423][Test worker][DEBUG][BaseTransactionalIntegrationTest] Retrieve a ApplicationContext(org.springframework.web.context.support.GenericWebApplicationContext@34f645a8: startup date [Fri May 29 17:12:38 CST 2015]; root of context hierarchy).
[2015-05-29 17:13:48,424][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:48,424][Test worker][INFO ][BaseTransactionalIntegrationTest] | UnionPrizeEnquiryIntegrationTest.testEnquiry_WIN_TaxWhenAnalysis_PrintNewTicket_ByBarcode                              |
[2015-05-29 17:13:48,424][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:48,428][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:48,429][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.union.sale.UnionTicket, mappingFile=xml-mapping/game/union/EnquiryPrize_Req.xml).
[2015-05-29 17:13:48,430][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890828428|Timestamp:20150529171348|Transaction-Type:301|Transaction-Id:|Response-Code:|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket barcode=&quot;01cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt/ITKo3ngns+4pjWl52Uuv1&quot;/&gt;,hash=236155281), get digest:dbec288661c5d1f5c6beea2a651822f8
[2015-05-29 17:13:48,430][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=301).
[2015-05-29 17:13:48,430][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:48,430][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171348).
[2015-05-29 17:13:48,430][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:48,430][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890828428).
[2015-05-29 17:13:48,430][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:48,430][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:48,430][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=dbec288661c5d1f5c6beea2a651822f8).
[2015-05-29 17:13:48,430][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=8).
[2015-05-29 17:13:48,430][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:48,430][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:48,433][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6r42vivt1ydaNhhFpbZNUp42HNXzX244La5E2YGnt/yXdbBW+DIjtmX/HGUbtcvEDGZoWJ8PJ7qeTKcfwxMJS2QJhO0ZKSu5YhQ3MpmM9/VB5DX4Bhuc4A8=.
[2015-05-29 17:13:48,433][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890828428|Timestamp:20150529171348|Transaction-Type:301|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:48,433][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket barcode=&quot;01cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt/ITKo3ngns+4pjWl52Uuv1&quot;/&gt;
[2015-05-29 17:13:48,433][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890828428|Timestamp:20150529171348|Transaction-Type:301|Transaction-Id:|Response-Code:|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket barcode=&quot;01cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt/ITKo3ngns+4pjWl52Uuv1&quot;/&gt;,hash=236155281), get digest:dbec288661c5d1f5c6beea2a651822f8
[2015-05-29 17:13:48,434][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:48,434][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/union/EnquiryPrize_Req.xml
[2015-05-29 17:13:48,434][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:48,457][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(8_301_1.5.0).
[2015-05-29 17:13:48,457][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(8_301_).
[2015-05-29 17:13:48,457][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(8_301_), found controller(com.mpos.lottery.te.gameimpl.union.UnionController@f81b221) and method(public void com.mpos.lottery.te.gameimpl.union.UnionController.enquiryPrize(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:48,457][Test worker][DEBUG][AbstractPrizeService] Enquiry prize information of ticket:9pkxn/npytVqVbOF5fPlsg==
[2015-05-29 17:13:48,510][Test worker][DEBUG][AbstractPrizeService] Handle winnings of lucky draw of ticket(serialNo:9pkxn/npytVqVbOF5fPlsg==), total 0 winning items found.
[2015-05-29 17:13:48,515][Test worker][DEBUG][CommonFacadeService] No need to publish AMQP message of transaction(PRIZE_ENQUIRY)
[2015-05-29 17:13:48,515][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:48,515][Test worker][DEBUG][ProtocolSerializer] Start to serialize model(class com.mpos.lottery.te.gamespec.prize.web.PrizeDto),mappingFile=xml-mapping/game/union/EnquiryPrize_Res.xml
[2015-05-29 17:13:48,515][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:48,516][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gamespec.prize.web.PrizeDto, mappingFile=xml-mapping/game/union/EnquiryPrize_Res.xml).
[2015-05-29 17:13:48,517][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890828428|Timestamp:20150529171348|Transaction-Type:4301|Transaction-Id:0115052900000000002235|Response-Code:200|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Prize mode=&quot;1&quot; prizeAmount=&quot;7232000&quot; taxAmount=&quot;1054040&quot; actualAmount=&quot;4887973&quot; luckyAmount=&quot;0&quot; isVerifyPIN=&quot;1&quot;&gt;&lt;Ticket serialNo=&quot;S-123456&quot; totalAmount=&quot;7500.3&quot;/&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090401&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;7&quot; prizeAmount=&quot;3000&quot; taxAmount=&quot;10&quot; actualAmount=&quot;2991&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;1&quot; prizeAmount=&quot;5000000&quot; taxAmount=&quot;1000000&quot; actualAmount=&quot;4000001&quot; numberOfPrize=&quot;1&quot;/&gt;&lt;Winning level=&quot;5&quot; prizeAmount=&quot;10000&quot; taxAmount=&quot;2000&quot; actualAmount=&quot;8001&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;/PrizeItem&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090403&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;2&quot; prizeAmount=&quot;1000000&quot; taxAmount=&quot;5000&quot; actualAmount=&quot;350001&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;Winning level=&quot;4&quot; prizeAmount=&quot;50000&quot; taxAmount=&quot;10000&quot; actualAmount=&quot;40001&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;8&quot; prizeAmount=&quot;0&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;3&quot;/&gt;&lt;/PrizeItem&gt;&lt;/Prize&gt;):e6b67e7edbfe622a9259efd67c5bff9f
[2015-05-29 17:13:48,517][Test worker][DEBUG][TEPortServlet] Write response to client(host1=localhost,sizeOfPack=1272) succesfully.
[2015-05-29 17:13:48,517][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=1272): &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Prize mode=&quot;1&quot; prizeAmount=&quot;7232000&quot; taxAmount=&quot;1054040&quot; actualAmount=&quot;4887973&quot; luckyAmount=&quot;0&quot; isVerifyPIN=&quot;1&quot;&gt;&lt;Ticket serialNo=&quot;S-123456&quot; totalAmount=&quot;7500.3&quot;/&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090401&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;7&quot; prizeAmount=&quot;3000&quot; taxAmount=&quot;10&quot; actualAmount=&quot;2991&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;1&quot; prizeAmount=&quot;5000000&quot; taxAmount=&quot;1000000&quot; actualAmount=&quot;4000001&quot; numberOfPrize=&quot;1&quot;/&gt;&lt;Winning level=&quot;5&quot; prizeAmount=&quot;10000&quot; taxAmount=&quot;2000&quot; actualAmount=&quot;8001&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;/PrizeItem&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090403&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;2&quot; prizeAmount=&quot;1000000&quot; taxAmount=&quot;5000&quot; actualAmount=&quot;350001&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;Winning level=&quot;4&quot; prizeAmount=&quot;50000&quot; taxAmount=&quot;10000&quot; actualAmount=&quot;40001&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;8&quot; prizeAmount=&quot;0&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;3&quot;/&gt;&lt;/PrizeItem&gt;&lt;/Prize&gt;
[2015-05-29 17:13:48,517][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:48,528][Test worker][DEBUG][TEPortServlet] Startup job scheduer(org.quartz.impl.StdScheduler@4d1e5820) successfully.
[2015-05-29 17:13:48,529][Test worker][WARN ][TEPortServlet] can NOT find META file:F:\project\M.Lottery\TE\TRUNK_TE\sourcecode\build\classes\main\META-INF\MANIFEST.MF
[2015-05-29 17:13:48,529][Test worker][DEBUG][TEPortServlet] Register MBean(com.mpos.lottery.te.common.jmx.TransactionTimeout@2ea979d5) with name(com.mpos.lottery.te:type=TransactionTimeoutMBean) successfully.
[2015-05-29 17:13:48,529][Test worker][DEBUG][BaseTransactionalIntegrationTest] Retrieve a ApplicationContext(org.springframework.web.context.support.GenericWebApplicationContext@34f645a8: startup date [Fri May 29 17:12:38 CST 2015]; root of context hierarchy).
[2015-05-29 17:13:48,529][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:48,529][Test worker][INFO ][BaseTransactionalIntegrationTest] | UnionPrizeEnquiryIntegrationTest.testEnquiry_WIN_TaxWhenAnalysis_PrintNewTicket_LuckyDraw                              |
[2015-05-29 17:13:48,530][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:48,533][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:48,533][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.union.sale.UnionTicket, mappingFile=xml-mapping/game/union/EnquiryPrize_Req.xml).
[2015-05-29 17:13:48,533][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890828533|Timestamp:20150529171348|Transaction-Type:301|Transaction-Id:|Response-Code:|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;,hash=1262790779), get digest:cacd85d26cb499ac7db5133582a6a4a8
[2015-05-29 17:13:48,534][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=301).
[2015-05-29 17:13:48,534][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:48,534][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171348).
[2015-05-29 17:13:48,534][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:48,534][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890828533).
[2015-05-29 17:13:48,534][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:48,534][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:48,534][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=cacd85d26cb499ac7db5133582a6a4a8).
[2015-05-29 17:13:48,534][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=8).
[2015-05-29 17:13:48,534][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:48,534][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:48,535][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6ttFDFcpmi1MamgAomcAmY7ZtCcdDkhkRrCXDK2x4EDMo0KLMTKd7D9/oiuZDONWBtcYexf6q8QR.
[2015-05-29 17:13:48,535][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890828533|Timestamp:20150529171348|Transaction-Type:301|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:48,536][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;
[2015-05-29 17:13:48,536][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890828533|Timestamp:20150529171348|Transaction-Type:301|Transaction-Id:|Response-Code:|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Ticket serialNo=&quot;S-123456&quot; validationCode=&quot;111111&quot;/&gt;,hash=1262790779), get digest:cacd85d26cb499ac7db5133582a6a4a8
[2015-05-29 17:13:48,536][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:48,536][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/union/EnquiryPrize_Req.xml
[2015-05-29 17:13:48,536][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Req.xml) by key(8.transtype.301).
[2015-05-29 17:13:48,558][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(8_301_1.5.0).
[2015-05-29 17:13:48,558][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(8_301_).
[2015-05-29 17:13:48,558][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(8_301_), found controller(com.mpos.lottery.te.gameimpl.union.UnionController@f81b221) and method(public void com.mpos.lottery.te.gameimpl.union.UnionController.enquiryPrize(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:48,558][Test worker][DEBUG][AbstractPrizeService] Enquiry prize information of ticket:9pkxn/npytVqVbOF5fPlsg==
[2015-05-29 17:13:48,618][Test worker][DEBUG][AbstractPrizeService] Handle winnings of lucky draw of ticket(serialNo:9pkxn/npytVqVbOF5fPlsg==), total 2 winning items found.
[2015-05-29 17:13:48,639][Test worker][DEBUG][CommonFacadeService] No need to publish AMQP message of transaction(PRIZE_ENQUIRY)
[2015-05-29 17:13:48,640][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:48,640][Test worker][DEBUG][ProtocolSerializer] Start to serialize model(class com.mpos.lottery.te.gamespec.prize.web.PrizeDto),mappingFile=xml-mapping/game/union/EnquiryPrize_Res.xml
[2015-05-29 17:13:48,640][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
[2015-05-29 17:13:48,641][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gamespec.prize.web.PrizeDto, mappingFile=xml-mapping/game/union/EnquiryPrize_Res.xml).
[2015-05-29 17:13:48,642][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890828533|Timestamp:20150529171348|Transaction-Type:4301|Transaction-Id:0115052900000000002236|Response-Code:200|&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Prize mode=&quot;1&quot; prizeAmount=&quot;10032000&quot; taxAmount=&quot;1374040&quot; actualAmount=&quot;7367973&quot; luckyAmount=&quot;8000.00&quot; isVerifyPIN=&quot;1&quot;&gt;&lt;Ticket serialNo=&quot;S-123456&quot; totalAmount=&quot;7500.3&quot;/&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090401&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;7&quot; prizeAmount=&quot;3000&quot; taxAmount=&quot;10&quot; actualAmount=&quot;2991&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;1&quot; prizeAmount=&quot;5000000&quot; taxAmount=&quot;1000000&quot; actualAmount=&quot;4000001&quot; numberOfPrize=&quot;1&quot;/&gt;&lt;Winning level=&quot;5&quot; prizeAmount=&quot;10000&quot; taxAmount=&quot;2000&quot; actualAmount=&quot;8001&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;/PrizeItem&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090403&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;2&quot; prizeAmount=&quot;1000000&quot; taxAmount=&quot;5000&quot; actualAmount=&quot;350001&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;Winning level=&quot;4&quot; prizeAmount=&quot;50000&quot; taxAmount=&quot;10000&quot; actualAmount=&quot;40001&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;8&quot; prizeAmount=&quot;0&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;3&quot;/&gt;&lt;/PrizeItem&gt;&lt;PrizeItem type=&quot;2&quot;&gt;&lt;GameDraw number=&quot;001&quot; gameId=&quot;LD-1&quot;/&gt;&lt;Winning level=&quot;1&quot; prizeAmount=&quot;400000&quot; taxAmount=&quot;80000&quot; actualAmount=&quot;320000&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;Winning level=&quot;4&quot; prizeAmount=&quot;1000000&quot; taxAmount=&quot;80000&quot; actualAmount=&quot;920000&quot; numberOfPrize=&quot;2&quot;&gt;&lt;PrizeObject name=&quot;Sony Camera&quot; count=&quot;2&quot; taxAmount=&quot;500&quot; price=&quot;2000&quot;/&gt;&lt;/Winning&gt;&lt;/PrizeItem&gt;&lt;/Prize&gt;):8f5aeaafac3ab15db0bdedd59d26c604
[2015-05-29 17:13:48,642][Test worker][DEBUG][TEPortServlet] Write response to client(host1=localhost,sizeOfPack=1752) succesfully.
[2015-05-29 17:13:48,643][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=1752): &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Prize mode=&quot;1&quot; prizeAmount=&quot;10032000&quot; taxAmount=&quot;1374040&quot; actualAmount=&quot;7367973&quot; luckyAmount=&quot;8000.00&quot; isVerifyPIN=&quot;1&quot;&gt;&lt;Ticket serialNo=&quot;S-123456&quot; totalAmount=&quot;7500.3&quot;/&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090401&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;7&quot; prizeAmount=&quot;3000&quot; taxAmount=&quot;10&quot; actualAmount=&quot;2991&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;1&quot; prizeAmount=&quot;5000000&quot; taxAmount=&quot;1000000&quot; actualAmount=&quot;4000001&quot; numberOfPrize=&quot;1&quot;/&gt;&lt;Winning level=&quot;5&quot; prizeAmount=&quot;10000&quot; taxAmount=&quot;2000&quot; actualAmount=&quot;8001&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;/PrizeItem&gt;&lt;PrizeItem type=&quot;1&quot;&gt;&lt;GameDraw number=&quot;20090403&quot; gameId=&quot;GAME-UNION-111&quot;/&gt;&lt;Winning level=&quot;2&quot; prizeAmount=&quot;1000000&quot; taxAmount=&quot;5000&quot; actualAmount=&quot;350001&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;Winning level=&quot;4&quot; prizeAmount=&quot;50000&quot; taxAmount=&quot;10000&quot; actualAmount=&quot;40001&quot; numberOfPrize=&quot;4&quot;/&gt;&lt;Winning level=&quot;8&quot; prizeAmount=&quot;0&quot; taxAmount=&quot;0&quot; actualAmount=&quot;0&quot; numberOfPrize=&quot;3&quot;/&gt;&lt;/PrizeItem&gt;&lt;PrizeItem type=&quot;2&quot;&gt;&lt;GameDraw number=&quot;001&quot; gameId=&quot;LD-1&quot;/&gt;&lt;Winning level=&quot;1&quot; prizeAmount=&quot;400000&quot; taxAmount=&quot;80000&quot; actualAmount=&quot;320000&quot; numberOfPrize=&quot;2&quot;/&gt;&lt;Winning level=&quot;4&quot; prizeAmount=&quot;1000000&quot; taxAmount=&quot;80000&quot; actualAmount=&quot;920000&quot; numberOfPrize=&quot;2&quot;&gt;&lt;PrizeObject name=&quot;Sony Camera&quot; count=&quot;2&quot; taxAmount=&quot;500&quot; price=&quot;2000&quot;/&gt;&lt;/Winning&gt;&lt;/PrizeItem&gt;&lt;/Prize&gt;
[2015-05-29 17:13:48,643][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/union/EnquiryPrize_Res.xml) by key(8.transtype.4301).
</pre>
</span>
</div>
</div>
<div id="footer">
<p>Generated by 
<a href="http://www.gradle.org">Gradle 2.2.1</a> at 2015-5-29 17:14:47</p>
</div>
</div>
</body>