<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="zh">
<head>
<!-- Generated by javadoc (version 1.7.0_71) on Fri May 29 17:11:38 CST 2015 -->
<title>VatOfflineSaleService (sourcecode 2.5.2-rc7 API)</title>
<meta name="date" content="2015-05-29">
<link rel="stylesheet" type="text/css" href="../../../../../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="VatOfflineSaleService (sourcecode 2.5.2-rc7 API)";
    }
//-->
</script>
<noscript>
<div>您的浏览器已禁用 JavaScript。</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="跳过导航链接"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="导航">
<li><a href="../../../../../../../overview-summary.html">概览</a></li>
<li><a href="package-summary.html">程序包</a></li>
<li class="navBarCell1Rev">类</li>
<li><a href="package-tree.html">树</a></li>
<li><a href="../../../../../../../deprecated-list.html">已过时</a></li>
<li><a href="../../../../../../../index-all.html">索引</a></li>
<li><a href="../../../../../../../help-doc.html">帮助</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../../com/mpos/lottery/te/valueaddservice/vat/service/VatCreditService.html" title="com.mpos.lottery.te.valueaddservice.vat.service中的接口"><span class="strong">上一个类</span></a></li>
<li><a href="../../../../../../../com/mpos/lottery/te/valueaddservice/vat/service/VatReprintTicketService.html" title="com.mpos.lottery.te.valueaddservice.vat.service中的接口"><span class="strong">下一个类</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../../index.html?com/mpos/lottery/te/valueaddservice/vat/service/VatOfflineSaleService.html" target="_top">框架</a></li>
<li><a href="VatOfflineSaleService.html" target="_top">无框架</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../../../allclasses-noframe.html">所有类</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>概要:&nbsp;</li>
<li>嵌套&nbsp;|&nbsp;</li>
<li>字段&nbsp;|&nbsp;</li>
<li>构造器&nbsp;|&nbsp;</li>
<li><a href="#method_summary">方法</a></li>
</ul>
<ul class="subNavList">
<li>详细资料:&nbsp;</li>
<li>字段&nbsp;|&nbsp;</li>
<li>构造器&nbsp;|&nbsp;</li>
<li><a href="#method_detail">方法</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.mpos.lottery.te.valueaddservice.vat.service</div>
<h2 title="接口 VatOfflineSaleService" class="title">接口 VatOfflineSaleService</h2>
</div>
<div class="contentContainer">
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>所有已知实现类:</dt>
<dd><a href="../../../../../../../com/mpos/lottery/te/valueaddservice/vat/service/impl/DefaultVatOfflineSaleService.html" title="com.mpos.lottery.te.valueaddservice.vat.service.impl中的类">DefaultVatOfflineSaleService</a></dd>
</dl>
<hr>
<br>
<pre>public interface <span class="strong">VatOfflineSaleService</span></pre>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>方法概要</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="方法概要表, 列表方法和解释">
<caption><span>方法</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">限定符和类型</th>
<th class="colLast" scope="col">方法和说明</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="../../../../../../../com/mpos/lottery/te/valueaddservice/vat/web/VatOfflineSaleUploadDto.html" title="com.mpos.lottery.te.valueaddservice.vat.web中的类">VatOfflineSaleUploadDto</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../../../com/mpos/lottery/te/valueaddservice/vat/service/VatOfflineSaleService.html#upload(com.mpos.lottery.te.port.Context,%20com.mpos.lottery.te.valueaddservice.vat.web.VatOfflineSaleUploadDto)">upload</a></strong>(<a href="../../../../../../../com/mpos/lottery/te/port/Context.html" title="com.mpos.lottery.te.port中的类">Context</a>&nbsp;respCtx,
      <a href="../../../../../../../com/mpos/lottery/te/valueaddservice/vat/web/VatOfflineSaleUploadDto.html" title="com.mpos.lottery.te.valueaddservice.vat.web中的类">VatOfflineSaleUploadDto</a>&nbsp;uploadDto)</code>
<div class="block">Sync the offline VAT sale with the backend.</div>
</td>
</tr>
</table>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>方法详细资料</h3>
<a name="upload(com.mpos.lottery.te.port.Context, com.mpos.lottery.te.valueaddservice.vat.web.VatOfflineSaleUploadDto)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>upload</h4>
<pre><a href="../../../../../../../com/mpos/lottery/te/valueaddservice/vat/web/VatOfflineSaleUploadDto.html" title="com.mpos.lottery.te.valueaddservice.vat.web中的类">VatOfflineSaleUploadDto</a>&nbsp;upload(<a href="../../../../../../../com/mpos/lottery/te/port/Context.html" title="com.mpos.lottery.te.port中的类">Context</a>&nbsp;respCtx,
                             <a href="../../../../../../../com/mpos/lottery/te/valueaddservice/vat/web/VatOfflineSaleUploadDto.html" title="com.mpos.lottery.te.valueaddservice.vat.web中的类">VatOfflineSaleUploadDto</a>&nbsp;uploadDto)
                               throws <a href="../../../../../../../com/mpos/lottery/te/config/exception/ApplicationException.html" title="com.mpos.lottery.te.config.exception中的类">ApplicationException</a></pre>
<div class="block">Sync the offline VAT sale with the backend. Client will upload offline VAT sale in batch mode, and the backend
 will sync them one by one.
 <p>
 <h1>Fail to sync a VAT sale</h1>
 Fail to sync a single VAT sale won't affect the handling of other VAT sales, that says the backend will continue
 to handle next offline VAT sale, and simply ignore the failed one, however the failed transctions will be
 returned to client.
 <h1>Upload after winner analysis</h1> In offline mode, we can't guarantee that all sales can be uploaded before
 winner analysis. For example retailer sells a ticket a Draw#1, however due to some reasons, s/he can only upload
 those offline sales when Draw#2, how does the backend handle this case? Lets take a look of below example.
 <table border="1">
 <tr>
 <td>TicketSerialNo</td>
 <td>GameInstance</td>
 </tr>
 <tr>
 <td>S1</td>
 <td>D1</td>
 </tr>
 <tr>
 <td>S2</td>
 <td>D2</td>
 </tr>
 </table>
 <p>
 Now the active game instance is D3(both D1 and D2 are payout-started), and retailer start to upload those offline
 VAT sales, in this case S1 will still join winner analysis of D1(the winner analysis will be performed by
 M.Lottery, TE will send a message to M.Lottery), and follows the same rule, ticket S2 will join winner analysis
 of D2.
 <p>
 However the backend will count the total amount of all tickets(both Raffle and Magic100) of those offline VAT
 sales to a special turnover of current active game instance D3, this is just for reference.
 <p>
 <b>Pre-Condition</b>
 <ul>
 <li>None of any associated game instances is 'in progress of winner analysis'. if we do uploading during winner
 analysis, it will break the process of winner analysis.</li>
 </ul>
 <b>Post-Condition</b>
 <ul>
 <li>Generate <a href="../../../../../../../com/mpos/lottery/te/trans/domain/TransactionType.html#VAT_UPLOAD_OFFLINESALE"><code>TransactionType.VAT_UPLOAD_OFFLINESALE</code></a> transaction.</li>
 <li>Generate VAT sale transaction accordingly if matched.</li>
 <li>Generate <a href="../../../../../../../com/mpos/lottery/te/gamespec/sale/OfflineTicketLog.html" title="com.mpos.lottery.te.gamespec.sale中的类"><code>OfflineTicketLog</code></a> if needed, and one record per game
 instance.</li>
 <li>Generate Raffle or Magic100 ticket if needed.</li>
 </ul>
 <p>
 <b>Usage Restriction</b>
 <ul>
 <li>Authorization - Can only be called by signed in user.</li>
 <li>Count of Transaction - There is a limitation on count of transaction in a single request, default is 100.</li>
 <li>Concurrent Access - To a single device, this interface must be called sequentially. To multiple devices,
 there are no limitation on the number of concurrent accesses.</li>
 <li>Message Redelivery - Client can redeliver the same message content(with different trace message ID) any
 number of times, the backend will guarantee data consistency.</li>
 </ul></div>
<dl><dt><span class="strong">参数:</span></dt><dd><code>respCtx</code> - THe context of current transaction.</dd><dd><code>uploadDto</code> - THe request DTO which carries offline VAT sale transactions.</dd>
<dt><span class="strong">返回:</span></dt><dd>only those unmatched/failed vat transactions.</dd>
<dt><span class="strong">抛出:</span></dt>
<dd><code><a href="../../../../../../../com/mpos/lottery/te/config/exception/ApplicationException.html" title="com.mpos.lottery.te.config.exception中的类">ApplicationException</a></code> - if encounter any biz exception.</dd></dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="跳过导航链接"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="导航">
<li><a href="../../../../../../../overview-summary.html">概览</a></li>
<li><a href="package-summary.html">程序包</a></li>
<li class="navBarCell1Rev">类</li>
<li><a href="package-tree.html">树</a></li>
<li><a href="../../../../../../../deprecated-list.html">已过时</a></li>
<li><a href="../../../../../../../index-all.html">索引</a></li>
<li><a href="../../../../../../../help-doc.html">帮助</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../../com/mpos/lottery/te/valueaddservice/vat/service/VatCreditService.html" title="com.mpos.lottery.te.valueaddservice.vat.service中的接口"><span class="strong">上一个类</span></a></li>
<li><a href="../../../../../../../com/mpos/lottery/te/valueaddservice/vat/service/VatReprintTicketService.html" title="com.mpos.lottery.te.valueaddservice.vat.service中的接口"><span class="strong">下一个类</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../../index.html?com/mpos/lottery/te/valueaddservice/vat/service/VatOfflineSaleService.html" target="_top">框架</a></li>
<li><a href="VatOfflineSaleService.html" target="_top">无框架</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../../../allclasses-noframe.html">所有类</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>概要:&nbsp;</li>
<li>嵌套&nbsp;|&nbsp;</li>
<li>字段&nbsp;|&nbsp;</li>
<li>构造器&nbsp;|&nbsp;</li>
<li><a href="#method_summary">方法</a></li>
</ul>
<ul class="subNavList">
<li>详细资料:&nbsp;</li>
<li>字段&nbsp;|&nbsp;</li>
<li>构造器&nbsp;|&nbsp;</li>
<li><a href="#method_detail">方法</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
