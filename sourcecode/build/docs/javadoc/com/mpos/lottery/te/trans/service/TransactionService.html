<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="zh">
<head>
<!-- Generated by javadoc (version 1.7.0_71) on Fri May 29 17:11:35 CST 2015 -->
<title>TransactionService (sourcecode 2.5.2-rc7 API)</title>
<meta name="date" content="2015-05-29">
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="TransactionService (sourcecode 2.5.2-rc7 API)";
    }
//-->
</script>
<noscript>
<div>您的浏览器已禁用 JavaScript。</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="跳过导航链接"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="导航">
<li><a href="../../../../../../overview-summary.html">概览</a></li>
<li><a href="package-summary.html">程序包</a></li>
<li class="navBarCell1Rev">类</li>
<li><a href="package-tree.html">树</a></li>
<li><a href="../../../../../../deprecated-list.html">已过时</a></li>
<li><a href="../../../../../../index-all.html">索引</a></li>
<li><a href="../../../../../../help-doc.html">帮助</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../com/mpos/lottery/te/trans/service/TransactionRetryLogServiceAsyn.html" title="com.mpos.lottery.te.trans.service中的接口"><span class="strong">上一个类</span></a></li>
<li>下一个类</li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?com/mpos/lottery/te/trans/service/TransactionService.html" target="_top">框架</a></li>
<li><a href="TransactionService.html" target="_top">无框架</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../../allclasses-noframe.html">所有类</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>概要:&nbsp;</li>
<li>嵌套&nbsp;|&nbsp;</li>
<li>字段&nbsp;|&nbsp;</li>
<li>构造器&nbsp;|&nbsp;</li>
<li><a href="#method_summary">方法</a></li>
</ul>
<ul class="subNavList">
<li>详细资料:&nbsp;</li>
<li>字段&nbsp;|&nbsp;</li>
<li>构造器&nbsp;|&nbsp;</li>
<li><a href="#method_detail">方法</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.mpos.lottery.te.trans.service</div>
<h2 title="接口 TransactionService" class="title">接口 TransactionService</h2>
</div>
<div class="contentContainer">
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>所有已知实现类:</dt>
<dd><a href="../../../../../../com/mpos/lottery/te/trans/service/impl/TransactionServiceImpl.html" title="com.mpos.lottery.te.trans.service.impl中的类">TransactionServiceImpl</a></dd>
</dl>
<hr>
<br>
<pre>public interface <span class="strong">TransactionService</span></pre>
<div class="block">The service definition of Transaction. Guarantee that save/update transaction is in individual transaction(database
 transaction). In spring transaction definition, a interface method will required a transaction(if a transaction has
 existed, join it. or, create a new transaction). Here, ServiceFacade will invoke TransactionService in individual
 transaction.</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>方法概要</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="方法概要表, 列表方法和解释">
<caption><span>方法</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">限定符和类型</th>
<th class="colLast" scope="col">方法和说明</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="../../../../../../com/mpos/lottery/te/trans/domain/Transaction.html" title="com.mpos.lottery.te.trans.domain中的类">Transaction</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../../com/mpos/lottery/te/trans/service/TransactionService.html#enquiry(com.mpos.lottery.te.port.Context,%20long,%20java.lang.String)">enquiry</a></strong>(<a href="../../../../../../com/mpos/lottery/te/port/Context.html" title="com.mpos.lottery.te.port中的类">Context</a>&nbsp;respCtx,
       long&nbsp;terminalId,
       java.lang.String&nbsp;traceMessageId)</code>
<div class="block">Get transaction by terminal id and trace message id.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../com/mpos/lottery/te/trans/service/TransactionService.html#pendTransaction(int,%20java.lang.Object...)">pendTransaction</a></strong>(int&nbsp;cancelTransType,
               java.lang.Object...&nbsp;params)</code>
<div class="block">When client switches between TE instances, cancel transactions must be treated carefully.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../com/mpos/lottery/te/trans/service/TransactionService.html#registerTicketEnquiry(com.mpos.lottery.te.gamespec.game.GameType,%20com.mpos.lottery.te.gamespec.sale.service.TicketEnquiryService)">registerTicketEnquiry</a></strong>(<a href="../../../../../../com/mpos/lottery/te/gamespec/game/GameType.html" title="com.mpos.lottery.te.gamespec.game中的枚举">GameType</a>&nbsp;gameType,
                     <a href="../../../../../../com/mpos/lottery/te/gamespec/sale/service/TicketEnquiryService.html" title="com.mpos.lottery.te.gamespec.sale.service中的接口">TicketEnquiryService</a>&nbsp;ticketEquiryService)</code>
<div class="block">Register a game type specific ticket enquiry implementation.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><strong><a href="../../../../../../com/mpos/lottery/te/trans/service/TransactionService.html#reverseOrCancel(com.mpos.lottery.te.port.Context,%20com.mpos.lottery.te.gamespec.sale.BaseTicket)">reverseOrCancel</a></strong>(<a href="../../../../../../com/mpos/lottery/te/port/Context.html" title="com.mpos.lottery.te.port中的类">Context</a>&lt;?&gt;&nbsp;respCtx,
               <a href="../../../../../../com/mpos/lottery/te/gamespec/sale/BaseTicket.html" title="com.mpos.lottery.te.gamespec.sale中的类">BaseTicket</a>&nbsp;ticket)</code>
<div class="block">Cancel a ticket, in general should be a sale transaction.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><strong><a href="../../../../../../com/mpos/lottery/te/trans/service/TransactionService.html#reverseOrCancel(com.mpos.lottery.te.port.Context,%20com.mpos.lottery.te.trans.domain.Transaction)">reverseOrCancel</a></strong>(<a href="../../../../../../com/mpos/lottery/te/port/Context.html" title="com.mpos.lottery.te.port中的类">Context</a>&lt;?&gt;&nbsp;respCtx,
               <a href="../../../../../../com/mpos/lottery/te/trans/domain/Transaction.html" title="com.mpos.lottery.te.trans.domain中的类">Transaction</a>&nbsp;dbTrans)</code>
<div class="block">Handle incoming requests of reversal or cancel by transaction.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../com/mpos/lottery/te/trans/service/TransactionService.html#save(com.mpos.lottery.te.trans.domain.Transaction)">save</a></strong>(<a href="../../../../../../com/mpos/lottery/te/trans/domain/Transaction.html" title="com.mpos.lottery.te.trans.domain中的类">Transaction</a>&nbsp;trans)</code>
<div class="block">Save a new transaction.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../com/mpos/lottery/te/trans/service/TransactionService.html#update(com.mpos.lottery.te.trans.domain.Transaction)">update</a></strong>(<a href="../../../../../../com/mpos/lottery/te/trans/domain/Transaction.html" title="com.mpos.lottery.te.trans.domain中的类">Transaction</a>&nbsp;trans)</code>
<div class="block">update a exist transaction instance.</div>
</td>
</tr>
</table>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>方法详细资料</h3>
<a name="registerTicketEnquiry(com.mpos.lottery.te.gamespec.game.GameType, com.mpos.lottery.te.gamespec.sale.service.TicketEnquiryService)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>registerTicketEnquiry</h4>
<pre>void&nbsp;registerTicketEnquiry(<a href="../../../../../../com/mpos/lottery/te/gamespec/game/GameType.html" title="com.mpos.lottery.te.gamespec.game中的枚举">GameType</a>&nbsp;gameType,
                         <a href="../../../../../../com/mpos/lottery/te/gamespec/sale/service/TicketEnquiryService.html" title="com.mpos.lottery.te.gamespec.sale.service中的接口">TicketEnquiryService</a>&nbsp;ticketEquiryService)</pre>
<div class="block">Register a game type specific ticket enquiry implementation. Refer to {#link
 <a href="../../../../../../com/mpos/lottery/te/gamespec/sale/service/TicketEnquiryService.html#enquiry(com.mpos.lottery.te.port.Context,%20com.mpos.lottery.te.gamespec.sale.BaseTicket,%20boolean)"><code>TicketEnquiryService.enquiry(Context, com.mpos.lottery.te.gamespec.sale.BaseTicket, boolean)</code></a></div>
</li>
</ul>
<a name="enquiry(com.mpos.lottery.te.port.Context, long, java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>enquiry</h4>
<pre><a href="../../../../../../com/mpos/lottery/te/trans/domain/Transaction.html" title="com.mpos.lottery.te.trans.domain中的类">Transaction</a>&nbsp;enquiry(<a href="../../../../../../com/mpos/lottery/te/port/Context.html" title="com.mpos.lottery.te.port中的类">Context</a>&nbsp;respCtx,
                  long&nbsp;terminalId,
                  java.lang.String&nbsp;traceMessageId)
                    throws <a href="../../../../../../com/mpos/lottery/te/config/exception/ApplicationException.html" title="com.mpos.lottery.te.config.exception中的类">ApplicationException</a></pre>
<div class="block">Get transaction by terminal id and trace message id. It maps to 'Transaction Enquiry' transaction.</div>
<dl><dt><span class="strong">参数:</span></dt><dd><code>terminalId</code> - The identifier of terminal</dd><dd><code>traceMessageId</code> - The identifier of trace message.</dd>
<dt><span class="strong">返回:</span></dt><dd>a Transaction instance with specified criteria.</dd>
<dt><span class="strong">抛出:</span></dt>
<dd><code><a href="../../../../../../com/mpos/lottery/te/config/exception/ApplicationException.html" title="com.mpos.lottery.te.config.exception中的类">ApplicationException</a></code></dd></dl>
</li>
</ul>
<a name="save(com.mpos.lottery.te.trans.domain.Transaction)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>save</h4>
<pre>void&nbsp;save(<a href="../../../../../../com/mpos/lottery/te/trans/domain/Transaction.html" title="com.mpos.lottery.te.trans.domain中的类">Transaction</a>&nbsp;trans)
          throws <a href="../../../../../../com/mpos/lottery/te/config/exception/ApplicationException.html" title="com.mpos.lottery.te.config.exception中的类">ApplicationException</a></pre>
<div class="block">Save a new transaction.</div>
<dl><dt><span class="strong">抛出:</span></dt>
<dd><code><a href="../../../../../../com/mpos/lottery/te/config/exception/ApplicationException.html" title="com.mpos.lottery.te.config.exception中的类">ApplicationException</a></code></dd></dl>
</li>
</ul>
<a name="update(com.mpos.lottery.te.trans.domain.Transaction)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>update</h4>
<pre>void&nbsp;update(<a href="../../../../../../com/mpos/lottery/te/trans/domain/Transaction.html" title="com.mpos.lottery.te.trans.domain中的类">Transaction</a>&nbsp;trans)
            throws <a href="../../../../../../com/mpos/lottery/te/config/exception/ApplicationException.html" title="com.mpos.lottery.te.config.exception中的类">ApplicationException</a></pre>
<div class="block">update a exist transaction instance.</div>
<dl><dt><span class="strong">抛出:</span></dt>
<dd><code><a href="../../../../../../com/mpos/lottery/te/config/exception/ApplicationException.html" title="com.mpos.lottery.te.config.exception中的类">ApplicationException</a></code></dd></dl>
</li>
</ul>
<a name="reverseOrCancel(com.mpos.lottery.te.port.Context, com.mpos.lottery.te.trans.domain.Transaction)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>reverseOrCancel</h4>
<pre>boolean&nbsp;reverseOrCancel(<a href="../../../../../../com/mpos/lottery/te/port/Context.html" title="com.mpos.lottery.te.port中的类">Context</a>&lt;?&gt;&nbsp;respCtx,
                      <a href="../../../../../../com/mpos/lottery/te/trans/domain/Transaction.html" title="com.mpos.lottery.te.trans.domain中的类">Transaction</a>&nbsp;dbTrans)
                        throws <a href="../../../../../../com/mpos/lottery/te/config/exception/ApplicationException.html" title="com.mpos.lottery.te.config.exception中的类">ApplicationException</a></pre>
<div class="block">Handle incoming requests of reversal or cancel by transaction.
 <p>
 Reversal will reverse a 'payout' and 'validate instant ticket' transaction. When reverse different transaction,
 corresponding strategy should be adopted. below condition must be checked:
 <ol>
 <li>Is the status of ticket(ticket record associate with bought game draw) 'paid'?</li>
 </ol>
 Reversal just set the status of 'payed' ticket to 'accepted', then set payout record to 'reversed'</div>
<dl><dt><span class="strong">参数:</span></dt><dd><code>dbTrans</code> - The transaction associating with 'Payout'.</dd>
<dt><span class="strong">返回:</span></dt><dd>true if cancel declined, or false</dd>
<dt><span class="strong">抛出:</span></dt>
<dd><code><a href="../../../../../../com/mpos/lottery/te/config/exception/ApplicationException.html" title="com.mpos.lottery.te.config.exception中的类">ApplicationException</a></code> - when encounter any business logic exception.</dd></dl>
</li>
</ul>
<a name="reverseOrCancel(com.mpos.lottery.te.port.Context, com.mpos.lottery.te.gamespec.sale.BaseTicket)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>reverseOrCancel</h4>
<pre>boolean&nbsp;reverseOrCancel(<a href="../../../../../../com/mpos/lottery/te/port/Context.html" title="com.mpos.lottery.te.port中的类">Context</a>&lt;?&gt;&nbsp;respCtx,
                      <a href="../../../../../../com/mpos/lottery/te/gamespec/sale/BaseTicket.html" title="com.mpos.lottery.te.gamespec.sale中的类">BaseTicket</a>&nbsp;ticket)
                        throws <a href="../../../../../../com/mpos/lottery/te/config/exception/ApplicationException.html" title="com.mpos.lottery.te.config.exception中的类">ApplicationException</a></pre>
<div class="block">Cancel a ticket, in general should be a sale transaction. This service will call
 <a href="../../../../../../com/mpos/lottery/te/trans/service/TransactionService.html#reverseOrCancel(com.mpos.lottery.te.port.Context,%20com.mpos.lottery.te.trans.domain.Transaction)"><code>reverseOrCancel(Context, Transaction)</code></a></div>
<dl><dt><span class="strong">抛出:</span></dt>
<dd><code><a href="../../../../../../com/mpos/lottery/te/config/exception/ApplicationException.html" title="com.mpos.lottery.te.config.exception中的类">ApplicationException</a></code></dd></dl>
</li>
</ul>
<a name="pendTransaction(int, java.lang.Object...)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>pendTransaction</h4>
<pre>void&nbsp;pendTransaction(int&nbsp;cancelTransType,
                   java.lang.Object...&nbsp;params)
                     throws <a href="../../../../../../com/mpos/lottery/te/config/exception/ApplicationException.html" title="com.mpos.lottery.te.config.exception中的类">ApplicationException</a></pre>
<div class="block">When client switches between TE instances, cancel transactions must be treated carefully. Imagine that client
 issues a sale request to the first TE instance, then a cancel request is issued to the sencond Te instance(maybe
 the first TE instance is unavaliable).
 <p>
 This method will handle this case. If no corresponding sale transaction found, just record it, other process will
 handle these pending cancel request later(maybe after the data synchronization between two Te instances). handle
 <p>
 PRE-CONDITION: The corresponding sale which client going to cancel doesn't exist.</div>
<dl><dt><span class="strong">参数:</span></dt><dd><code>cancelTransType</code> - All TE supported cancellation type, including reversal.</dd><dd><code>params</code> - If canceltransType is 'cancelBySerialNo', the params will be [String serialNo, long deviceId, String
            traceMsgId]. If cancel by transaction, the params will be [long deviceId, String traceMsgId].</dd>
<dt><span class="strong">抛出:</span></dt>
<dd><code><a href="../../../../../../com/mpos/lottery/te/config/exception/ApplicationException.html" title="com.mpos.lottery.te.config.exception中的类">ApplicationException</a></code></dd></dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="跳过导航链接"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="导航">
<li><a href="../../../../../../overview-summary.html">概览</a></li>
<li><a href="package-summary.html">程序包</a></li>
<li class="navBarCell1Rev">类</li>
<li><a href="package-tree.html">树</a></li>
<li><a href="../../../../../../deprecated-list.html">已过时</a></li>
<li><a href="../../../../../../index-all.html">索引</a></li>
<li><a href="../../../../../../help-doc.html">帮助</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../com/mpos/lottery/te/trans/service/TransactionRetryLogServiceAsyn.html" title="com.mpos.lottery.te.trans.service中的接口"><span class="strong">上一个类</span></a></li>
<li>下一个类</li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?com/mpos/lottery/te/trans/service/TransactionService.html" target="_top">框架</a></li>
<li><a href="TransactionService.html" target="_top">无框架</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../../allclasses-noframe.html">所有类</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>概要:&nbsp;</li>
<li>嵌套&nbsp;|&nbsp;</li>
<li>字段&nbsp;|&nbsp;</li>
<li>构造器&nbsp;|&nbsp;</li>
<li><a href="#method_summary">方法</a></li>
</ul>
<ul class="subNavList">
<li>详细资料:&nbsp;</li>
<li>字段&nbsp;|&nbsp;</li>
<li>构造器&nbsp;|&nbsp;</li>
<li><a href="#method_detail">方法</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
