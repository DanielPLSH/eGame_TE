<?xml version="1.0" encoding="UTF-8"?>
<testsuite name="com.mpos.lottery.te.gameimpl.magic100.prize.MagicPrizeEnquiryIntegrationTest" tests="1" skipped="0" failures="0" errors="0" timestamp="2015-05-29T09:13:36" hostname="Ramon-PC" time="0.125">
  <properties/>
  <testcase name="testEnquiry_TaxOnPayout_NewPrint_MultiDraw_OK" classname="com.mpos.lottery.te.gameimpl.magic100.prize.MagicPrizeEnquiryIntegrationTest" time="0.125"/>
  <system-out><![CDATA[[2015-05-29 17:13:36,418][Test worker][DEBUG][TEPortServlet] Startup job scheduer(org.quartz.impl.StdScheduler@4d1e5820) successfully.
[2015-05-29 17:13:36,419][Test worker][WARN ][TEPortServlet] can NOT find META file:F:\project\M.Lottery\TE\TRUNK_TE\sourcecode\build\classes\main\META-INF\MANIFEST.MF
[2015-05-29 17:13:36,419][Test worker][DEBUG][TEPortServlet] Register MBean(com.mpos.lottery.te.common.jmx.TransactionTimeout@3ef60a2e) with name(com.mpos.lottery.te:type=TransactionTimeoutMBean) successfully.
[2015-05-29 17:13:36,419][Test worker][DEBUG][BaseTransactionalIntegrationTest] Retrieve a ApplicationContext(org.springframework.web.context.support.GenericWebApplicationContext@34f645a8: startup date [Fri May 29 17:12:38 CST 2015]; root of context hierarchy).
[2015-05-29 17:13:36,420][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:36,420][Test worker][INFO ][BaseTransactionalIntegrationTest] | MagicPrizeEnquiryIntegrationTest.testEnquiry_TaxOnPayout_NewPrint_MultiDraw_OK                                         |
[2015-05-29 17:13:36,420][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:36,424][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/EnquiryPrize_Req.xml) by key(18.transtype.301).
[2015-05-29 17:13:36,433][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.magic100.sale.Magic100Ticket, mappingFile=xml-mapping/game/magic100/EnquiryPrize_Req.xml).
[2015-05-29 17:13:36,433][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890816424|Timestamp:20150529171336|Transaction-Type:301|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="S-123456" validationCode="111111"/>,hash=1038635998), get digest:496ee1bb1da7249fb4e980ce9b10fce6
[2015-05-29 17:13:36,434][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=301).
[2015-05-29 17:13:36,434][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:36,434][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171336).
[2015-05-29 17:13:36,434][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:36,434][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890816424).
[2015-05-29 17:13:36,434][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:36,434][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:36,434][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=496ee1bb1da7249fb4e980ce9b10fce6).
[2015-05-29 17:13:36,434][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=18).
[2015-05-29 17:13:36,434][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:36,434][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:36,436][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6ttFDFcpmi1MamgAomcAmY7ZtCcdDkhkRrCXDK2x4EDMo0KLMTKd7D9/oiuZDONWBtcYexf6q8QR.
[2015-05-29 17:13:36,436][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890816424|Timestamp:20150529171336|Transaction-Type:301|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:36,436][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="S-123456" validationCode="111111"/>
[2015-05-29 17:13:36,436][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890816424|Timestamp:20150529171336|Transaction-Type:301|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="S-123456" validationCode="111111"/>,hash=1038635998), get digest:496ee1bb1da7249fb4e980ce9b10fce6
[2015-05-29 17:13:36,436][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/EnquiryPrize_Req.xml) by key(18.transtype.301).
[2015-05-29 17:13:36,436][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/magic100/EnquiryPrize_Req.xml
[2015-05-29 17:13:36,436][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/EnquiryPrize_Req.xml) by key(18.transtype.301).
[2015-05-29 17:13:36,451][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(18_301_1.5.0).
[2015-05-29 17:13:36,452][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(18_301_).
[2015-05-29 17:13:36,452][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(18_301_), found controller(com.mpos.lottery.te.gameimpl.magic100.Magic100Controller@7081c100) and method(public void com.mpos.lottery.te.gameimpl.magic100.Magic100Controller.enquiryPrize(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:36,452][Test worker][DEBUG][AbstractPrizeService] Enquiry prize information of ticket:9pkxn/npytVqVbOF5fPlsg==
[2015-05-29 17:13:36,471][Test worker][DEBUG][DefaultTaxService] Calculate tax for amount:1000 based on threshold(com.mpos.lottery.te.gamespec.prize.TaxThreshold@1ad80dc2[id=WTT-1,taxPolicyId=TP-1,taxDateRange=com.mpos.lottery.te.gamespec.prize.TaxDateRange@4bfbdf04[id=TDR-1,beginDate=2009-03-20 21:00:00.0,endDate=2099-03-20 21:00:00.0],minAmount=1000,maxAmount=9999999999,ruleType=1,taxAmount=0.2,taxBase=1])...tax:166.67
[2015-05-29 17:13:36,474][Test worker][DEBUG][DefaultTaxService] Calculate tax for amount:1000 based on threshold(com.mpos.lottery.te.gamespec.prize.TaxThreshold@1ad80dc2[id=WTT-1,taxPolicyId=TP-1,taxDateRange=com.mpos.lottery.te.gamespec.prize.TaxDateRange@4bfbdf04[id=TDR-1,beginDate=2009-03-20 21:00:00.0,endDate=2099-03-20 21:00:00.0],minAmount=1000,maxAmount=9999999999,ruleType=1,taxAmount=0.2,taxBase=1])...tax:166.67
[2015-05-29 17:13:36,477][Test worker][DEBUG][CommonFacadeService] No need to publish AMQP message of transaction(PRIZE_ENQUIRY)
[2015-05-29 17:13:36,477][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/EnquiryPrize_Res.xml) by key(18.transtype.4301).
[2015-05-29 17:13:36,478][Test worker][DEBUG][ProtocolSerializer] Start to serialize model(class com.mpos.lottery.te.gamespec.prize.web.PrizeDto),mappingFile=xml-mapping/game/magic100/EnquiryPrize_Res.xml
[2015-05-29 17:13:36,478][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/EnquiryPrize_Res.xml) by key(18.transtype.4301).
[2015-05-29 17:13:36,516][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gamespec.prize.web.PrizeDto, mappingFile=xml-mapping/game/magic100/EnquiryPrize_Res.xml).
[2015-05-29 17:13:36,517][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890816424|Timestamp:20150529171336|Transaction-Type:4301|Transaction-Id:0115052900000000001847|Response-Code:200|<?xml version="1.0" encoding="UTF-8"?>
<Prize returnAmount="0" mode="0" prizeAmount="1000" taxAmount="166.67" actualAmount="833.33" luckyAmount="0" isVerifyPIN="0"><Ticket multiple-draws="1" count-of-lucky-winning="0" lucky-winning="true" count-in-pool="true" version="0" winning="true" sold-by-credit-card="false" manual-cancel="false" ticket-type="1" total-bets="0" payout-blocked="false" serial-no-generated-from-barcode="false" payout-input-channel="0" offline="false" status="1" trans-type="200" ticket-from="0" absorption-paid="false" dev-id="0" merchant-id="0"><serial-no>9pkxn/npytVqVbOF5fPlsg==</serial-no><validation-code>111111</validation-code><raw-serial-no>S-123456</raw-serial-no><PIN>!!!!</PIN><total-amount>200</total-amount><transaction merchant-id="111" type="301" manual-cancel="false" device-id="111" settlement-flag="0" response-code="200" version="0"><operator-id>OPERATOR-111</operator-id><trans-timestamp>2015-05-29T17:13:36.000+08:00</trans-timestamp><game-id>LK-1</game-id><trace-message-id>1432890816424</trace-message-id><longitude>40.714353</longitude><parent-merchants>1,222</parent-merchants><latitude>-74.005973</latitude><total-amount>833.33</total-amount><batch-number>20150529</batch-number><ticket-serial-no>9pkxn/npytVqVbOF5fPlsg==</ticket-serial-no><gpe-id>GPE-111</gpe-id><update-time>2015-05-29T17:13:36.000+08:00</update-time><create-time>2015-05-29T17:13:36.000+08:00</create-time><id>0115052900000000001847</id></transaction><game-instance xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:java="http://java.sun.com" start-of-sequence="1" end-of-sequence="10" sale-suspended="false" version="1" state="2" payout-blocked="false" max-claim-days="3650" suspend-manual-cancel="false" risk-control-method="2" xsi:type="java:com.mpos.lottery.te.gameimpl.magic100.game.Magic100GameInstance"><number>001</number><end-time>2015-09-06T17:12:15.000+08:00</end-time><max-loss-amount>15000</max-loss-amount><game-id>LK-1</game-id><freeze-time>2015-09-06T17:42:15.000+08:00</freeze-time><percentage-of-turnover>0.4</percentage-of-turnover><id>GII-111</id><begin-time>2015-05-28T17:12:15.000+08:00</begin-time><game state="1" type="18" need-auto-payout="true"><tax-policy-id>TP-1</tax-policy-id><operator-parameter-id>LK-OP-1</operator-parameter-id><name>Lucky8</name><id>LK-1</id><tax-method-base>2</tax-method-base><tax-method>2</tax-method></game><draw-date>2015-09-06T17:12:15.000+08:00</draw-date><key>001-LK-1</key><name>active game instance</name></game-instance><update-time>2015-05-29T17:13:36.437+08:00</update-time><create-time>2015-05-29T17:13:36.437+08:00</create-time></Ticket><PrizeItem type="1"><GameDraw number="001" gameId="LK-1"/></PrizeItem></Prize>):feabe55a260fe5f4d21b4bf71274850b
[2015-05-29 17:13:36,518][Test worker][DEBUG][TEPortServlet] Write response to client(host1=localhost,sizeOfPack=3616) succesfully.
[2015-05-29 17:13:36,519][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=3616): <?xml version="1.0" encoding="UTF-8"?>
<Prize returnAmount="0" mode="0" prizeAmount="1000" taxAmount="166.67" actualAmount="833.33" luckyAmount="0" isVerifyPIN="0"><Ticket multiple-draws="1" count-of-lucky-winning="0" lucky-winning="true" count-in-pool="true" version="0" winning="true" sold-by-credit-card="false" manual-cancel="false" ticket-type="1" total-bets="0" payout-blocked="false" serial-no-generated-from-barcode="false" payout-input-channel="0" offline="false" status="1" trans-type="200" ticket-from="0" absorption-paid="false" dev-id="0" merchant-id="0"><serial-no>9pkxn/npytVqVbOF5fPlsg==</serial-no><validation-code>111111</validation-code><raw-serial-no>S-123456</raw-serial-no><PIN>!!!!</PIN><total-amount>200</total-amount><transaction merchant-id="111" type="301" manual-cancel="false" device-id="111" settlement-flag="0" response-code="200" version="0"><operator-id>OPERATOR-111</operator-id><trans-timestamp>2015-05-29T17:13:36.000+08:00</trans-timestamp><game-id>LK-1</game-id><trace-message-id>1432890816424</trace-message-id><longitude>40.714353</longitude><parent-merchants>1,222</parent-merchants><latitude>-74.005973</latitude><total-amount>833.33</total-amount><batch-number>20150529</batch-number><ticket-serial-no>9pkxn/npytVqVbOF5fPlsg==</ticket-serial-no><gpe-id>GPE-111</gpe-id><update-time>2015-05-29T17:13:36.000+08:00</update-time><create-time>2015-05-29T17:13:36.000+08:00</create-time><id>0115052900000000001847</id></transaction><game-instance xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:java="http://java.sun.com" start-of-sequence="1" end-of-sequence="10" sale-suspended="false" version="1" state="2" payout-blocked="false" max-claim-days="3650" suspend-manual-cancel="false" risk-control-method="2" xsi:type="java:com.mpos.lottery.te.gameimpl.magic100.game.Magic100GameInstance"><number>001</number><end-time>2015-09-06T17:12:15.000+08:00</end-time><max-loss-amount>15000</max-loss-amount><game-id>LK-1</game-id><freeze-time>2015-09-06T17:42:15.000+08:00</freeze-time><percentage-of-turnover>0.4</percentage-of-turnover><id>GII-111</id><begin-time>2015-05-28T17:12:15.000+08:00</begin-time><game state="1" type="18" need-auto-payout="true"><tax-policy-id>TP-1</tax-policy-id><operator-parameter-id>LK-OP-1</operator-parameter-id><name>Lucky8</name><id>LK-1</id><tax-method-base>2</tax-method-base><tax-method>2</tax-method></game><draw-date>2015-09-06T17:12:15.000+08:00</draw-date><key>001-LK-1</key><name>active game instance</name></game-instance><update-time>2015-05-29T17:13:36.437+08:00</update-time><create-time>2015-05-29T17:13:36.437+08:00</create-time></Ticket><PrizeItem type="1"><GameDraw number="001" gameId="LK-1"/></PrizeItem></Prize>
[2015-05-29 17:13:36,519][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/EnquiryPrize_Res.xml) by key(18.transtype.4301).
]]></system-out>
  <system-err><![CDATA[]]></system-err>
</testsuite>
