<?xml version="1.0" encoding="UTF-8"?>
<testsuite name="com.mpos.lottery.te.gameimpl.lotto.sale.MannualCancelByTicketIntegrationTest" tests="4" skipped="0" failures="0" errors="0" timestamp="2015-05-29T09:13:29" hostname="Ramon-PC" time="0.431">
  <properties/>
  <testcase name="testCancel_RemovedOperator" classname="com.mpos.lottery.te.gameimpl.lotto.sale.MannualCancelByTicketIntegrationTest" time="0.1"/>
  <testcase name="testCancel_Game_Disable" classname="com.mpos.lottery.te.gameimpl.lotto.sale.MannualCancelByTicketIntegrationTest" time="0.098"/>
  <testcase name="testCancel_OK" classname="com.mpos.lottery.te.gameimpl.lotto.sale.MannualCancelByTicketIntegrationTest" time="0.137"/>
  <testcase name="testCancel_GameInstance_Disable" classname="com.mpos.lottery.te.gameimpl.lotto.sale.MannualCancelByTicketIntegrationTest" time="0.093"/>
  <system-out><![CDATA[[2015-05-29 17:13:29,884][Test worker][DEBUG][TEPortServlet] Startup job scheduer(org.quartz.impl.StdScheduler@4d1e5820) successfully.
[2015-05-29 17:13:29,885][Test worker][WARN ][TEPortServlet] can NOT find META file:F:\project\M.Lottery\TE\TRUNK_TE\sourcecode\build\classes\main\META-INF\MANIFEST.MF
[2015-05-29 17:13:29,885][Test worker][DEBUG][TEPortServlet] Register MBean(com.mpos.lottery.te.common.jmx.TransactionTimeout@3de47a2f) with name(com.mpos.lottery.te:type=TransactionTimeoutMBean) successfully.
[2015-05-29 17:13:29,885][Test worker][DEBUG][BaseTransactionalIntegrationTest] Retrieve a ApplicationContext(org.springframework.web.context.support.GenericWebApplicationContext@34f645a8: startup date [Fri May 29 17:12:38 CST 2015]; root of context hierarchy).
[2015-05-29 17:13:29,885][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:29,885][Test worker][INFO ][BaseTransactionalIntegrationTest] | MannualCancelByTicketIntegrationTest.testCancel_RemovedOperator                                                        |
[2015-05-29 17:13:29,885][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:29,886][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:29,887][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/SellTicket_Req.xml).
[2015-05-29 17:13:29,887][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890809886|Timestamp:20150529171329|Transaction-Type:200|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>,hash=245196813), get digest:fb74efa1fc3768eb949c522694276f91
[2015-05-29 17:13:29,888][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=200).
[2015-05-29 17:13:29,888][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:29,888][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171329).
[2015-05-29 17:13:29,888][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:29,888][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890809886).
[2015-05-29 17:13:29,888][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:29,888][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:29,888][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=fb74efa1fc3768eb949c522694276f91).
[2015-05-29 17:13:29,888][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=1).
[2015-05-29 17:13:29,888][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:29,888][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:29,890][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6vvj1C28m6E+ybhcq2GHfncNCEmxnE1Ou0qcmJ+qutg9pDpTDScnIWI62pEFB0SGtKkhmSVtwRhObbaRtENvsKgd1vgEj9cakrUbLVxBSMJqciae7U9vnZ9gkPZ+TiqwdRl/00lYrPXIRF649XUAfZ/u7Ik8R7r7YZCfSM8Dq3Lk3E+I+8dy5FMq1JBSOx+CBYDZ3n4iWwIrRwN3i9ic9EHYxaBXmh5eMdb+eYfmG3rw7BmwCbT+5YlwzT8o+qK8+x+tCRF0yCaqlMPxlqr0c+eFde9h31TBTgqMtIWk2Ux1nb1TPJ2uDK+Ee2oZ5RgoEzb/nuc9f7RCFw4/R0o1FObopbRaJ9qpV2PI6XK6rtTl1lpL4o22ySC7lKR344K/b+MKthKWb3jb.
[2015-05-29 17:13:29,890][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890809886|Timestamp:20150529171329|Transaction-Type:200|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:29,890][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>
[2015-05-29 17:13:29,891][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890809886|Timestamp:20150529171329|Transaction-Type:200|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>,hash=245196813), get digest:fb74efa1fc3768eb949c522694276f91
[2015-05-29 17:13:29,891][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:29,891][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/lotto/SellTicket_Req.xml
[2015-05-29 17:13:29,891][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:29,904][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_200_1.5.0).
[2015-05-29 17:13:29,904][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_200_).
[2015-05-29 17:13:29,904][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(1_200_), found controller(com.mpos.lottery.te.gameimpl.lotto.LottoController@388c6589) and method(public void com.mpos.lottery.te.gameimpl.lotto.LottoController.sell(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:29,910][Test worker][DEBUG][BaseJpaDao] Query future game instance(class com.mpos.lottery.te.gameimpl.lotto.draw.domain.LottoGameInstance) by(number=20090408,gameId=GAME-111, multipleDraws=2, state=1||2):1
[2015-05-29 17:13:29,915][Test worker][DEBUG][AbstractGameInstanceService] Use channel game instance time definition(IGPE-1).
[2015-05-29 17:13:29,915][Test worker][DEBUG][UUIDServiceImpl] Assemble a new ticket serial number:01110745119300010808
[2015-05-29 17:13:29,921][Test worker][DEBUG][DefaultTicketValidator] THe max allowed multi-draw of operation parameter is 10, merchant limit to 3, the smaller 3 will be used.
[2015-05-29 17:13:29,921][Test worker][DEBUG][DefaultSelectedNumberValidatorFactory] Found ticket validator(com.mpos.lottery.te.gamespec.sale.support.validator.SingleSelectedNumberValidator@108c9386) for bet option:1
[2015-05-29 17:13:29,921][Test worker][DEBUG][DefaultSelectedNumberValidatorFactory] Found ticket validator(com.mpos.lottery.te.gamespec.sale.support.validator.MultipleSelectedNumberValidator@7d294ae6) for bet option:2
[2015-05-29 17:13:29,934][Test worker][DEBUG][DefaultBalanceService] Operator before transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:29,934][Test worker][DEBUG][DefaultBalanceService] Found balance strategy:com.mpos.lottery.te.merchant.service.balance.SaleBalanceStrategy@e1f8aba
[2015-05-29 17:13:29,934][Test worker][DEBUG][DefaultBalanceService] Operator after transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=199998400, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:29,943][Test worker][DEBUG][CommonFacadeService] Prepare to publish message to exchange[TE.200] with routing key[TE.200.1]: transaction {
  id: "0115052900000000001557"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890809000
  trans_type: 200
  game_id: "GAME-111"
  game_type: 1
  total_amount: "1600"
}
multi_draw: 2
total_amount: "1600"
serial_no: "aHhDkgTyIu7OH55EgjjAPwYfHekhQ7sb"
game_instance {
  id: "GII-113"
}
entries {
  selected_number: "1,2,3,6,7,13"
  bet_option: 1
  total_bets: 1
  entry_amount: "100"
  input_channel: "1"
}
entries {
  selected_number: "3,11,14,16,22,25,36"
  bet_option: 2
  total_bets: 7
  entry_amount: "700"
  input_channel: "1"
}

[2015-05-29 17:13:29,943][Test worker][DEBUG][CommonFacadeService] Publish message successfully
[2015-05-29 17:13:29,943][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:29,943][Test worker][DEBUG][ProtocolSerializer] Start to serialize model(class com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket),mappingFile=xml-mapping/game/lotto/SellTicket_Res.xml
[2015-05-29 17:13:29,943][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:29,944][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/SellTicket_Res.xml).
[2015-05-29 17:13:29,944][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890809886|Timestamp:20150529171329|Transaction-Type:4200|Transaction-Id:0115052900000000001557|Response-Code:200|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300010808" type="1" lastDrawNo="20090416" barcode="01cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt8eRiXxElYKctyxR2V9Li0thR1WrRfggI8=" validationCode="138472" multipleDraws="2" totalBets="16" totalAmount="1600"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" entryAmount="100" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" entryAmount="700" boostAmount="0"/></Ticket>):2959ab84cc9d0333a017f3fa32dc2aca
[2015-05-29 17:13:29,945][Test worker][DEBUG][TEPortServlet] Write response to client(host1=localhost,sizeOfPack=736) succesfully.
[2015-05-29 17:13:29,945][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=736): <?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300010808" type="1" lastDrawNo="20090416" barcode="01cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt8eRiXxElYKctyxR2V9Li0thR1WrRfggI8=" validationCode="138472" multipleDraws="2" totalBets="16" totalAmount="1600"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" entryAmount="100" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" entryAmount="700" boostAmount="0"/></Ticket>
[2015-05-29 17:13:29,945][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:29,953][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/CancelTicket_Req.xml) by key(1.transtype.201).
[2015-05-29 17:13:29,961][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/CancelTicket_Req.xml).
[2015-05-29 17:13:29,962][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890809953|Timestamp:20150529171329|Transaction-Type:201|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300010808" isMannul="1"/>,hash=492264033), get digest:ad8fdeec8574b77571f5478a4bc39b0c
[2015-05-29 17:13:29,962][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=201).
[2015-05-29 17:13:29,962][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:29,962][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171329).
[2015-05-29 17:13:29,962][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:29,962][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890809953).
[2015-05-29 17:13:29,962][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:29,962][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:29,962][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=ad8fdeec8574b77571f5478a4bc39b0c).
[2015-05-29 17:13:29,962][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=1).
[2015-05-29 17:13:29,962][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:29,962][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:29,964][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6ttFDFcpmi1MamgAomcAmY7eTM16XgcUTsY0pFSZpEpJ+6Q2vXDjdbc+UTjd9jVAMd3gPTEp5zof.
[2015-05-29 17:13:29,964][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890809953|Timestamp:20150529171329|Transaction-Type:201|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:29,964][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300010808" isMannul="1"/>
[2015-05-29 17:13:29,965][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890809953|Timestamp:20150529171329|Transaction-Type:201|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300010808" isMannul="1"/>,hash=492264033), get digest:ad8fdeec8574b77571f5478a4bc39b0c
[2015-05-29 17:13:29,965][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/CancelTicket_Req.xml) by key(1.transtype.201).
[2015-05-29 17:13:29,965][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/lotto/CancelTicket_Req.xml
[2015-05-29 17:13:29,965][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/CancelTicket_Req.xml) by key(1.transtype.201).
[2015-05-29 17:13:29,971][Test worker][ERROR][TEPortServlet] operator(id=OPERATOR-111) is not active.
com.mpos.lottery.te.config.exception.ApplicationException: operator(id=OPERATOR-111) is not active.
	at com.mpos.lottery.te.port.service.CommonFacadeService.checkOperatorMerchant(CommonFacadeService.java:304)
	at com.mpos.lottery.te.port.service.CommonFacadeService.facade(CommonFacadeService.java:88)
	at sun.reflect.GeneratedMethodAccessor83.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:190)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:157)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:98)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:262)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:95)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:92)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:207)
	at com.sun.proxy.$Proxy85.facade(Unknown Source)
	at com.mpos.lottery.te.port.TEPortServlet.doPost(TEPortServlet.java:121)
	at com.mpos.lottery.te.test.integration.BaseServletIntegrationTest.doPost(BaseServletIntegrationTest.java:80)
	at com.mpos.lottery.te.gameimpl.lotto.sale.MannualCancelByTicketIntegrationTest.testCancel_RemovedOperator(MannualCancelByTicketIntegrationTest.java:102)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:74)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
	at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:83)
	at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:72)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:233)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:87)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:71)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:176)
	at org.junit.runners.Suite.runChild(Suite.java:127)
	at org.junit.runners.Suite.runChild(Suite.java:26)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecuter.runTestClass(JUnitTestClassExecuter.java:86)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecuter.execute(JUnitTestClassExecuter.java:49)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassProcessor.processTestClass(JUnitTestClassProcessor.java:69)
	at org.gradle.api.internal.tasks.testing.SuiteTestClassProcessor.processTestClass(SuiteTestClassProcessor.java:48)
	at sun.reflect.GeneratedMethodAccessor8.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:35)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)
	at org.gradle.messaging.dispatch.ContextClassLoaderDispatch.dispatch(ContextClassLoaderDispatch.java:32)
	at org.gradle.messaging.dispatch.ProxyDispatchAdapter$DispatchingInvocationHandler.invoke(ProxyDispatchAdapter.java:93)
	at com.sun.proxy.$Proxy2.processTestClass(Unknown Source)
	at org.gradle.api.internal.tasks.testing.worker.TestWorker.processTestClass(TestWorker.java:105)
	at sun.reflect.GeneratedMethodAccessor7.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:35)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)
	at org.gradle.messaging.remote.internal.hub.MessageHub$Handler.run(MessageHub.java:360)
	at org.gradle.internal.concurrent.DefaultExecutorFactory$StoppableExecutorImpl$1.run(DefaultExecutorFactory.java:64)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
	at java.lang.Thread.run(Thread.java:745)
[2015-05-29 17:13:29,972][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890809953|Timestamp:20150529171329|Transaction-Type:4201|Transaction-Id:|Response-Code:224|):295972f912b836d2f120d462512af43f
[2015-05-29 17:13:29,972][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=224,length=0): 
[2015-05-29 17:13:29,980][Test worker][DEBUG][TEPortServlet] Startup job scheduer(org.quartz.impl.StdScheduler@4d1e5820) successfully.
[2015-05-29 17:13:29,980][Test worker][WARN ][TEPortServlet] can NOT find META file:F:\project\M.Lottery\TE\TRUNK_TE\sourcecode\build\classes\main\META-INF\MANIFEST.MF
[2015-05-29 17:13:29,980][Test worker][DEBUG][TEPortServlet] Register MBean(com.mpos.lottery.te.common.jmx.TransactionTimeout@f2973a9) with name(com.mpos.lottery.te:type=TransactionTimeoutMBean) successfully.
[2015-05-29 17:13:29,981][Test worker][DEBUG][BaseTransactionalIntegrationTest] Retrieve a ApplicationContext(org.springframework.web.context.support.GenericWebApplicationContext@34f645a8: startup date [Fri May 29 17:12:38 CST 2015]; root of context hierarchy).
[2015-05-29 17:13:29,981][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:29,981][Test worker][INFO ][BaseTransactionalIntegrationTest] | MannualCancelByTicketIntegrationTest.testCancel_Game_Disable                                                           |
[2015-05-29 17:13:29,981][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:29,982][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:29,983][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/SellTicket_Req.xml).
[2015-05-29 17:13:29,983][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890809982|Timestamp:20150529171329|Transaction-Type:200|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>,hash=1965726090), get digest:856bfdfd712b0fd692fd3f88871a8eb9
[2015-05-29 17:13:29,984][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=200).
[2015-05-29 17:13:29,984][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:29,984][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171329).
[2015-05-29 17:13:29,984][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:29,984][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890809982).
[2015-05-29 17:13:29,984][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:29,984][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:29,984][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=856bfdfd712b0fd692fd3f88871a8eb9).
[2015-05-29 17:13:29,984][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=1).
[2015-05-29 17:13:29,984][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:29,984][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:29,986][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6vvj1C28m6E+ybhcq2GHfncNCEmxnE1Ou0qcmJ+qutg9pDpTDScnIWI62pEFB0SGtKkhmSVtwRhObbaRtENvsKgd1vgEj9cakrUbLVxBSMJqciae7U9vnZ9gkPZ+TiqwdRl/00lYrPXIRF649XUAfZ/u7Ik8R7r7YZCfSM8Dq3Lk3E+I+8dy5FMq1JBSOx+CBYDZ3n4iWwIrRwN3i9ic9EHYxaBXmh5eMdb+eYfmG3rw7BmwCbT+5YlwzT8o+qK8+x+tCRF0yCaqlMPxlqr0c+eFde9h31TBTgqMtIWk2Ux1nb1TPJ2uDK+Ee2oZ5RgoEzb/nuc9f7RCFw4/R0o1FObopbRaJ9qpV2PI6XK6rtTl1lpL4o22ySC7lKR344K/b+MKthKWb3jb.
[2015-05-29 17:13:29,986][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890809982|Timestamp:20150529171329|Transaction-Type:200|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:29,987][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>
[2015-05-29 17:13:29,987][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890809982|Timestamp:20150529171329|Transaction-Type:200|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>,hash=1965726090), get digest:856bfdfd712b0fd692fd3f88871a8eb9
[2015-05-29 17:13:29,987][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:29,987][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/lotto/SellTicket_Req.xml
[2015-05-29 17:13:29,987][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:30,003][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_200_1.5.0).
[2015-05-29 17:13:30,003][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_200_).
[2015-05-29 17:13:30,003][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(1_200_), found controller(com.mpos.lottery.te.gameimpl.lotto.LottoController@388c6589) and method(public void com.mpos.lottery.te.gameimpl.lotto.LottoController.sell(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:30,009][Test worker][DEBUG][BaseJpaDao] Query future game instance(class com.mpos.lottery.te.gameimpl.lotto.draw.domain.LottoGameInstance) by(number=20090408,gameId=GAME-111, multipleDraws=2, state=1||2):1
[2015-05-29 17:13:30,014][Test worker][DEBUG][AbstractGameInstanceService] Use channel game instance time definition(IGPE-1).
[2015-05-29 17:13:30,014][Test worker][DEBUG][UUIDServiceImpl] Assemble a new ticket serial number:01110745119300010954
[2015-05-29 17:13:30,020][Test worker][DEBUG][DefaultTicketValidator] THe max allowed multi-draw of operation parameter is 10, merchant limit to 3, the smaller 3 will be used.
[2015-05-29 17:13:30,020][Test worker][DEBUG][DefaultSelectedNumberValidatorFactory] Found ticket validator(com.mpos.lottery.te.gamespec.sale.support.validator.SingleSelectedNumberValidator@38d29ac3) for bet option:1
[2015-05-29 17:13:30,020][Test worker][DEBUG][DefaultSelectedNumberValidatorFactory] Found ticket validator(com.mpos.lottery.te.gamespec.sale.support.validator.MultipleSelectedNumberValidator@aae955a) for bet option:2
[2015-05-29 17:13:30,035][Test worker][DEBUG][DefaultBalanceService] Operator before transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:30,035][Test worker][DEBUG][DefaultBalanceService] Found balance strategy:com.mpos.lottery.te.merchant.service.balance.SaleBalanceStrategy@e1f8aba
[2015-05-29 17:13:30,035][Test worker][DEBUG][DefaultBalanceService] Operator after transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=199998400, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:30,044][Test worker][DEBUG][CommonFacadeService] Prepare to publish message to exchange[TE.200] with routing key[TE.200.1]: transaction {
  id: "0115052900000000001562"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890809000
  trans_type: 200
  game_id: "GAME-111"
  game_type: 1
  total_amount: "1600"
}
multi_draw: 2
total_amount: "1600"
serial_no: "aHhDkgTyIu7OH55EgjjAP63NFyTTLETP"
game_instance {
  id: "GII-113"
}
entries {
  selected_number: "1,2,3,6,7,13"
  bet_option: 1
  total_bets: 1
  entry_amount: "100"
  input_channel: "1"
}
entries {
  selected_number: "3,11,14,16,22,25,36"
  bet_option: 2
  total_bets: 7
  entry_amount: "700"
  input_channel: "1"
}

[2015-05-29 17:13:30,044][Test worker][DEBUG][CommonFacadeService] Publish message successfully
[2015-05-29 17:13:30,044][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:30,044][Test worker][DEBUG][ProtocolSerializer] Start to serialize model(class com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket),mappingFile=xml-mapping/game/lotto/SellTicket_Res.xml
[2015-05-29 17:13:30,044][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:30,045][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/SellTicket_Res.xml).
[2015-05-29 17:13:30,045][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890809982|Timestamp:20150529171329|Transaction-Type:4200|Transaction-Id:0115052900000000001562|Response-Code:200|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300010954" type="1" lastDrawNo="20090416" barcode="01cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt8eRiXxElYKctyxR2V9Li0tNjJOX2lIZyc=" validationCode="305212" multipleDraws="2" totalBets="16" totalAmount="1600"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" entryAmount="100" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" entryAmount="700" boostAmount="0"/></Ticket>):503deb907a818384be60306947615e28
[2015-05-29 17:13:30,046][Test worker][DEBUG][TEPortServlet] Write response to client(host1=localhost,sizeOfPack=736) succesfully.
[2015-05-29 17:13:30,046][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=736): <?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300010954" type="1" lastDrawNo="20090416" barcode="01cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt8eRiXxElYKctyxR2V9Li0tNjJOX2lIZyc=" validationCode="305212" multipleDraws="2" totalBets="16" totalAmount="1600"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" entryAmount="100" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" entryAmount="700" boostAmount="0"/></Ticket>
[2015-05-29 17:13:30,046][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:30,052][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/CancelTicket_Req.xml) by key(1.transtype.201).
[2015-05-29 17:13:30,053][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/CancelTicket_Req.xml).
[2015-05-29 17:13:30,053][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810052|Timestamp:20150529171330|Transaction-Type:201|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300010954" isMannul="1"/>,hash=-2051171601), get digest:ed41dd4b74c03606c33e6c4ce81c35b2
[2015-05-29 17:13:30,053][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=201).
[2015-05-29 17:13:30,053][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:30,053][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171330).
[2015-05-29 17:13:30,053][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:30,053][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890810052).
[2015-05-29 17:13:30,053][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:30,053][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:30,053][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=ed41dd4b74c03606c33e6c4ce81c35b2).
[2015-05-29 17:13:30,053][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=1).
[2015-05-29 17:13:30,053][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:30,053][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:30,053][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6ttFDFcpmi1MamgAomcAmY7eTM16XgcUTsY0pFSZpEpJhuPHbL4OvcBZyDrI7OSWGbwQPuBsSw4u.
[2015-05-29 17:13:30,054][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810052|Timestamp:20150529171330|Transaction-Type:201|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:30,054][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300010954" isMannul="1"/>
[2015-05-29 17:13:30,054][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810052|Timestamp:20150529171330|Transaction-Type:201|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300010954" isMannul="1"/>,hash=-2051171601), get digest:ed41dd4b74c03606c33e6c4ce81c35b2
[2015-05-29 17:13:30,054][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/CancelTicket_Req.xml) by key(1.transtype.201).
[2015-05-29 17:13:30,054][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/lotto/CancelTicket_Req.xml
[2015-05-29 17:13:30,054][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/CancelTicket_Req.xml) by key(1.transtype.201).
[2015-05-29 17:13:30,062][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_201_1.5.0).
[2015-05-29 17:13:30,063][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_201_).
[2015-05-29 17:13:30,063][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(1_201_), found controller(com.mpos.lottery.te.gameimpl.lotto.LottoController@388c6589) and method(public void com.mpos.lottery.te.gameimpl.lotto.LottoController.cancelByTicket(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:30,066][Test worker][DEBUG][ReversalOrCancelStrategyFactory] Found ReversalStrategy(class com.mpos.lottery.te.gameimpl.lotto.sale.service.impl.LottoTicketServiceImpl) to cancel transaction(gameType=1,terminalId=111,transType=200,protocolVersion=1.5.0).
[2015-05-29 17:13:30,070][Test worker][ERROR][TEPortServlet] No manual cancellation allowed of game (gameId=GAME-111).
com.mpos.lottery.te.config.exception.ApplicationException: No manual cancellation allowed of game (gameId=GAME-111).
	at com.mpos.lottery.te.gamespec.sale.service.AbstractTicketService.allowManualCancellation(AbstractTicketService.java:376)
	at com.mpos.lottery.te.gamespec.sale.service.AbstractTicketService.cancelByTicket(AbstractTicketService.java:217)
	at com.mpos.lottery.te.gamespec.sale.service.AbstractTicketService.cancelOrReverse(AbstractTicketService.java:283)
	at com.mpos.lottery.te.trans.service.impl.TransactionServiceImpl.reverseOrCancel(TransactionServiceImpl.java:203)
	at com.mpos.lottery.te.trans.service.impl.TransactionServiceImpl.reverseOrCancel(TransactionServiceImpl.java:227)
	at sun.reflect.GeneratedMethodAccessor288.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:190)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:157)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:98)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:262)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:95)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:92)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:207)
	at com.sun.proxy.$Proxy55.reverseOrCancel(Unknown Source)
	at com.mpos.lottery.te.gameimpl.lotto.LottoController.cancelByTicket(LottoController.java:43)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at com.mpos.lottery.common.router.RoutineRegistry.route(RoutineRegistry.java:57)
	at com.mpos.lottery.te.port.service.CommonFacadeService.routeRequest(CommonFacadeService.java:237)
	at com.mpos.lottery.te.port.service.CommonFacadeService.facade(CommonFacadeService.java:96)
	at sun.reflect.GeneratedMethodAccessor83.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:190)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:157)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:98)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:262)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:95)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:92)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:207)
	at com.sun.proxy.$Proxy85.facade(Unknown Source)
	at com.mpos.lottery.te.port.TEPortServlet.doPost(TEPortServlet.java:121)
	at com.mpos.lottery.te.test.integration.BaseServletIntegrationTest.doPost(BaseServletIntegrationTest.java:80)
	at com.mpos.lottery.te.gameimpl.lotto.sale.MannualCancelByTicketIntegrationTest.testCancel_Game_Disable(MannualCancelByTicketIntegrationTest.java:132)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:74)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
	at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:83)
	at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:72)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:233)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:87)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:71)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:176)
	at org.junit.runners.Suite.runChild(Suite.java:127)
	at org.junit.runners.Suite.runChild(Suite.java:26)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecuter.runTestClass(JUnitTestClassExecuter.java:86)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecuter.execute(JUnitTestClassExecuter.java:49)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassProcessor.processTestClass(JUnitTestClassProcessor.java:69)
	at org.gradle.api.internal.tasks.testing.SuiteTestClassProcessor.processTestClass(SuiteTestClassProcessor.java:48)
	at sun.reflect.GeneratedMethodAccessor8.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:35)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)
	at org.gradle.messaging.dispatch.ContextClassLoaderDispatch.dispatch(ContextClassLoaderDispatch.java:32)
	at org.gradle.messaging.dispatch.ProxyDispatchAdapter$DispatchingInvocationHandler.invoke(ProxyDispatchAdapter.java:93)
	at com.sun.proxy.$Proxy2.processTestClass(Unknown Source)
	at org.gradle.api.internal.tasks.testing.worker.TestWorker.processTestClass(TestWorker.java:105)
	at sun.reflect.GeneratedMethodAccessor7.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:35)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)
	at org.gradle.messaging.remote.internal.hub.MessageHub$Handler.run(MessageHub.java:360)
	at org.gradle.internal.concurrent.DefaultExecutorFactory$StoppableExecutorImpl$1.run(DefaultExecutorFactory.java:64)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
	at java.lang.Thread.run(Thread.java:745)
[2015-05-29 17:13:30,071][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810052|Timestamp:20150529171330|Transaction-Type:4201|Transaction-Id:0115052900000000001567|Response-Code:261|):93013ac560689d97cdf4b63a156c6645
[2015-05-29 17:13:30,071][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=261,length=0): 
[2015-05-29 17:13:30,079][Test worker][DEBUG][TEPortServlet] Startup job scheduer(org.quartz.impl.StdScheduler@4d1e5820) successfully.
[2015-05-29 17:13:30,079][Test worker][WARN ][TEPortServlet] can NOT find META file:F:\project\M.Lottery\TE\TRUNK_TE\sourcecode\build\classes\main\META-INF\MANIFEST.MF
[2015-05-29 17:13:30,079][Test worker][DEBUG][TEPortServlet] Register MBean(com.mpos.lottery.te.common.jmx.TransactionTimeout@3340156d) with name(com.mpos.lottery.te:type=TransactionTimeoutMBean) successfully.
[2015-05-29 17:13:30,079][Test worker][DEBUG][BaseTransactionalIntegrationTest] Retrieve a ApplicationContext(org.springframework.web.context.support.GenericWebApplicationContext@34f645a8: startup date [Fri May 29 17:12:38 CST 2015]; root of context hierarchy).
[2015-05-29 17:13:30,079][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:30,079][Test worker][INFO ][BaseTransactionalIntegrationTest] | MannualCancelByTicketIntegrationTest.testCancel_OK                                                                     |
[2015-05-29 17:13:30,079][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:30,080][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:30,080][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/SellTicket_Req.xml).
[2015-05-29 17:13:30,081][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810080|Timestamp:20150529171330|Transaction-Type:200|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>,hash=-664305197), get digest:7bbf5829e035544c609038c7b1a6f3fa
[2015-05-29 17:13:30,081][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=200).
[2015-05-29 17:13:30,081][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:30,081][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171330).
[2015-05-29 17:13:30,081][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:30,081][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890810080).
[2015-05-29 17:13:30,081][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:30,081][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:30,081][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=7bbf5829e035544c609038c7b1a6f3fa).
[2015-05-29 17:13:30,081][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=1).
[2015-05-29 17:13:30,081][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:30,081][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:30,083][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6vvj1C28m6E+ybhcq2GHfncNCEmxnE1Ou0qcmJ+qutg9pDpTDScnIWI62pEFB0SGtKkhmSVtwRhObbaRtENvsKgd1vgEj9cakrUbLVxBSMJqciae7U9vnZ9gkPZ+TiqwdRl/00lYrPXIRF649XUAfZ/u7Ik8R7r7YZCfSM8Dq3Lk3E+I+8dy5FMq1JBSOx+CBYDZ3n4iWwIrRwN3i9ic9EHYxaBXmh5eMdb+eYfmG3rw7BmwCbT+5YlwzT8o+qK8+x+tCRF0yCaqlMPxlqr0c+eFde9h31TBTgqMtIWk2Ux1nb1TPJ2uDK+Ee2oZ5RgoEzb/nuc9f7RCFw4/R0o1FObopbRaJ9qpV2PI6XK6rtTl1lpL4o22ySC7lKR344K/b+MKthKWb3jb.
[2015-05-29 17:13:30,083][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810080|Timestamp:20150529171330|Transaction-Type:200|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:30,083][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>
[2015-05-29 17:13:30,083][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810080|Timestamp:20150529171330|Transaction-Type:200|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>,hash=-664305197), get digest:7bbf5829e035544c609038c7b1a6f3fa
[2015-05-29 17:13:30,083][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:30,083][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/lotto/SellTicket_Req.xml
[2015-05-29 17:13:30,083][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:30,096][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_200_1.5.0).
[2015-05-29 17:13:30,096][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_200_).
[2015-05-29 17:13:30,097][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(1_200_), found controller(com.mpos.lottery.te.gameimpl.lotto.LottoController@388c6589) and method(public void com.mpos.lottery.te.gameimpl.lotto.LottoController.sell(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:30,103][Test worker][DEBUG][BaseJpaDao] Query future game instance(class com.mpos.lottery.te.gameimpl.lotto.draw.domain.LottoGameInstance) by(number=20090408,gameId=GAME-111, multipleDraws=2, state=1||2):1
[2015-05-29 17:13:30,108][Test worker][DEBUG][AbstractGameInstanceService] Use channel game instance time definition(IGPE-1).
[2015-05-29 17:13:30,108][Test worker][DEBUG][UUIDServiceImpl] Assemble a new ticket serial number:01110745119300011048
[2015-05-29 17:13:30,113][Test worker][DEBUG][DefaultTicketValidator] THe max allowed multi-draw of operation parameter is 10, merchant limit to 3, the smaller 3 will be used.
[2015-05-29 17:13:30,114][Test worker][DEBUG][DefaultSelectedNumberValidatorFactory] Found ticket validator(com.mpos.lottery.te.gamespec.sale.support.validator.SingleSelectedNumberValidator@7b8a711d) for bet option:1
[2015-05-29 17:13:30,114][Test worker][DEBUG][DefaultSelectedNumberValidatorFactory] Found ticket validator(com.mpos.lottery.te.gamespec.sale.support.validator.MultipleSelectedNumberValidator@3e086648) for bet option:2
[2015-05-29 17:13:30,131][Test worker][DEBUG][DefaultBalanceService] Operator before transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:30,131][Test worker][DEBUG][DefaultBalanceService] Found balance strategy:com.mpos.lottery.te.merchant.service.balance.SaleBalanceStrategy@e1f8aba
[2015-05-29 17:13:30,131][Test worker][DEBUG][DefaultBalanceService] Operator after transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=199998400, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:30,141][Test worker][DEBUG][CommonFacadeService] Prepare to publish message to exchange[TE.200] with routing key[TE.200.1]: transaction {
  id: "0115052900000000001568"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890810000
  trans_type: 200
  game_id: "GAME-111"
  game_type: 1
  total_amount: "1600"
}
multi_draw: 2
total_amount: "1600"
serial_no: "aHhDkgTyIu7OH55EgjjAPy3P6fWkhCHU"
game_instance {
  id: "GII-113"
}
entries {
  selected_number: "1,2,3,6,7,13"
  bet_option: 1
  total_bets: 1
  entry_amount: "100"
  input_channel: "1"
}
entries {
  selected_number: "3,11,14,16,22,25,36"
  bet_option: 2
  total_bets: 7
  entry_amount: "700"
  input_channel: "1"
}

[2015-05-29 17:13:30,141][Test worker][DEBUG][CommonFacadeService] Publish message successfully
[2015-05-29 17:13:30,141][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:30,141][Test worker][DEBUG][ProtocolSerializer] Start to serialize model(class com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket),mappingFile=xml-mapping/game/lotto/SellTicket_Res.xml
[2015-05-29 17:13:30,141][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:30,142][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/SellTicket_Res.xml).
[2015-05-29 17:13:30,142][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810080|Timestamp:20150529171330|Transaction-Type:4200|Transaction-Id:0115052900000000001568|Response-Code:200|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011048" type="1" lastDrawNo="20090416" barcode="01cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt8eRiXxElYKctyxR2V9Li0tVCoCyWcErTU=" validationCode="765883" multipleDraws="2" totalBets="16" totalAmount="1600"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" entryAmount="100" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" entryAmount="700" boostAmount="0"/></Ticket>):0cf199f16eef3908670b37f82233c102
[2015-05-29 17:13:30,143][Test worker][DEBUG][TEPortServlet] Write response to client(host1=localhost,sizeOfPack=736) succesfully.
[2015-05-29 17:13:30,143][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=736): <?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011048" type="1" lastDrawNo="20090416" barcode="01cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt8eRiXxElYKctyxR2V9Li0tVCoCyWcErTU=" validationCode="765883" multipleDraws="2" totalBets="16" totalAmount="1600"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" entryAmount="100" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" entryAmount="700" boostAmount="0"/></Ticket>
[2015-05-29 17:13:30,143][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:30,150][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/CancelTicket_Req.xml) by key(1.transtype.201).
[2015-05-29 17:13:30,150][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/CancelTicket_Req.xml).
[2015-05-29 17:13:30,150][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810149|Timestamp:20150529171330|Transaction-Type:201|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011048" isMannul="1"/>,hash=1786958881), get digest:a703ec9c989d15e6f4205cf4752a1042
[2015-05-29 17:13:30,150][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=201).
[2015-05-29 17:13:30,151][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:30,151][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171330).
[2015-05-29 17:13:30,151][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:30,151][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890810149).
[2015-05-29 17:13:30,151][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:30,151][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:30,151][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=a703ec9c989d15e6f4205cf4752a1042).
[2015-05-29 17:13:30,151][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=1).
[2015-05-29 17:13:30,151][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:30,151][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:30,152][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6ttFDFcpmi1MamgAomcAmY7eTM16XgcUTsY0pFSZpEpJrLXDrxOVKrdDjeACZbibEiOZlWku0wdg.
[2015-05-29 17:13:30,152][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810149|Timestamp:20150529171330|Transaction-Type:201|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:30,153][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011048" isMannul="1"/>
[2015-05-29 17:13:30,153][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810149|Timestamp:20150529171330|Transaction-Type:201|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011048" isMannul="1"/>,hash=1786958881), get digest:a703ec9c989d15e6f4205cf4752a1042
[2015-05-29 17:13:30,153][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/CancelTicket_Req.xml) by key(1.transtype.201).
[2015-05-29 17:13:30,153][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/lotto/CancelTicket_Req.xml
[2015-05-29 17:13:30,153][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/CancelTicket_Req.xml) by key(1.transtype.201).
[2015-05-29 17:13:30,167][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_201_1.5.0).
[2015-05-29 17:13:30,167][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_201_).
[2015-05-29 17:13:30,167][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(1_201_), found controller(com.mpos.lottery.te.gameimpl.lotto.LottoController@388c6589) and method(public void com.mpos.lottery.te.gameimpl.lotto.LottoController.cancelByTicket(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:30,172][Test worker][DEBUG][ReversalOrCancelStrategyFactory] Found ReversalStrategy(class com.mpos.lottery.te.gameimpl.lotto.sale.service.impl.LottoTicketServiceImpl) to cancel transaction(gameType=1,terminalId=111,transType=200,protocolVersion=1.5.0).
[2015-05-29 17:13:30,187][Test worker][DEBUG][DefaultBalanceService] Operator before transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=199998400, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:30,188][Test worker][DEBUG][DefaultBalanceService] Found balance strategy:com.mpos.lottery.te.merchant.service.balance.SaleBalanceStrategy@e1f8aba
[2015-05-29 17:13:30,188][Test worker][DEBUG][DefaultBalanceService] Operator after transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:30,198][Test worker][DEBUG][CommonFacadeService] Prepare to publish message to exchange[TE.200] with routing key[TE.CANCEL.200.1]: origTrans {
  id: "0115052900000000001568"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890810000
  trans_type: 200
  game_id: "GAME-111"
  game_type: 1
  total_amount: "1600"
}
cancelTrans {
  id: "0115052900000000001573"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890810000
  trans_type: 210
  game_id: "GAME-111"
  game_type: 1
  total_amount: "1600"
}

[2015-05-29 17:13:30,198][Test worker][DEBUG][CommonFacadeService] Publish message successfully
[2015-05-29 17:13:30,199][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810149|Timestamp:20150529171330|Transaction-Type:4201|Transaction-Id:0115052900000000001573|Response-Code:200|):b240b80dfafd01006a968f6666e2d8ff
[2015-05-29 17:13:30,199][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=0): 
[2015-05-29 17:13:30,216][Test worker][DEBUG][TEPortServlet] Startup job scheduer(org.quartz.impl.StdScheduler@4d1e5820) successfully.
[2015-05-29 17:13:30,217][Test worker][WARN ][TEPortServlet] can NOT find META file:F:\project\M.Lottery\TE\TRUNK_TE\sourcecode\build\classes\main\META-INF\MANIFEST.MF
[2015-05-29 17:13:30,217][Test worker][DEBUG][TEPortServlet] Register MBean(com.mpos.lottery.te.common.jmx.TransactionTimeout@73ce9e7e) with name(com.mpos.lottery.te:type=TransactionTimeoutMBean) successfully.
[2015-05-29 17:13:30,217][Test worker][DEBUG][BaseTransactionalIntegrationTest] Retrieve a ApplicationContext(org.springframework.web.context.support.GenericWebApplicationContext@34f645a8: startup date [Fri May 29 17:12:38 CST 2015]; root of context hierarchy).
[2015-05-29 17:13:30,217][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:30,217][Test worker][INFO ][BaseTransactionalIntegrationTest] | MannualCancelByTicketIntegrationTest.testCancel_GameInstance_Disable                                                   |
[2015-05-29 17:13:30,217][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:30,219][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:30,219][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/SellTicket_Req.xml).
[2015-05-29 17:13:30,220][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810219|Timestamp:20150529171330|Transaction-Type:200|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>,hash=1959415301), get digest:513217a016e7815af8aae163ce006745
[2015-05-29 17:13:30,220][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=200).
[2015-05-29 17:13:30,220][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:30,220][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171330).
[2015-05-29 17:13:30,220][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:30,220][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890810219).
[2015-05-29 17:13:30,220][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:30,220][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:30,220][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=513217a016e7815af8aae163ce006745).
[2015-05-29 17:13:30,220][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=1).
[2015-05-29 17:13:30,220][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:30,220][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:30,222][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6vvj1C28m6E+ybhcq2GHfncNCEmxnE1Ou0qcmJ+qutg9pDpTDScnIWI62pEFB0SGtKkhmSVtwRhObbaRtENvsKgd1vgEj9cakrUbLVxBSMJqciae7U9vnZ9gkPZ+TiqwdRl/00lYrPXIRF649XUAfZ/u7Ik8R7r7YZCfSM8Dq3Lk3E+I+8dy5FMq1JBSOx+CBYDZ3n4iWwIrRwN3i9ic9EHYxaBXmh5eMdb+eYfmG3rw7BmwCbT+5YlwzT8o+qK8+x+tCRF0yCaqlMPxlqr0c+eFde9h31TBTgqMtIWk2Ux1nb1TPJ2uDK+Ee2oZ5RgoEzb/nuc9f7RCFw4/R0o1FObopbRaJ9qpV2PI6XK6rtTl1lpL4o22ySC7lKR344K/b+MKthKWb3jb.
[2015-05-29 17:13:30,222][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810219|Timestamp:20150529171330|Transaction-Type:200|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:30,222][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>
[2015-05-29 17:13:30,222][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810219|Timestamp:20150529171330|Transaction-Type:200|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>,hash=1959415301), get digest:513217a016e7815af8aae163ce006745
[2015-05-29 17:13:30,223][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:30,223][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/lotto/SellTicket_Req.xml
[2015-05-29 17:13:30,223][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:30,236][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_200_1.5.0).
[2015-05-29 17:13:30,236][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_200_).
[2015-05-29 17:13:30,236][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(1_200_), found controller(com.mpos.lottery.te.gameimpl.lotto.LottoController@388c6589) and method(public void com.mpos.lottery.te.gameimpl.lotto.LottoController.sell(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:30,242][Test worker][DEBUG][BaseJpaDao] Query future game instance(class com.mpos.lottery.te.gameimpl.lotto.draw.domain.LottoGameInstance) by(number=20090408,gameId=GAME-111, multipleDraws=2, state=1||2):1
[2015-05-29 17:13:30,247][Test worker][DEBUG][AbstractGameInstanceService] Use channel game instance time definition(IGPE-1).
[2015-05-29 17:13:30,247][Test worker][DEBUG][UUIDServiceImpl] Assemble a new ticket serial number:01110745119300011122
[2015-05-29 17:13:30,252][Test worker][DEBUG][DefaultTicketValidator] THe max allowed multi-draw of operation parameter is 10, merchant limit to 3, the smaller 3 will be used.
[2015-05-29 17:13:30,253][Test worker][DEBUG][DefaultSelectedNumberValidatorFactory] Found ticket validator(com.mpos.lottery.te.gamespec.sale.support.validator.SingleSelectedNumberValidator@6c1554e4) for bet option:1
[2015-05-29 17:13:30,253][Test worker][DEBUG][DefaultSelectedNumberValidatorFactory] Found ticket validator(com.mpos.lottery.te.gamespec.sale.support.validator.MultipleSelectedNumberValidator@6c787c2b) for bet option:2
[2015-05-29 17:13:30,266][Test worker][DEBUG][DefaultBalanceService] Operator before transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:30,266][Test worker][DEBUG][DefaultBalanceService] Found balance strategy:com.mpos.lottery.te.merchant.service.balance.SaleBalanceStrategy@e1f8aba
[2015-05-29 17:13:30,266][Test worker][DEBUG][DefaultBalanceService] Operator after transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=199998400, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:30,275][Test worker][DEBUG][CommonFacadeService] Prepare to publish message to exchange[TE.200] with routing key[TE.200.1]: transaction {
  id: "0115052900000000001574"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890810000
  trans_type: 200
  game_id: "GAME-111"
  game_type: 1
  total_amount: "1600"
}
multi_draw: 2
total_amount: "1600"
serial_no: "aHhDkgTyIu7OH55EgjjAP7qk4Ngy3XYp"
game_instance {
  id: "GII-113"
}
entries {
  selected_number: "1,2,3,6,7,13"
  bet_option: 1
  total_bets: 1
  entry_amount: "100"
  input_channel: "1"
}
entries {
  selected_number: "3,11,14,16,22,25,36"
  bet_option: 2
  total_bets: 7
  entry_amount: "700"
  input_channel: "1"
}

[2015-05-29 17:13:30,276][Test worker][DEBUG][CommonFacadeService] Publish message successfully
[2015-05-29 17:13:30,276][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:30,276][Test worker][DEBUG][ProtocolSerializer] Start to serialize model(class com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket),mappingFile=xml-mapping/game/lotto/SellTicket_Res.xml
[2015-05-29 17:13:30,276][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:30,277][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/SellTicket_Res.xml).
[2015-05-29 17:13:30,277][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810219|Timestamp:20150529171330|Transaction-Type:4200|Transaction-Id:0115052900000000001574|Response-Code:200|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011122" type="1" lastDrawNo="20090416" barcode="01cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt8eRiXxElYKctyxR2V9Li0t0++oYwNA3dA=" validationCode="096369" multipleDraws="2" totalBets="16" totalAmount="1600"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" entryAmount="100" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" entryAmount="700" boostAmount="0"/></Ticket>):319775a0fa0319ff6e164c237e6f48be
[2015-05-29 17:13:30,277][Test worker][DEBUG][TEPortServlet] Write response to client(host1=localhost,sizeOfPack=736) succesfully.
[2015-05-29 17:13:30,278][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=736): <?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011122" type="1" lastDrawNo="20090416" barcode="01cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt8eRiXxElYKctyxR2V9Li0t0++oYwNA3dA=" validationCode="096369" multipleDraws="2" totalBets="16" totalAmount="1600"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" entryAmount="100" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" entryAmount="700" boostAmount="0"/></Ticket>
[2015-05-29 17:13:30,278][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:30,284][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/CancelTicket_Req.xml) by key(1.transtype.201).
[2015-05-29 17:13:30,284][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/CancelTicket_Req.xml).
[2015-05-29 17:13:30,285][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810284|Timestamp:20150529171330|Transaction-Type:201|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011122" isMannul="1"/>,hash=-1122613658), get digest:7a4197e1e4e08bfd13e9196523292623
[2015-05-29 17:13:30,285][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=201).
[2015-05-29 17:13:30,285][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:30,285][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171330).
[2015-05-29 17:13:30,285][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:30,285][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890810284).
[2015-05-29 17:13:30,285][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:30,285][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:30,285][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=7a4197e1e4e08bfd13e9196523292623).
[2015-05-29 17:13:30,285][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=1).
[2015-05-29 17:13:30,285][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:30,285][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:30,285][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6ttFDFcpmi1MamgAomcAmY7eTM16XgcUTsY0pFSZpEpJMMWLW3sJWmYjbBhxw/ckJJbB5xCt+1yz.
[2015-05-29 17:13:30,285][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810284|Timestamp:20150529171330|Transaction-Type:201|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:30,286][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011122" isMannul="1"/>
[2015-05-29 17:13:30,286][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810284|Timestamp:20150529171330|Transaction-Type:201|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011122" isMannul="1"/>,hash=-1122613658), get digest:7a4197e1e4e08bfd13e9196523292623
[2015-05-29 17:13:30,286][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/CancelTicket_Req.xml) by key(1.transtype.201).
[2015-05-29 17:13:30,286][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/lotto/CancelTicket_Req.xml
[2015-05-29 17:13:30,286][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/CancelTicket_Req.xml) by key(1.transtype.201).
[2015-05-29 17:13:30,295][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_201_1.5.0).
[2015-05-29 17:13:30,295][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_201_).
[2015-05-29 17:13:30,295][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(1_201_), found controller(com.mpos.lottery.te.gameimpl.lotto.LottoController@388c6589) and method(public void com.mpos.lottery.te.gameimpl.lotto.LottoController.cancelByTicket(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:30,299][Test worker][DEBUG][ReversalOrCancelStrategyFactory] Found ReversalStrategy(class com.mpos.lottery.te.gameimpl.lotto.sale.service.impl.LottoTicketServiceImpl) to cancel transaction(gameType=1,terminalId=111,transType=200,protocolVersion=1.5.0).
[2015-05-29 17:13:30,302][Test worker][ERROR][TEPortServlet] No manual cancellation allowed of game instance(gameId=GAME-111,number=20090408).
com.mpos.lottery.te.config.exception.ApplicationException: No manual cancellation allowed of game instance(gameId=GAME-111,number=20090408).
	at com.mpos.lottery.te.gamespec.sale.service.AbstractTicketService.allowManualCancellation(AbstractTicketService.java:366)
	at com.mpos.lottery.te.gamespec.sale.service.AbstractTicketService.cancelByTicket(AbstractTicketService.java:217)
	at com.mpos.lottery.te.gamespec.sale.service.AbstractTicketService.cancelOrReverse(AbstractTicketService.java:283)
	at com.mpos.lottery.te.trans.service.impl.TransactionServiceImpl.reverseOrCancel(TransactionServiceImpl.java:203)
	at com.mpos.lottery.te.trans.service.impl.TransactionServiceImpl.reverseOrCancel(TransactionServiceImpl.java:227)
	at sun.reflect.GeneratedMethodAccessor288.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:190)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:157)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:98)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:262)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:95)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:92)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:207)
	at com.sun.proxy.$Proxy55.reverseOrCancel(Unknown Source)
	at com.mpos.lottery.te.gameimpl.lotto.LottoController.cancelByTicket(LottoController.java:43)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at com.mpos.lottery.common.router.RoutineRegistry.route(RoutineRegistry.java:57)
	at com.mpos.lottery.te.port.service.CommonFacadeService.routeRequest(CommonFacadeService.java:237)
	at com.mpos.lottery.te.port.service.CommonFacadeService.facade(CommonFacadeService.java:96)
	at sun.reflect.GeneratedMethodAccessor83.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:190)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:157)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:98)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:262)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:95)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:92)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:207)
	at com.sun.proxy.$Proxy85.facade(Unknown Source)
	at com.mpos.lottery.te.port.TEPortServlet.doPost(TEPortServlet.java:121)
	at com.mpos.lottery.te.test.integration.BaseServletIntegrationTest.doPost(BaseServletIntegrationTest.java:80)
	at com.mpos.lottery.te.gameimpl.lotto.sale.MannualCancelByTicketIntegrationTest.testCancel_GameInstance_Disable(MannualCancelByTicketIntegrationTest.java:160)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:74)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
	at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:83)
	at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:72)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:233)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:87)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:71)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:176)
	at org.junit.runners.Suite.runChild(Suite.java:127)
	at org.junit.runners.Suite.runChild(Suite.java:26)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecuter.runTestClass(JUnitTestClassExecuter.java:86)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecuter.execute(JUnitTestClassExecuter.java:49)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassProcessor.processTestClass(JUnitTestClassProcessor.java:69)
	at org.gradle.api.internal.tasks.testing.SuiteTestClassProcessor.processTestClass(SuiteTestClassProcessor.java:48)
	at sun.reflect.GeneratedMethodAccessor8.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:35)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)
	at org.gradle.messaging.dispatch.ContextClassLoaderDispatch.dispatch(ContextClassLoaderDispatch.java:32)
	at org.gradle.messaging.dispatch.ProxyDispatchAdapter$DispatchingInvocationHandler.invoke(ProxyDispatchAdapter.java:93)
	at com.sun.proxy.$Proxy2.processTestClass(Unknown Source)
	at org.gradle.api.internal.tasks.testing.worker.TestWorker.processTestClass(TestWorker.java:105)
	at sun.reflect.GeneratedMethodAccessor7.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:35)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)
	at org.gradle.messaging.remote.internal.hub.MessageHub$Handler.run(MessageHub.java:360)
	at org.gradle.internal.concurrent.DefaultExecutorFactory$StoppableExecutorImpl$1.run(DefaultExecutorFactory.java:64)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
	at java.lang.Thread.run(Thread.java:745)
[2015-05-29 17:13:30,303][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810284|Timestamp:20150529171330|Transaction-Type:4201|Transaction-Id:0115052900000000001579|Response-Code:261|):b5578c1a7b522728266d66743c802601
[2015-05-29 17:13:30,303][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=261,length=0): 
]]></system-out>
  <system-err><![CDATA[]]></system-err>
</testsuite>
