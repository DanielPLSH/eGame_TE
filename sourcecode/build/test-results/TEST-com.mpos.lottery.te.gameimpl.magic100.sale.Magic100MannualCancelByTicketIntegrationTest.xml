<?xml version="1.0" encoding="UTF-8"?>
<testsuite name="com.mpos.lottery.te.gameimpl.magic100.sale.Magic100MannualCancelByTicketIntegrationTest" tests="3" skipped="0" failures="0" errors="0" timestamp="2015-05-29T09:13:35" hostname="Ramon-PC" time="0.456">
  <properties/>
  <testcase name="testCancel_Game_Disable" classname="com.mpos.lottery.te.gameimpl.magic100.sale.Magic100MannualCancelByTicketIntegrationTest" time="0.136"/>
  <testcase name="testCancel_OK" classname="com.mpos.lottery.te.gameimpl.magic100.sale.Magic100MannualCancelByTicketIntegrationTest" time="0.197"/>
  <testcase name="testCancel_GameInstance_Disable" classname="com.mpos.lottery.te.gameimpl.magic100.sale.Magic100MannualCancelByTicketIntegrationTest" time="0.123"/>
  <system-out><![CDATA[[2015-05-29 17:13:35,837][Test worker][DEBUG][TEPortServlet] Startup job scheduer(org.quartz.impl.StdScheduler@4d1e5820) successfully.
[2015-05-29 17:13:35,837][Test worker][WARN ][TEPortServlet] can NOT find META file:F:\project\M.Lottery\TE\TRUNK_TE\sourcecode\build\classes\main\META-INF\MANIFEST.MF
[2015-05-29 17:13:35,837][Test worker][DEBUG][TEPortServlet] Register MBean(com.mpos.lottery.te.common.jmx.TransactionTimeout@167312ed) with name(com.mpos.lottery.te:type=TransactionTimeoutMBean) successfully.
[2015-05-29 17:13:35,838][Test worker][DEBUG][BaseTransactionalIntegrationTest] Retrieve a ApplicationContext(org.springframework.web.context.support.GenericWebApplicationContext@34f645a8: startup date [Fri May 29 17:12:38 CST 2015]; root of context hierarchy).
[2015-05-29 17:13:35,838][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:35,838][Test worker][INFO ][BaseTransactionalIntegrationTest] | Magic100MannualCancelByTicketIntegrationTest.testCancel_Game_Disable                                                   |
[2015-05-29 17:13:35,838][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:35,841][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/SellTicket_Req.xml) by key(18.transtype.200).
[2015-05-29 17:13:35,842][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.magic100.sale.Magic100Ticket, mappingFile=xml-mapping/game/magic100/SellTicket_Req.xml).
[2015-05-29 17:13:35,842][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890815841|Timestamp:20150529171335|Transaction-Type:200|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="1" totalAmount="300.0" PIN="!!!!"><GameDraw number="001" gameId="LK-1"/><Entry selectedNumber="PLAY" betOption="1" inputChannel="0" totalBets="3"/><User mobile="138000138000"/></Ticket>,hash=242843606), get digest:f00fcbae80e7921d2bcda8e2b556e51d
[2015-05-29 17:13:35,843][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=200).
[2015-05-29 17:13:35,843][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:35,843][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171335).
[2015-05-29 17:13:35,843][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:35,843][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890815841).
[2015-05-29 17:13:35,843][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:35,843][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:35,843][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=f00fcbae80e7921d2bcda8e2b556e51d).
[2015-05-29 17:13:35,843][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=18).
[2015-05-29 17:13:35,843][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:35,843][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:35,845][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6vvj1C28m6E+ybhcq2GHfnfSvzUuvi5gIW+x7OzQghYnuO2taDRjXWCxHHHe4Qt36fAfFB33rSVDACrbWnPg/DemXvJASO7iCLuAO4gyCEnDo0YmXYatjtvx/4vawF5fmKvcy6y3OGpne4KYTTRzaz+rF0MDrXB++dOTvd5Fn6AkBiVVDSSby3fO4ETpZWFpBI2KUCNpMdGMU5l6EM+5IolpRDkWHrNZPUabJ+SyUo2qmTSgiOa5rwtdKi3DsJ+KQz7CwuaOvv+AitkgcNKdy64=.
[2015-05-29 17:13:35,845][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890815841|Timestamp:20150529171335|Transaction-Type:200|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:35,845][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="1" totalAmount="300.0" PIN="!!!!"><GameDraw number="001" gameId="LK-1"/><Entry selectedNumber="PLAY" betOption="1" inputChannel="0" totalBets="3"/><User mobile="138000138000"/></Ticket>
[2015-05-29 17:13:35,845][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890815841|Timestamp:20150529171335|Transaction-Type:200|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="1" totalAmount="300.0" PIN="!!!!"><GameDraw number="001" gameId="LK-1"/><Entry selectedNumber="PLAY" betOption="1" inputChannel="0" totalBets="3"/><User mobile="138000138000"/></Ticket>,hash=242843606), get digest:f00fcbae80e7921d2bcda8e2b556e51d
[2015-05-29 17:13:35,845][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/SellTicket_Req.xml) by key(18.transtype.200).
[2015-05-29 17:13:35,845][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/magic100/SellTicket_Req.xml
[2015-05-29 17:13:35,845][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/SellTicket_Req.xml) by key(18.transtype.200).
[2015-05-29 17:13:35,857][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(18_200_1.5.0).
[2015-05-29 17:13:35,857][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(18_200_).
[2015-05-29 17:13:35,857][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(18_200_), found controller(com.mpos.lottery.te.gameimpl.magic100.Magic100Controller@7081c100) and method(public void com.mpos.lottery.te.gameimpl.magic100.Magic100Controller.sell(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:35,864][Test worker][INFO ][AbstractGameInstanceService] No channel game instance time definiton found, ignore it.
[2015-05-29 17:13:35,864][Test worker][DEBUG][UUIDServiceImpl] Assemble a new ticket serial number:01111745819300014155
[2015-05-29 17:13:35,875][Test worker][DEBUG][DefaultLuckyNumberService] Use lucky number from REQUEUED RANGE(id=2) instead of main cycle.
[2015-05-29 17:13:35,876][Test worker][DEBUG][DefaultTicketValidator] THe max allowed multi-draw of operation parameter is 10, merchant limit to 3, the smaller 3 will be used.
[2015-05-29 17:13:35,893][Test worker][DEBUG][DefaultBalanceService] Operator before transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:35,893][Test worker][DEBUG][DefaultBalanceService] Found balance strategy:com.mpos.lottery.te.merchant.service.balance.PayoutBalanceStrategy@57df81d2
[2015-05-29 17:13:35,893][Test worker][DEBUG][DefaultBalanceService] Operator after transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=2000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:35,905][Test worker][DEBUG][DefaultBalanceService] Operator before transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=2000, cashoutBalance=0, commisionBalance=200]
[2015-05-29 17:13:35,905][Test worker][DEBUG][DefaultBalanceService] Found balance strategy:com.mpos.lottery.te.merchant.service.balance.SaleBalanceStrategy@e1f8aba
[2015-05-29 17:13:35,905][Test worker][DEBUG][DefaultBalanceService] Operator after transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=199999700.0, payoutCreditLevel=2000, cashoutBalance=0, commisionBalance=200]
[2015-05-29 17:13:35,915][Test worker][DEBUG][CommonFacadeService] Prepare to publish message to exchange[TE.200] with routing key[TE.200.18]: transaction {
  id: "0115052900000000001819"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890815000
  trans_type: 200
  game_id: "LK-1"
  game_type: 18
  total_amount: "300.0"
}
multi_draw: 1
total_amount: "300.0"
serial_no: "y013eOifYgIYr8cogzQpk5kh7WmwgSno"
game_instance {
  id: "GII-111"
}
entries {
  selected_number: "6"
  bet_option: 1
  total_bets: 1
  entry_amount: "100"
  input_channel: "0"
}
entries {
  selected_number: "7"
  bet_option: 1
  total_bets: 1
  entry_amount: "100"
  input_channel: "0"
}
entries {
  selected_number: "8"
  bet_option: 1
  total_bets: 1
  entry_amount: "100"
  input_channel: "0"
}

[2015-05-29 17:13:35,915][Test worker][DEBUG][CommonFacadeService] Publish message successfully
[2015-05-29 17:13:35,915][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/SellTicket_Res.xml) by key(18.transtype.4200).
[2015-05-29 17:13:35,915][Test worker][DEBUG][ProtocolSerializer] Start to serialize model(class com.mpos.lottery.te.gameimpl.magic100.sale.Magic100Ticket),mappingFile=xml-mapping/game/magic100/SellTicket_Res.xml
[2015-05-29 17:13:35,915][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/SellTicket_Res.xml) by key(18.transtype.4200).
[2015-05-29 17:13:35,916][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.magic100.sale.Magic100Ticket, mappingFile=xml-mapping/game/magic100/SellTicket_Res.xml).
[2015-05-29 17:13:35,916][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890815841|Timestamp:20150529171335|Transaction-Type:4200|Transaction-Id:0115052900000000001819|Response-Code:200|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01111745819300014155" barcode="18cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt9Se2CWmp8xas1YeK2m7FOQQvNOtRZtVOg=" validationCode="522375" type="1" multipleDraws="1" lastDrawNo="001" totalBets="3" totalAmount="300.00" isWinning="1"><GameDraw number="001" gameId="LK-1"/><Entry selectedNumber="6" betOption="1" inputChannel="0" isWinning="0" prizeAmount="0" taxAmount="0" entryAmount="100"/><Entry selectedNumber="7" betOption="1" inputChannel="0" isWinning="0" prizeAmount="0" taxAmount="0" entryAmount="100"/><Entry selectedNumber="8" betOption="1" inputChannel="0" isWinning="1" prizeAmount="1000" taxAmount="0" entryAmount="100"/></Ticket>):e031bc8f089531fcaf955c72d597e962
[2015-05-29 17:13:35,916][Test worker][DEBUG][TEPortServlet] Write response to client(host1=localhost,sizeOfPack=928) succesfully.
[2015-05-29 17:13:35,917][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=928): <?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01111745819300014155" barcode="18cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt9Se2CWmp8xas1YeK2m7FOQQvNOtRZtVOg=" validationCode="522375" type="1" multipleDraws="1" lastDrawNo="001" totalBets="3" totalAmount="300.00" isWinning="1"><GameDraw number="001" gameId="LK-1"/><Entry selectedNumber="6" betOption="1" inputChannel="0" isWinning="0" prizeAmount="0" taxAmount="0" entryAmount="100"/><Entry selectedNumber="7" betOption="1" inputChannel="0" isWinning="0" prizeAmount="0" taxAmount="0" entryAmount="100"/><Entry selectedNumber="8" betOption="1" inputChannel="0" isWinning="1" prizeAmount="1000" taxAmount="0" entryAmount="100"/></Ticket>
[2015-05-29 17:13:35,917][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/SellTicket_Res.xml) by key(18.transtype.4200).
[2015-05-29 17:13:35,921][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/CancelTicket_Req.xml) by key(18.transtype.201).
[2015-05-29 17:13:35,921][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.magic100.sale.Magic100Ticket, mappingFile=xml-mapping/game/magic100/CancelTicket_Req.xml).
[2015-05-29 17:13:35,922][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890815921|Timestamp:20150529171335|Transaction-Type:201|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01111745819300014155" barcode="18cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt9Se2CWmp8xas1YeK2m7FOQQvNOtRZtVOg=" isMannul="1"/>,hash=-381842526), get digest:25098ad0793734c431df0d9c715b6c1d
[2015-05-29 17:13:35,922][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=201).
[2015-05-29 17:13:35,922][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:35,922][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171335).
[2015-05-29 17:13:35,922][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:35,922][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890815921).
[2015-05-29 17:13:35,922][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:35,922][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:35,922][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=25098ad0793734c431df0d9c715b6c1d).
[2015-05-29 17:13:35,922][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=18).
[2015-05-29 17:13:35,922][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:35,922][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:35,924][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6ttFDFcpmi1MamgAomcAmY77ZmH0pucSJgbfWsiX7V3q/cLjB41AHbbDyYdjpfm9yXSDWVJY5BHDt+bs1P+dj9z1TIdIowssLdMgCsSkRhdHFwgzOIgd4JoB2bn3c/Pe/7zFhYqEh8FTzEoihAIvKbJxw/X4uUGXzfenFeA+Pqz4+cZVW1PbXsac7AZnK8rQYw==.
[2015-05-29 17:13:35,924][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890815921|Timestamp:20150529171335|Transaction-Type:201|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:35,924][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01111745819300014155" barcode="18cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt9Se2CWmp8xas1YeK2m7FOQQvNOtRZtVOg=" isMannul="1"/>
[2015-05-29 17:13:35,924][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890815921|Timestamp:20150529171335|Transaction-Type:201|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01111745819300014155" barcode="18cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt9Se2CWmp8xas1YeK2m7FOQQvNOtRZtVOg=" isMannul="1"/>,hash=-381842526), get digest:25098ad0793734c431df0d9c715b6c1d
[2015-05-29 17:13:35,924][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/CancelTicket_Req.xml) by key(18.transtype.201).
[2015-05-29 17:13:35,924][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/magic100/CancelTicket_Req.xml
[2015-05-29 17:13:35,924][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/CancelTicket_Req.xml) by key(18.transtype.201).
[2015-05-29 17:13:35,939][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(18_201_1.5.0).
[2015-05-29 17:13:35,939][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(18_201_).
[2015-05-29 17:13:35,939][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(18_201_), found controller(com.mpos.lottery.te.gameimpl.magic100.Magic100Controller@7081c100) and method(public void com.mpos.lottery.te.gameimpl.magic100.Magic100Controller.cancelByTicket(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:35,944][Test worker][DEBUG][ReversalOrCancelStrategyFactory] Found ReversalStrategy(class com.mpos.lottery.te.gameimpl.magic100.sale.service.Magic100SaleService) to cancel transaction(gameType=18,terminalId=111,transType=200,protocolVersion=1.5.0).
[2015-05-29 17:13:35,951][Test worker][ERROR][TEPortServlet] No manual cancellation allowed of game (gameId=LK-1).
com.mpos.lottery.te.config.exception.ApplicationException: No manual cancellation allowed of game (gameId=LK-1).
	at com.mpos.lottery.te.gamespec.sale.service.AbstractTicketService.allowManualCancellation(AbstractTicketService.java:376)
	at com.mpos.lottery.te.gamespec.sale.service.AbstractTicketService.cancelByTicket(AbstractTicketService.java:217)
	at com.mpos.lottery.te.gamespec.sale.service.AbstractTicketService.cancelOrReverse(AbstractTicketService.java:283)
	at com.mpos.lottery.te.trans.service.impl.TransactionServiceImpl.reverseOrCancel(TransactionServiceImpl.java:203)
	at com.mpos.lottery.te.trans.service.impl.TransactionServiceImpl.reverseOrCancel(TransactionServiceImpl.java:227)
	at sun.reflect.GeneratedMethodAccessor288.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:190)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:157)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:98)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:262)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:95)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:92)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:207)
	at com.sun.proxy.$Proxy55.reverseOrCancel(Unknown Source)
	at com.mpos.lottery.te.gameimpl.magic100.Magic100Controller.cancelByTicket(Magic100Controller.java:49)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at com.mpos.lottery.common.router.RoutineRegistry.route(RoutineRegistry.java:57)
	at com.mpos.lottery.te.port.service.CommonFacadeService.routeRequest(CommonFacadeService.java:237)
	at com.mpos.lottery.te.port.service.CommonFacadeService.facade(CommonFacadeService.java:96)
	at sun.reflect.GeneratedMethodAccessor83.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:190)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:157)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:98)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:262)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:95)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:92)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:207)
	at com.sun.proxy.$Proxy85.facade(Unknown Source)
	at com.mpos.lottery.te.port.TEPortServlet.doPost(TEPortServlet.java:121)
	at com.mpos.lottery.te.test.integration.BaseServletIntegrationTest.doPost(BaseServletIntegrationTest.java:80)
	at com.mpos.lottery.te.gameimpl.magic100.sale.Magic100MannualCancelByTicketIntegrationTest.testCancel_Game_Disable(Magic100MannualCancelByTicketIntegrationTest.java:95)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:74)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
	at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:83)
	at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:72)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:233)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:87)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:71)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:176)
	at org.junit.runners.Suite.runChild(Suite.java:127)
	at org.junit.runners.Suite.runChild(Suite.java:26)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecuter.runTestClass(JUnitTestClassExecuter.java:86)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecuter.execute(JUnitTestClassExecuter.java:49)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassProcessor.processTestClass(JUnitTestClassProcessor.java:69)
	at org.gradle.api.internal.tasks.testing.SuiteTestClassProcessor.processTestClass(SuiteTestClassProcessor.java:48)
	at sun.reflect.GeneratedMethodAccessor8.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:35)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)
	at org.gradle.messaging.dispatch.ContextClassLoaderDispatch.dispatch(ContextClassLoaderDispatch.java:32)
	at org.gradle.messaging.dispatch.ProxyDispatchAdapter$DispatchingInvocationHandler.invoke(ProxyDispatchAdapter.java:93)
	at com.sun.proxy.$Proxy2.processTestClass(Unknown Source)
	at org.gradle.api.internal.tasks.testing.worker.TestWorker.processTestClass(TestWorker.java:105)
	at sun.reflect.GeneratedMethodAccessor7.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:35)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)
	at org.gradle.messaging.remote.internal.hub.MessageHub$Handler.run(MessageHub.java:360)
	at org.gradle.internal.concurrent.DefaultExecutorFactory$StoppableExecutorImpl$1.run(DefaultExecutorFactory.java:64)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
	at java.lang.Thread.run(Thread.java:745)
[2015-05-29 17:13:35,953][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890815921|Timestamp:20150529171335|Transaction-Type:4201|Transaction-Id:0115052900000000001825|Response-Code:261|):74e5630609bdb4281ea6e61558d36624
[2015-05-29 17:13:35,953][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=261,length=0): 
[2015-05-29 17:13:35,962][Test worker][DEBUG][TEPortServlet] Startup job scheduer(org.quartz.impl.StdScheduler@4d1e5820) successfully.
[2015-05-29 17:13:35,962][Test worker][WARN ][TEPortServlet] can NOT find META file:F:\project\M.Lottery\TE\TRUNK_TE\sourcecode\build\classes\main\META-INF\MANIFEST.MF
[2015-05-29 17:13:35,962][Test worker][DEBUG][TEPortServlet] Register MBean(com.mpos.lottery.te.common.jmx.TransactionTimeout@7500c8f4) with name(com.mpos.lottery.te:type=TransactionTimeoutMBean) successfully.
[2015-05-29 17:13:35,963][Test worker][DEBUG][BaseTransactionalIntegrationTest] Retrieve a ApplicationContext(org.springframework.web.context.support.GenericWebApplicationContext@34f645a8: startup date [Fri May 29 17:12:38 CST 2015]; root of context hierarchy).
[2015-05-29 17:13:35,963][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:35,963][Test worker][INFO ][BaseTransactionalIntegrationTest] | Magic100MannualCancelByTicketIntegrationTest.testCancel_OK                                                             |
[2015-05-29 17:13:35,963][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:35,963][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/SellTicket_Req.xml) by key(18.transtype.200).
[2015-05-29 17:13:35,964][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.magic100.sale.Magic100Ticket, mappingFile=xml-mapping/game/magic100/SellTicket_Req.xml).
[2015-05-29 17:13:35,964][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890815963|Timestamp:20150529171335|Transaction-Type:200|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="1" totalAmount="300.0" PIN="!!!!"><GameDraw number="001" gameId="LK-1"/><Entry selectedNumber="PLAY" betOption="1" inputChannel="0" totalBets="3"/><User mobile="138000138000"/></Ticket>,hash=462060661), get digest:c75346d92f4e6ebbaff58fb76a3d3c04
[2015-05-29 17:13:35,964][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=200).
[2015-05-29 17:13:35,964][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:35,964][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171335).
[2015-05-29 17:13:35,964][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:35,964][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890815963).
[2015-05-29 17:13:35,964][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:35,964][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:35,964][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=c75346d92f4e6ebbaff58fb76a3d3c04).
[2015-05-29 17:13:35,965][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=18).
[2015-05-29 17:13:35,965][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:35,965][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:35,966][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6vvj1C28m6E+ybhcq2GHfnfSvzUuvi5gIW+x7OzQghYnuO2taDRjXWCxHHHe4Qt36fAfFB33rSVDACrbWnPg/DemXvJASO7iCLuAO4gyCEnDo0YmXYatjtvx/4vawF5fmKvcy6y3OGpne4KYTTRzaz+rF0MDrXB++dOTvd5Fn6AkBiVVDSSby3fO4ETpZWFpBI2KUCNpMdGMU5l6EM+5IolpRDkWHrNZPUabJ+SyUo2qmTSgiOa5rwtdKi3DsJ+KQz7CwuaOvv+AitkgcNKdy64=.
[2015-05-29 17:13:35,966][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890815963|Timestamp:20150529171335|Transaction-Type:200|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:35,966][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="1" totalAmount="300.0" PIN="!!!!"><GameDraw number="001" gameId="LK-1"/><Entry selectedNumber="PLAY" betOption="1" inputChannel="0" totalBets="3"/><User mobile="138000138000"/></Ticket>
[2015-05-29 17:13:35,967][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890815963|Timestamp:20150529171335|Transaction-Type:200|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="1" totalAmount="300.0" PIN="!!!!"><GameDraw number="001" gameId="LK-1"/><Entry selectedNumber="PLAY" betOption="1" inputChannel="0" totalBets="3"/><User mobile="138000138000"/></Ticket>,hash=462060661), get digest:c75346d92f4e6ebbaff58fb76a3d3c04
[2015-05-29 17:13:35,967][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/SellTicket_Req.xml) by key(18.transtype.200).
[2015-05-29 17:13:35,967][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/magic100/SellTicket_Req.xml
[2015-05-29 17:13:35,967][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/SellTicket_Req.xml) by key(18.transtype.200).
[2015-05-29 17:13:35,980][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(18_200_1.5.0).
[2015-05-29 17:13:35,980][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(18_200_).
[2015-05-29 17:13:35,980][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(18_200_), found controller(com.mpos.lottery.te.gameimpl.magic100.Magic100Controller@7081c100) and method(public void com.mpos.lottery.te.gameimpl.magic100.Magic100Controller.sell(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:35,988][Test worker][INFO ][AbstractGameInstanceService] No channel game instance time definiton found, ignore it.
[2015-05-29 17:13:35,988][Test worker][DEBUG][UUIDServiceImpl] Assemble a new ticket serial number:01111745819300014203
[2015-05-29 17:13:36,000][Test worker][DEBUG][DefaultLuckyNumberService] Use lucky number from REQUEUED RANGE(id=2) instead of main cycle.
[2015-05-29 17:13:36,000][Test worker][DEBUG][DefaultTicketValidator] THe max allowed multi-draw of operation parameter is 10, merchant limit to 3, the smaller 3 will be used.
[2015-05-29 17:13:36,015][Test worker][DEBUG][DefaultBalanceService] Operator before transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:36,015][Test worker][DEBUG][DefaultBalanceService] Found balance strategy:com.mpos.lottery.te.merchant.service.balance.PayoutBalanceStrategy@57df81d2
[2015-05-29 17:13:36,015][Test worker][DEBUG][DefaultBalanceService] Operator after transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=2000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:36,025][Test worker][DEBUG][DefaultBalanceService] Operator before transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=2000, cashoutBalance=0, commisionBalance=200]
[2015-05-29 17:13:36,025][Test worker][DEBUG][DefaultBalanceService] Found balance strategy:com.mpos.lottery.te.merchant.service.balance.SaleBalanceStrategy@e1f8aba
[2015-05-29 17:13:36,025][Test worker][DEBUG][DefaultBalanceService] Operator after transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=199999700.0, payoutCreditLevel=2000, cashoutBalance=0, commisionBalance=200]
[2015-05-29 17:13:36,035][Test worker][DEBUG][CommonFacadeService] Prepare to publish message to exchange[TE.200] with routing key[TE.200.18]: transaction {
  id: "0115052900000000001826"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890815000
  trans_type: 200
  game_id: "LK-1"
  game_type: 18
  total_amount: "300.0"
}
multi_draw: 1
total_amount: "300.0"
serial_no: "y013eOifYgIYr8cogzQpk6uYJYZ2zUt1"
game_instance {
  id: "GII-111"
}
entries {
  selected_number: "6"
  bet_option: 1
  total_bets: 1
  entry_amount: "100"
  input_channel: "0"
}
entries {
  selected_number: "7"
  bet_option: 1
  total_bets: 1
  entry_amount: "100"
  input_channel: "0"
}
entries {
  selected_number: "8"
  bet_option: 1
  total_bets: 1
  entry_amount: "100"
  input_channel: "0"
}

[2015-05-29 17:13:36,035][Test worker][DEBUG][CommonFacadeService] Publish message successfully
[2015-05-29 17:13:36,035][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/SellTicket_Res.xml) by key(18.transtype.4200).
[2015-05-29 17:13:36,035][Test worker][DEBUG][ProtocolSerializer] Start to serialize model(class com.mpos.lottery.te.gameimpl.magic100.sale.Magic100Ticket),mappingFile=xml-mapping/game/magic100/SellTicket_Res.xml
[2015-05-29 17:13:36,035][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/SellTicket_Res.xml) by key(18.transtype.4200).
[2015-05-29 17:13:36,036][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.magic100.sale.Magic100Ticket, mappingFile=xml-mapping/game/magic100/SellTicket_Res.xml).
[2015-05-29 17:13:36,036][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890815963|Timestamp:20150529171335|Transaction-Type:4200|Transaction-Id:0115052900000000001826|Response-Code:200|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01111745819300014203" barcode="18cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt9Se2CWmp8xas1YeK2m7FOQ4p+LmdRkmkM=" validationCode="624694" type="1" multipleDraws="1" lastDrawNo="001" totalBets="3" totalAmount="300.00" isWinning="1"><GameDraw number="001" gameId="LK-1"/><Entry selectedNumber="6" betOption="1" inputChannel="0" isWinning="0" prizeAmount="0" taxAmount="0" entryAmount="100"/><Entry selectedNumber="7" betOption="1" inputChannel="0" isWinning="0" prizeAmount="0" taxAmount="0" entryAmount="100"/><Entry selectedNumber="8" betOption="1" inputChannel="0" isWinning="1" prizeAmount="1000" taxAmount="0" entryAmount="100"/></Ticket>):1192cf4c037f38b58293d190537e6c86
[2015-05-29 17:13:36,037][Test worker][DEBUG][TEPortServlet] Write response to client(host1=localhost,sizeOfPack=928) succesfully.
[2015-05-29 17:13:36,037][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=928): <?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01111745819300014203" barcode="18cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt9Se2CWmp8xas1YeK2m7FOQ4p+LmdRkmkM=" validationCode="624694" type="1" multipleDraws="1" lastDrawNo="001" totalBets="3" totalAmount="300.00" isWinning="1"><GameDraw number="001" gameId="LK-1"/><Entry selectedNumber="6" betOption="1" inputChannel="0" isWinning="0" prizeAmount="0" taxAmount="0" entryAmount="100"/><Entry selectedNumber="7" betOption="1" inputChannel="0" isWinning="0" prizeAmount="0" taxAmount="0" entryAmount="100"/><Entry selectedNumber="8" betOption="1" inputChannel="0" isWinning="1" prizeAmount="1000" taxAmount="0" entryAmount="100"/></Ticket>
[2015-05-29 17:13:36,037][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/SellTicket_Res.xml) by key(18.transtype.4200).
[2015-05-29 17:13:36,041][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/CancelTicket_Req.xml) by key(18.transtype.201).
[2015-05-29 17:13:36,042][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.magic100.sale.Magic100Ticket, mappingFile=xml-mapping/game/magic100/CancelTicket_Req.xml).
[2015-05-29 17:13:36,042][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890816041|Timestamp:20150529171336|Transaction-Type:201|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01111745819300014203" barcode="18cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt9Se2CWmp8xas1YeK2m7FOQ4p+LmdRkmkM=" isMannul="1"/>,hash=1385214239), get digest:972dc4e22679d79df882233ecddc28f1
[2015-05-29 17:13:36,042][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=201).
[2015-05-29 17:13:36,042][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:36,042][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171336).
[2015-05-29 17:13:36,042][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:36,042][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890816041).
[2015-05-29 17:13:36,042][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:36,042][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:36,042][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=972dc4e22679d79df882233ecddc28f1).
[2015-05-29 17:13:36,042][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=18).
[2015-05-29 17:13:36,043][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:36,043][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:36,044][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6ttFDFcpmi1MamgAomcAmY77ZmH0pucSJgbfWsiX7V3qkwvL794/rh6yUAzujZvd4JcIcw0Y3WZIrx9ofoVk/nVryoRBonp5lG0d2AoLttBMtpyUB09Xi+Q7s89D2YJDXty0+o8aZGJLTPTqeH0n5pkSx6YOQouS40pg8bPbm8CwweZApjz7HlOGPySDfsWe0w==.
[2015-05-29 17:13:36,044][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890816041|Timestamp:20150529171336|Transaction-Type:201|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:36,045][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01111745819300014203" barcode="18cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt9Se2CWmp8xas1YeK2m7FOQ4p+LmdRkmkM=" isMannul="1"/>
[2015-05-29 17:13:36,045][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890816041|Timestamp:20150529171336|Transaction-Type:201|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01111745819300014203" barcode="18cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt9Se2CWmp8xas1YeK2m7FOQ4p+LmdRkmkM=" isMannul="1"/>,hash=1385214239), get digest:972dc4e22679d79df882233ecddc28f1
[2015-05-29 17:13:36,045][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/CancelTicket_Req.xml) by key(18.transtype.201).
[2015-05-29 17:13:36,045][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/magic100/CancelTicket_Req.xml
[2015-05-29 17:13:36,045][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/CancelTicket_Req.xml) by key(18.transtype.201).
[2015-05-29 17:13:36,059][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(18_201_1.5.0).
[2015-05-29 17:13:36,059][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(18_201_).
[2015-05-29 17:13:36,059][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(18_201_), found controller(com.mpos.lottery.te.gameimpl.magic100.Magic100Controller@7081c100) and method(public void com.mpos.lottery.te.gameimpl.magic100.Magic100Controller.cancelByTicket(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:36,065][Test worker][DEBUG][ReversalOrCancelStrategyFactory] Found ReversalStrategy(class com.mpos.lottery.te.gameimpl.magic100.sale.service.Magic100SaleService) to cancel transaction(gameType=18,terminalId=111,transType=200,protocolVersion=1.5.0).
[2015-05-29 17:13:36,090][Test worker][DEBUG][DefaultBalanceService] Operator before transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=199999700, payoutCreditLevel=2000, cashoutBalance=0, commisionBalance=230]
[2015-05-29 17:13:36,090][Test worker][DEBUG][DefaultBalanceService] Found balance strategy:com.mpos.lottery.te.merchant.service.balance.SaleBalanceStrategy@e1f8aba
[2015-05-29 17:13:36,090][Test worker][DEBUG][DefaultBalanceService] Operator after transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=2000, cashoutBalance=0, commisionBalance=230]
[2015-05-29 17:13:36,135][Test worker][DEBUG][DefaultBalanceService] Operator before transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=2000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:36,135][Test worker][DEBUG][DefaultBalanceService] Found balance strategy:com.mpos.lottery.te.merchant.service.balance.PayoutBalanceStrategy@57df81d2
[2015-05-29 17:13:36,135][Test worker][DEBUG][DefaultBalanceService] Operator after transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:36,140][Test worker][DEBUG][CommonFacadeService] Prepare to publish message to exchange[TE.200] with routing key[TE.CANCEL.200.18]: origTrans {
  id: "0115052900000000001826"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890815000
  trans_type: 200
  game_id: "LK-1"
  game_type: 18
  total_amount: "300"
}
cancelTrans {
  id: "0115052900000000001832"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890816000
  trans_type: 210
  game_id: "LK-1"
  game_type: 18
  total_amount: "300"
}

[2015-05-29 17:13:36,140][Test worker][DEBUG][CommonFacadeService] Publish message successfully
[2015-05-29 17:13:36,140][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890816041|Timestamp:20150529171336|Transaction-Type:4201|Transaction-Id:0115052900000000001832|Response-Code:200|):7b1b6cdeb48d6b9cf9d275bbe7c9232e
[2015-05-29 17:13:36,141][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=0): 
[2015-05-29 17:13:36,159][Test worker][DEBUG][TEPortServlet] Startup job scheduer(org.quartz.impl.StdScheduler@4d1e5820) successfully.
[2015-05-29 17:13:36,159][Test worker][WARN ][TEPortServlet] can NOT find META file:F:\project\M.Lottery\TE\TRUNK_TE\sourcecode\build\classes\main\META-INF\MANIFEST.MF
[2015-05-29 17:13:36,159][Test worker][DEBUG][TEPortServlet] Register MBean(com.mpos.lottery.te.common.jmx.TransactionTimeout@21fee50a) with name(com.mpos.lottery.te:type=TransactionTimeoutMBean) successfully.
[2015-05-29 17:13:36,160][Test worker][DEBUG][BaseTransactionalIntegrationTest] Retrieve a ApplicationContext(org.springframework.web.context.support.GenericWebApplicationContext@34f645a8: startup date [Fri May 29 17:12:38 CST 2015]; root of context hierarchy).
[2015-05-29 17:13:36,160][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:36,160][Test worker][INFO ][BaseTransactionalIntegrationTest] | Magic100MannualCancelByTicketIntegrationTest.testCancel_GameInstance_Disable                                           |
[2015-05-29 17:13:36,160][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:36,161][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/SellTicket_Req.xml) by key(18.transtype.200).
[2015-05-29 17:13:36,162][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.magic100.sale.Magic100Ticket, mappingFile=xml-mapping/game/magic100/SellTicket_Req.xml).
[2015-05-29 17:13:36,162][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890816161|Timestamp:20150529171336|Transaction-Type:200|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="1" totalAmount="300.0" PIN="!!!!"><GameDraw number="001" gameId="LK-1"/><Entry selectedNumber="PLAY" betOption="1" inputChannel="0" totalBets="3"/><User mobile="138000138000"/></Ticket>,hash=878656961), get digest:4448a8726700a9d1fdc3948120241ef9
[2015-05-29 17:13:36,163][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=200).
[2015-05-29 17:13:36,163][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:36,163][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171336).
[2015-05-29 17:13:36,163][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:36,163][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890816161).
[2015-05-29 17:13:36,163][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:36,163][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:36,163][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=4448a8726700a9d1fdc3948120241ef9).
[2015-05-29 17:13:36,163][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=18).
[2015-05-29 17:13:36,163][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:36,163][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:36,164][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6vvj1C28m6E+ybhcq2GHfnfSvzUuvi5gIW+x7OzQghYnuO2taDRjXWCxHHHe4Qt36fAfFB33rSVDACrbWnPg/DemXvJASO7iCLuAO4gyCEnDo0YmXYatjtvx/4vawF5fmKvcy6y3OGpne4KYTTRzaz+rF0MDrXB++dOTvd5Fn6AkBiVVDSSby3fO4ETpZWFpBI2KUCNpMdGMU5l6EM+5IolpRDkWHrNZPUabJ+SyUo2qmTSgiOa5rwtdKi3DsJ+KQz7CwuaOvv+AitkgcNKdy64=.
[2015-05-29 17:13:36,164][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890816161|Timestamp:20150529171336|Transaction-Type:200|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:36,165][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="1" totalAmount="300.0" PIN="!!!!"><GameDraw number="001" gameId="LK-1"/><Entry selectedNumber="PLAY" betOption="1" inputChannel="0" totalBets="3"/><User mobile="138000138000"/></Ticket>
[2015-05-29 17:13:36,165][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890816161|Timestamp:20150529171336|Transaction-Type:200|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="1" totalAmount="300.0" PIN="!!!!"><GameDraw number="001" gameId="LK-1"/><Entry selectedNumber="PLAY" betOption="1" inputChannel="0" totalBets="3"/><User mobile="138000138000"/></Ticket>,hash=878656961), get digest:4448a8726700a9d1fdc3948120241ef9
[2015-05-29 17:13:36,165][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/SellTicket_Req.xml) by key(18.transtype.200).
[2015-05-29 17:13:36,165][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/magic100/SellTicket_Req.xml
[2015-05-29 17:13:36,165][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/SellTicket_Req.xml) by key(18.transtype.200).
[2015-05-29 17:13:36,177][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(18_200_1.5.0).
[2015-05-29 17:13:36,177][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(18_200_).
[2015-05-29 17:13:36,177][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(18_200_), found controller(com.mpos.lottery.te.gameimpl.magic100.Magic100Controller@7081c100) and method(public void com.mpos.lottery.te.gameimpl.magic100.Magic100Controller.sell(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:36,185][Test worker][INFO ][AbstractGameInstanceService] No channel game instance time definiton found, ignore it.
[2015-05-29 17:13:36,185][Test worker][DEBUG][UUIDServiceImpl] Assemble a new ticket serial number:01111745819300014347
[2015-05-29 17:13:36,196][Test worker][DEBUG][DefaultLuckyNumberService] Use lucky number from REQUEUED RANGE(id=2) instead of main cycle.
[2015-05-29 17:13:36,197][Test worker][DEBUG][DefaultTicketValidator] THe max allowed multi-draw of operation parameter is 10, merchant limit to 3, the smaller 3 will be used.
[2015-05-29 17:13:36,212][Test worker][DEBUG][DefaultBalanceService] Operator before transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:36,212][Test worker][DEBUG][DefaultBalanceService] Found balance strategy:com.mpos.lottery.te.merchant.service.balance.PayoutBalanceStrategy@57df81d2
[2015-05-29 17:13:36,212][Test worker][DEBUG][DefaultBalanceService] Operator after transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=2000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:36,223][Test worker][DEBUG][DefaultBalanceService] Operator before transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=2000, cashoutBalance=0, commisionBalance=200]
[2015-05-29 17:13:36,223][Test worker][DEBUG][DefaultBalanceService] Found balance strategy:com.mpos.lottery.te.merchant.service.balance.SaleBalanceStrategy@e1f8aba
[2015-05-29 17:13:36,223][Test worker][DEBUG][DefaultBalanceService] Operator after transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=199999700.0, payoutCreditLevel=2000, cashoutBalance=0, commisionBalance=200]
[2015-05-29 17:13:36,233][Test worker][DEBUG][CommonFacadeService] Prepare to publish message to exchange[TE.200] with routing key[TE.200.18]: transaction {
  id: "0115052900000000001837"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890816000
  trans_type: 200
  game_id: "LK-1"
  game_type: 18
  total_amount: "300.0"
}
multi_draw: 1
total_amount: "300.0"
serial_no: "y013eOifYgIYr8cogzQpk19xTDNceR1p"
game_instance {
  id: "GII-111"
}
entries {
  selected_number: "6"
  bet_option: 1
  total_bets: 1
  entry_amount: "100"
  input_channel: "0"
}
entries {
  selected_number: "7"
  bet_option: 1
  total_bets: 1
  entry_amount: "100"
  input_channel: "0"
}
entries {
  selected_number: "8"
  bet_option: 1
  total_bets: 1
  entry_amount: "100"
  input_channel: "0"
}

[2015-05-29 17:13:36,233][Test worker][DEBUG][CommonFacadeService] Publish message successfully
[2015-05-29 17:13:36,234][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/SellTicket_Res.xml) by key(18.transtype.4200).
[2015-05-29 17:13:36,234][Test worker][DEBUG][ProtocolSerializer] Start to serialize model(class com.mpos.lottery.te.gameimpl.magic100.sale.Magic100Ticket),mappingFile=xml-mapping/game/magic100/SellTicket_Res.xml
[2015-05-29 17:13:36,234][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/SellTicket_Res.xml) by key(18.transtype.4200).
[2015-05-29 17:13:36,234][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.magic100.sale.Magic100Ticket, mappingFile=xml-mapping/game/magic100/SellTicket_Res.xml).
[2015-05-29 17:13:36,234][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890816161|Timestamp:20150529171336|Transaction-Type:4200|Transaction-Id:0115052900000000001837|Response-Code:200|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01111745819300014347" barcode="18cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt9Se2CWmp8xas1YeK2m7FOQiDA+9qobCqk=" validationCode="734523" type="1" multipleDraws="1" lastDrawNo="001" totalBets="3" totalAmount="300.00" isWinning="1"><GameDraw number="001" gameId="LK-1"/><Entry selectedNumber="6" betOption="1" inputChannel="0" isWinning="0" prizeAmount="0" taxAmount="0" entryAmount="100"/><Entry selectedNumber="7" betOption="1" inputChannel="0" isWinning="0" prizeAmount="0" taxAmount="0" entryAmount="100"/><Entry selectedNumber="8" betOption="1" inputChannel="0" isWinning="1" prizeAmount="1000" taxAmount="0" entryAmount="100"/></Ticket>):63d807b0f429c862ae54a9cf6d3de93b
[2015-05-29 17:13:36,235][Test worker][DEBUG][TEPortServlet] Write response to client(host1=localhost,sizeOfPack=928) succesfully.
[2015-05-29 17:13:36,235][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=928): <?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01111745819300014347" barcode="18cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt9Se2CWmp8xas1YeK2m7FOQiDA+9qobCqk=" validationCode="734523" type="1" multipleDraws="1" lastDrawNo="001" totalBets="3" totalAmount="300.00" isWinning="1"><GameDraw number="001" gameId="LK-1"/><Entry selectedNumber="6" betOption="1" inputChannel="0" isWinning="0" prizeAmount="0" taxAmount="0" entryAmount="100"/><Entry selectedNumber="7" betOption="1" inputChannel="0" isWinning="0" prizeAmount="0" taxAmount="0" entryAmount="100"/><Entry selectedNumber="8" betOption="1" inputChannel="0" isWinning="1" prizeAmount="1000" taxAmount="0" entryAmount="100"/></Ticket>
[2015-05-29 17:13:36,235][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/SellTicket_Res.xml) by key(18.transtype.4200).
[2015-05-29 17:13:36,240][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/CancelTicket_Req.xml) by key(18.transtype.201).
[2015-05-29 17:13:36,240][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.magic100.sale.Magic100Ticket, mappingFile=xml-mapping/game/magic100/CancelTicket_Req.xml).
[2015-05-29 17:13:36,240][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890816240|Timestamp:20150529171336|Transaction-Type:201|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01111745819300014347" barcode="18cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt9Se2CWmp8xas1YeK2m7FOQiDA+9qobCqk=" isMannul="1"/>,hash=1892364820), get digest:0d1a82e1a03748d9ff772b46cfd4bad2
[2015-05-29 17:13:36,241][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=201).
[2015-05-29 17:13:36,241][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:36,241][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171336).
[2015-05-29 17:13:36,241][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:36,241][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890816240).
[2015-05-29 17:13:36,241][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:36,241][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:36,241][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=0d1a82e1a03748d9ff772b46cfd4bad2).
[2015-05-29 17:13:36,241][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=18).
[2015-05-29 17:13:36,241][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:36,241][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:36,242][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6ttFDFcpmi1MamgAomcAmY77ZmH0pucSJgbfWsiX7V3qmReDgwZFnm8jJY+Kb8L7ZqOb0qJ6GYmGwSAum6JdNM1x/EgM9dKqY/qWzGoOijFwFH5KG/jXdH7rHlFTTYKtSK8vlL6PE6lSl5fiaUecXuhlUPgoKKdDxbMdHK9bXqI5ThSr3XzWth/HWal1i3SuXA==.
[2015-05-29 17:13:36,242][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890816240|Timestamp:20150529171336|Transaction-Type:201|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:36,243][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01111745819300014347" barcode="18cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt9Se2CWmp8xas1YeK2m7FOQiDA+9qobCqk=" isMannul="1"/>
[2015-05-29 17:13:36,243][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890816240|Timestamp:20150529171336|Transaction-Type:201|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01111745819300014347" barcode="18cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt9Se2CWmp8xas1YeK2m7FOQiDA+9qobCqk=" isMannul="1"/>,hash=1892364820), get digest:0d1a82e1a03748d9ff772b46cfd4bad2
[2015-05-29 17:13:36,243][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/CancelTicket_Req.xml) by key(18.transtype.201).
[2015-05-29 17:13:36,243][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/magic100/CancelTicket_Req.xml
[2015-05-29 17:13:36,243][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/magic100/CancelTicket_Req.xml) by key(18.transtype.201).
[2015-05-29 17:13:36,257][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(18_201_1.5.0).
[2015-05-29 17:13:36,257][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(18_201_).
[2015-05-29 17:13:36,257][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(18_201_), found controller(com.mpos.lottery.te.gameimpl.magic100.Magic100Controller@7081c100) and method(public void com.mpos.lottery.te.gameimpl.magic100.Magic100Controller.cancelByTicket(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:36,262][Test worker][DEBUG][ReversalOrCancelStrategyFactory] Found ReversalStrategy(class com.mpos.lottery.te.gameimpl.magic100.sale.service.Magic100SaleService) to cancel transaction(gameType=18,terminalId=111,transType=200,protocolVersion=1.5.0).
[2015-05-29 17:13:36,268][Test worker][ERROR][TEPortServlet] No manual cancellation allowed of game instance(gameId=LK-1,number=001).
com.mpos.lottery.te.config.exception.ApplicationException: No manual cancellation allowed of game instance(gameId=LK-1,number=001).
	at com.mpos.lottery.te.gamespec.sale.service.AbstractTicketService.allowManualCancellation(AbstractTicketService.java:366)
	at com.mpos.lottery.te.gamespec.sale.service.AbstractTicketService.cancelByTicket(AbstractTicketService.java:217)
	at com.mpos.lottery.te.gamespec.sale.service.AbstractTicketService.cancelOrReverse(AbstractTicketService.java:283)
	at com.mpos.lottery.te.trans.service.impl.TransactionServiceImpl.reverseOrCancel(TransactionServiceImpl.java:203)
	at com.mpos.lottery.te.trans.service.impl.TransactionServiceImpl.reverseOrCancel(TransactionServiceImpl.java:227)
	at sun.reflect.GeneratedMethodAccessor288.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:190)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:157)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:98)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:262)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:95)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:92)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:207)
	at com.sun.proxy.$Proxy55.reverseOrCancel(Unknown Source)
	at com.mpos.lottery.te.gameimpl.magic100.Magic100Controller.cancelByTicket(Magic100Controller.java:49)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at com.mpos.lottery.common.router.RoutineRegistry.route(RoutineRegistry.java:57)
	at com.mpos.lottery.te.port.service.CommonFacadeService.routeRequest(CommonFacadeService.java:237)
	at com.mpos.lottery.te.port.service.CommonFacadeService.facade(CommonFacadeService.java:96)
	at sun.reflect.GeneratedMethodAccessor83.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:190)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:157)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:98)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:262)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:95)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:92)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:207)
	at com.sun.proxy.$Proxy85.facade(Unknown Source)
	at com.mpos.lottery.te.port.TEPortServlet.doPost(TEPortServlet.java:121)
	at com.mpos.lottery.te.test.integration.BaseServletIntegrationTest.doPost(BaseServletIntegrationTest.java:80)
	at com.mpos.lottery.te.gameimpl.magic100.sale.Magic100MannualCancelByTicketIntegrationTest.testCancel_GameInstance_Disable(Magic100MannualCancelByTicketIntegrationTest.java:125)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:74)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
	at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:83)
	at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:72)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:233)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:87)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:71)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:176)
	at org.junit.runners.Suite.runChild(Suite.java:127)
	at org.junit.runners.Suite.runChild(Suite.java:26)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecuter.runTestClass(JUnitTestClassExecuter.java:86)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecuter.execute(JUnitTestClassExecuter.java:49)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassProcessor.processTestClass(JUnitTestClassProcessor.java:69)
	at org.gradle.api.internal.tasks.testing.SuiteTestClassProcessor.processTestClass(SuiteTestClassProcessor.java:48)
	at sun.reflect.GeneratedMethodAccessor8.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:35)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)
	at org.gradle.messaging.dispatch.ContextClassLoaderDispatch.dispatch(ContextClassLoaderDispatch.java:32)
	at org.gradle.messaging.dispatch.ProxyDispatchAdapter$DispatchingInvocationHandler.invoke(ProxyDispatchAdapter.java:93)
	at com.sun.proxy.$Proxy2.processTestClass(Unknown Source)
	at org.gradle.api.internal.tasks.testing.worker.TestWorker.processTestClass(TestWorker.java:105)
	at sun.reflect.GeneratedMethodAccessor7.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:35)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)
	at org.gradle.messaging.remote.internal.hub.MessageHub$Handler.run(MessageHub.java:360)
	at org.gradle.internal.concurrent.DefaultExecutorFactory$StoppableExecutorImpl$1.run(DefaultExecutorFactory.java:64)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
	at java.lang.Thread.run(Thread.java:745)
[2015-05-29 17:13:36,269][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890816240|Timestamp:20150529171336|Transaction-Type:4201|Transaction-Id:0115052900000000001843|Response-Code:261|):7204e323ba09aa8c91b370264bc3394f
[2015-05-29 17:13:36,269][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=261,length=0): 
]]></system-out>
  <system-err><![CDATA[]]></system-err>
</testsuite>
