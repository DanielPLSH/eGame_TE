<?xml version="1.0" encoding="UTF-8"?>
<testsuite name="com.mpos.lottery.te.gameimpl.lotto.sale.TicketCancellationIntegrationTest" tests="7" skipped="0" failures="0" errors="0" timestamp="2015-05-29T09:13:30" hostname="Ramon-PC" time="0.999">
  <properties/>
  <testcase name="testCancelByTrans_OK" classname="com.mpos.lottery.te.gameimpl.lotto.sale.TicketCancellationIntegrationTest" time="0.137"/>
  <testcase name="testCancelByTicket_Repeatedly" classname="com.mpos.lottery.te.gameimpl.lotto.sale.TicketCancellationIntegrationTest" time="0.146"/>
  <testcase name="testCancelByTrans_CancelDelined" classname="com.mpos.lottery.te.gameimpl.lotto.sale.TicketCancellationIntegrationTest" time="0.135"/>
  <testcase name="testCancelByTrans_Repeatedly" classname="com.mpos.lottery.te.gameimpl.lotto.sale.TicketCancellationIntegrationTest" time="0.148"/>
  <testcase name="testCancelByTicket_OK" classname="com.mpos.lottery.te.gameimpl.lotto.sale.TicketCancellationIntegrationTest" time="0.147"/>
  <testcase name="testCancelByTicket_RemovedOperator" classname="com.mpos.lottery.te.gameimpl.lotto.sale.TicketCancellationIntegrationTest" time="0.148"/>
  <testcase name="testCancelByTicket_CancelDelined" classname="com.mpos.lottery.te.gameimpl.lotto.sale.TicketCancellationIntegrationTest" time="0.134"/>
  <system-out><![CDATA[[2015-05-29 17:13:30,456][Test worker][DEBUG][TEPortServlet] Startup job scheduer(org.quartz.impl.StdScheduler@4d1e5820) successfully.
[2015-05-29 17:13:30,456][Test worker][WARN ][TEPortServlet] can NOT find META file:F:\project\M.Lottery\TE\TRUNK_TE\sourcecode\build\classes\main\META-INF\MANIFEST.MF
[2015-05-29 17:13:30,456][Test worker][DEBUG][TEPortServlet] Register MBean(com.mpos.lottery.te.common.jmx.TransactionTimeout@7875949d) with name(com.mpos.lottery.te:type=TransactionTimeoutMBean) successfully.
[2015-05-29 17:13:30,456][Test worker][DEBUG][BaseTransactionalIntegrationTest] Retrieve a ApplicationContext(org.springframework.web.context.support.GenericWebApplicationContext@34f645a8: startup date [Fri May 29 17:12:38 CST 2015]; root of context hierarchy).
[2015-05-29 17:13:30,457][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:30,457][Test worker][INFO ][BaseTransactionalIntegrationTest] | TicketCancellationIntegrationTest.testCancelByTrans_OK                                                                 |
[2015-05-29 17:13:30,457][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:30,460][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:30,461][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/SellTicket_Req.xml).
[2015-05-29 17:13:30,461][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810460|Timestamp:20150529171330|Transaction-Type:200|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>,hash=789964057), get digest:a4a70710486256b9e8335ad5f678f904
[2015-05-29 17:13:30,461][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=200).
[2015-05-29 17:13:30,461][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:30,461][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171330).
[2015-05-29 17:13:30,461][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:30,461][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890810460).
[2015-05-29 17:13:30,461][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:30,461][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:30,461][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=a4a70710486256b9e8335ad5f678f904).
[2015-05-29 17:13:30,461][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=1).
[2015-05-29 17:13:30,461][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:30,461][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:30,463][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6vvj1C28m6E+ybhcq2GHfncNCEmxnE1Ou0qcmJ+qutg9pDpTDScnIWI62pEFB0SGtKkhmSVtwRhObbaRtENvsKgd1vgEj9cakrUbLVxBSMJqciae7U9vnZ9gkPZ+TiqwdRl/00lYrPXIRF649XUAfZ/u7Ik8R7r7YZCfSM8Dq3Lk3E+I+8dy5FMq1JBSOx+CBYDZ3n4iWwIrRwN3i9ic9EHYxaBXmh5eMdb+eYfmG3rw7BmwCbT+5YlwzT8o+qK8+x+tCRF0yCaqlMPxlqr0c+eFde9h31TBTgqMtIWk2Ux1nb1TPJ2uDK+Ee2oZ5RgoEzb/nuc9f7RCFw4/R0o1FObopbRaJ9qpV2PI6XK6rtTl1lpL4o22ySC7lKR344K/b+MKthKWb3jb.
[2015-05-29 17:13:30,463][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810460|Timestamp:20150529171330|Transaction-Type:200|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:30,463][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>
[2015-05-29 17:13:30,464][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810460|Timestamp:20150529171330|Transaction-Type:200|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>,hash=789964057), get digest:a4a70710486256b9e8335ad5f678f904
[2015-05-29 17:13:30,464][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:30,464][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/lotto/SellTicket_Req.xml
[2015-05-29 17:13:30,464][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:30,474][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_200_1.5.0).
[2015-05-29 17:13:30,474][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_200_).
[2015-05-29 17:13:30,474][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(1_200_), found controller(com.mpos.lottery.te.gameimpl.lotto.LottoController@388c6589) and method(public void com.mpos.lottery.te.gameimpl.lotto.LottoController.sell(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:30,481][Test worker][DEBUG][BaseJpaDao] Query future game instance(class com.mpos.lottery.te.gameimpl.lotto.draw.domain.LottoGameInstance) by(number=20090408,gameId=GAME-111, multipleDraws=2, state=1||2):1
[2015-05-29 17:13:30,485][Test worker][DEBUG][AbstractGameInstanceService] Use channel game instance time definition(IGPE-1).
[2015-05-29 17:13:30,486][Test worker][DEBUG][UUIDServiceImpl] Assemble a new ticket serial number:01110745119300011232
[2015-05-29 17:13:30,491][Test worker][DEBUG][DefaultTicketValidator] THe max allowed multi-draw of operation parameter is 10, merchant limit to 3, the smaller 3 will be used.
[2015-05-29 17:13:30,491][Test worker][DEBUG][DefaultSelectedNumberValidatorFactory] Found ticket validator(com.mpos.lottery.te.gamespec.sale.support.validator.SingleSelectedNumberValidator@bffe122) for bet option:1
[2015-05-29 17:13:30,491][Test worker][DEBUG][DefaultSelectedNumberValidatorFactory] Found ticket validator(com.mpos.lottery.te.gamespec.sale.support.validator.MultipleSelectedNumberValidator@4c158555) for bet option:2
[2015-05-29 17:13:30,506][Test worker][DEBUG][DefaultBalanceService] Operator before transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:30,506][Test worker][DEBUG][DefaultBalanceService] Found balance strategy:com.mpos.lottery.te.merchant.service.balance.SaleBalanceStrategy@e1f8aba
[2015-05-29 17:13:30,506][Test worker][DEBUG][DefaultBalanceService] Operator after transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=199998400, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:30,516][Test worker][DEBUG][CommonFacadeService] Prepare to publish message to exchange[TE.200] with routing key[TE.200.1]: transaction {
  id: "0115052900000000001581"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890810000
  trans_type: 200
  game_id: "GAME-111"
  game_type: 1
  total_amount: "1600"
}
multi_draw: 2
total_amount: "1600"
serial_no: "aHhDkgTyIu7OH55EgjjAPxFLhTNY1Nbm"
game_instance {
  id: "GII-113"
}
entries {
  selected_number: "1,2,3,6,7,13"
  bet_option: 1
  total_bets: 1
  entry_amount: "100"
  input_channel: "1"
}
entries {
  selected_number: "3,11,14,16,22,25,36"
  bet_option: 2
  total_bets: 7
  entry_amount: "700"
  input_channel: "1"
}

[2015-05-29 17:13:30,516][Test worker][DEBUG][CommonFacadeService] Publish message successfully
[2015-05-29 17:13:30,516][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:30,516][Test worker][DEBUG][ProtocolSerializer] Start to serialize model(class com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket),mappingFile=xml-mapping/game/lotto/SellTicket_Res.xml
[2015-05-29 17:13:30,516][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:30,517][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/SellTicket_Res.xml).
[2015-05-29 17:13:30,517][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810460|Timestamp:20150529171330|Transaction-Type:4200|Transaction-Id:0115052900000000001581|Response-Code:200|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011232" type="1" lastDrawNo="20090416" barcode="01cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt8eRiXxElYKctyxR2V9Li0t2lYpuCp0bS0=" validationCode="384901" multipleDraws="2" totalBets="16" totalAmount="1600"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" entryAmount="100" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" entryAmount="700" boostAmount="0"/></Ticket>):0edbf403d5a35467defb34f9659a773a
[2015-05-29 17:13:30,518][Test worker][DEBUG][TEPortServlet] Write response to client(host1=localhost,sizeOfPack=736) succesfully.
[2015-05-29 17:13:30,518][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=736): <?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011232" type="1" lastDrawNo="20090416" barcode="01cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt8eRiXxElYKctyxR2V9Li0t2lYpuCp0bS0=" validationCode="384901" multipleDraws="2" totalBets="16" totalAmount="1600"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" entryAmount="100" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" entryAmount="700" boostAmount="0"/></Ticket>
[2015-05-29 17:13:30,518][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:30,522][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/TransactionEnquiry_Req.xml) by key(transtype.206).
[2015-05-29 17:13:30,523][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.trans.domain.Transaction, mappingFile=xml-mapping/TransactionEnquiry_Req.xml).
[2015-05-29 17:13:30,523][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810522|Timestamp:20150529171330|Transaction-Type:206|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Transaction terminalId="111" traceMessageId="1432890810460"/>,hash=1949090384), get digest:62dc7f4cac10a91547f4c09f19cb6823
[2015-05-29 17:13:30,523][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=206).
[2015-05-29 17:13:30,523][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:30,523][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171330).
[2015-05-29 17:13:30,523][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:30,523][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890810522).
[2015-05-29 17:13:30,523][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:30,524][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:30,524][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=62dc7f4cac10a91547f4c09f19cb6823).
[2015-05-29 17:13:30,524][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=-1).
[2015-05-29 17:13:30,524][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:30,524][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:30,525][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6jcIE4b0pl+ogrA4SMNVUFtCb0VnctvqFZ4g+Dv1D5Fz4ERoX4gVmzFJ1yZK27DdH8SpT51flBOK+Li7tqh71B0=.
[2015-05-29 17:13:30,525][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810522|Timestamp:20150529171330|Transaction-Type:206|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:30,526][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Transaction terminalId="111" traceMessageId="1432890810460"/>
[2015-05-29 17:13:30,526][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810522|Timestamp:20150529171330|Transaction-Type:206|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Transaction terminalId="111" traceMessageId="1432890810460"/>,hash=1949090384), get digest:62dc7f4cac10a91547f4c09f19cb6823
[2015-05-29 17:13:30,526][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/TransactionEnquiry_Req.xml) by key(transtype.206).
[2015-05-29 17:13:30,526][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/TransactionEnquiry_Req.xml
[2015-05-29 17:13:30,526][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/TransactionEnquiry_Req.xml) by key(transtype.206).
[2015-05-29 17:13:30,536][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(-1_206_1.5.0).
[2015-05-29 17:13:30,536][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(-1_206_).
[2015-05-29 17:13:30,536][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(-1_206_), found controller(com.mpos.lottery.te.trans.TransactionController@53ddecd8) and method(public void com.mpos.lottery.te.trans.TransactionController.cancelByTrans(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:30,541][Test worker][DEBUG][ReversalOrCancelStrategyFactory] Found ReversalStrategy(class com.mpos.lottery.te.gameimpl.lotto.sale.service.impl.LottoTicketServiceImpl) to cancel transaction(gameType=1,terminalId=111,transType=200,protocolVersion=1.5.0).
[2015-05-29 17:13:30,555][Test worker][DEBUG][DefaultBalanceService] Operator before transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=199998400, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:30,555][Test worker][DEBUG][DefaultBalanceService] Found balance strategy:com.mpos.lottery.te.merchant.service.balance.SaleBalanceStrategy@e1f8aba
[2015-05-29 17:13:30,555][Test worker][DEBUG][DefaultBalanceService] Operator after transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:30,566][Test worker][DEBUG][CommonFacadeService] Prepare to publish message to exchange[TE.200] with routing key[TE.CANCEL.200.1]: origTrans {
  id: "0115052900000000001581"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890810000
  trans_type: 200
  game_id: "GAME-111"
  game_type: 1
  total_amount: "1600"
}
cancelTrans {
  id: "0115052900000000001586"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890810000
  trans_type: 206
  game_id: "GAME-111"
  game_type: 1
  total_amount: "1600"
}

[2015-05-29 17:13:30,566][Test worker][DEBUG][CommonFacadeService] Publish message successfully
[2015-05-29 17:13:30,567][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810522|Timestamp:20150529171330|Transaction-Type:4206|Transaction-Id:0115052900000000001586|Response-Code:200|):e400d5f6a9dac31d709e8cb9e9faaca7
[2015-05-29 17:13:30,567][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=0): 
[2015-05-29 17:13:30,588][Test worker][DEBUG][TEPortServlet] Startup job scheduer(org.quartz.impl.StdScheduler@4d1e5820) successfully.
[2015-05-29 17:13:30,588][Test worker][WARN ][TEPortServlet] can NOT find META file:F:\project\M.Lottery\TE\TRUNK_TE\sourcecode\build\classes\main\META-INF\MANIFEST.MF
[2015-05-29 17:13:30,588][Test worker][DEBUG][TEPortServlet] Register MBean(com.mpos.lottery.te.common.jmx.TransactionTimeout@5908941) with name(com.mpos.lottery.te:type=TransactionTimeoutMBean) successfully.
[2015-05-29 17:13:30,589][Test worker][DEBUG][BaseTransactionalIntegrationTest] Retrieve a ApplicationContext(org.springframework.web.context.support.GenericWebApplicationContext@34f645a8: startup date [Fri May 29 17:12:38 CST 2015]; root of context hierarchy).
[2015-05-29 17:13:30,589][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:30,589][Test worker][INFO ][BaseTransactionalIntegrationTest] | TicketCancellationIntegrationTest.testCancelByTicket_Repeatedly                                                        |
[2015-05-29 17:13:30,589][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:30,592][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:30,593][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/SellTicket_Req.xml).
[2015-05-29 17:13:30,593][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810592|Timestamp:20150529171330|Transaction-Type:200|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>,hash=466944313), get digest:ed4b1eb30efeb0c9b7f9571ca3c86047
[2015-05-29 17:13:30,593][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=200).
[2015-05-29 17:13:30,593][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:30,593][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171330).
[2015-05-29 17:13:30,593][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:30,593][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890810592).
[2015-05-29 17:13:30,593][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:30,593][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:30,593][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=ed4b1eb30efeb0c9b7f9571ca3c86047).
[2015-05-29 17:13:30,593][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=1).
[2015-05-29 17:13:30,593][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:30,594][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:30,595][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6vvj1C28m6E+ybhcq2GHfncNCEmxnE1Ou0qcmJ+qutg9pDpTDScnIWI62pEFB0SGtKkhmSVtwRhObbaRtENvsKgd1vgEj9cakrUbLVxBSMJqciae7U9vnZ9gkPZ+TiqwdRl/00lYrPXIRF649XUAfZ/u7Ik8R7r7YZCfSM8Dq3Lk3E+I+8dy5FMq1JBSOx+CBYDZ3n4iWwIrRwN3i9ic9EHYxaBXmh5eMdb+eYfmG3rw7BmwCbT+5YlwzT8o+qK8+x+tCRF0yCaqlMPxlqr0c+eFde9h31TBTgqMtIWk2Ux1nb1TPJ2uDK+Ee2oZ5RgoEzb/nuc9f7RCFw4/R0o1FObopbRaJ9qpV2PI6XK6rtTl1lpL4o22ySC7lKR344K/b+MKthKWb3jb.
[2015-05-29 17:13:30,595][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810592|Timestamp:20150529171330|Transaction-Type:200|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:30,595][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>
[2015-05-29 17:13:30,596][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810592|Timestamp:20150529171330|Transaction-Type:200|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>,hash=466944313), get digest:ed4b1eb30efeb0c9b7f9571ca3c86047
[2015-05-29 17:13:30,596][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:30,596][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/lotto/SellTicket_Req.xml
[2015-05-29 17:13:30,596][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:30,606][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_200_1.5.0).
[2015-05-29 17:13:30,606][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_200_).
[2015-05-29 17:13:30,606][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(1_200_), found controller(com.mpos.lottery.te.gameimpl.lotto.LottoController@388c6589) and method(public void com.mpos.lottery.te.gameimpl.lotto.LottoController.sell(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:30,613][Test worker][DEBUG][BaseJpaDao] Query future game instance(class com.mpos.lottery.te.gameimpl.lotto.draw.domain.LottoGameInstance) by(number=20090408,gameId=GAME-111, multipleDraws=2, state=1||2):1
[2015-05-29 17:13:30,617][Test worker][DEBUG][AbstractGameInstanceService] Use channel game instance time definition(IGPE-1).
[2015-05-29 17:13:30,618][Test worker][DEBUG][UUIDServiceImpl] Assemble a new ticket serial number:01110745119300011333
[2015-05-29 17:13:30,623][Test worker][DEBUG][DefaultTicketValidator] THe max allowed multi-draw of operation parameter is 10, merchant limit to 3, the smaller 3 will be used.
[2015-05-29 17:13:30,623][Test worker][DEBUG][DefaultSelectedNumberValidatorFactory] Found ticket validator(com.mpos.lottery.te.gamespec.sale.support.validator.SingleSelectedNumberValidator@5916d195) for bet option:1
[2015-05-29 17:13:30,623][Test worker][DEBUG][DefaultSelectedNumberValidatorFactory] Found ticket validator(com.mpos.lottery.te.gamespec.sale.support.validator.MultipleSelectedNumberValidator@6919bae4) for bet option:2
[2015-05-29 17:13:30,636][Test worker][DEBUG][DefaultBalanceService] Operator before transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:30,636][Test worker][DEBUG][DefaultBalanceService] Found balance strategy:com.mpos.lottery.te.merchant.service.balance.SaleBalanceStrategy@e1f8aba
[2015-05-29 17:13:30,636][Test worker][DEBUG][DefaultBalanceService] Operator after transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=199998400, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:30,645][Test worker][DEBUG][CommonFacadeService] Prepare to publish message to exchange[TE.200] with routing key[TE.200.1]: transaction {
  id: "0115052900000000001587"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890810000
  trans_type: 200
  game_id: "GAME-111"
  game_type: 1
  total_amount: "1600"
}
multi_draw: 2
total_amount: "1600"
serial_no: "aHhDkgTyIu7OH55EgjjAP8xMVKHrdhof"
game_instance {
  id: "GII-113"
}
entries {
  selected_number: "1,2,3,6,7,13"
  bet_option: 1
  total_bets: 1
  entry_amount: "100"
  input_channel: "1"
}
entries {
  selected_number: "3,11,14,16,22,25,36"
  bet_option: 2
  total_bets: 7
  entry_amount: "700"
  input_channel: "1"
}

[2015-05-29 17:13:30,646][Test worker][DEBUG][CommonFacadeService] Publish message successfully
[2015-05-29 17:13:30,646][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:30,646][Test worker][DEBUG][ProtocolSerializer] Start to serialize model(class com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket),mappingFile=xml-mapping/game/lotto/SellTicket_Res.xml
[2015-05-29 17:13:30,646][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:30,647][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/SellTicket_Res.xml).
[2015-05-29 17:13:30,647][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810592|Timestamp:20150529171330|Transaction-Type:4200|Transaction-Id:0115052900000000001587|Response-Code:200|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011333" type="1" lastDrawNo="20090416" barcode="01cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt8eRiXxElYKctyxR2V9Li0tJ3k+VHPtmXM=" validationCode="151727" multipleDraws="2" totalBets="16" totalAmount="1600"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" entryAmount="100" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" entryAmount="700" boostAmount="0"/></Ticket>):70eae08c19ee2ba1461c072252a3a4fc
[2015-05-29 17:13:30,648][Test worker][DEBUG][TEPortServlet] Write response to client(host1=localhost,sizeOfPack=736) succesfully.
[2015-05-29 17:13:30,648][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=736): <?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011333" type="1" lastDrawNo="20090416" barcode="01cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt8eRiXxElYKctyxR2V9Li0tJ3k+VHPtmXM=" validationCode="151727" multipleDraws="2" totalBets="16" totalAmount="1600"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" entryAmount="100" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" entryAmount="700" boostAmount="0"/></Ticket>
[2015-05-29 17:13:30,648][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:30,655][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/CancelTicket_Req.xml) by key(1.transtype.201).
[2015-05-29 17:13:30,655][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/CancelTicket_Req.xml).
[2015-05-29 17:13:30,656][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810655|Timestamp:20150529171330|Transaction-Type:201|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011333" isMannul="0"/>,hash=-1297011199), get digest:203793e583f02022e2a17dba8de6f151
[2015-05-29 17:13:30,656][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=201).
[2015-05-29 17:13:30,656][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:30,656][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171330).
[2015-05-29 17:13:30,656][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:30,656][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890810655).
[2015-05-29 17:13:30,656][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:30,656][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:30,656][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=203793e583f02022e2a17dba8de6f151).
[2015-05-29 17:13:30,656][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=1).
[2015-05-29 17:13:30,656][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:30,656][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:30,657][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6ttFDFcpmi1MamgAomcAmY7eTM16XgcUTsY0pFSZpEpJ6R2aU8dnmEe+gRFrutgby7ME7z6kIhcz.
[2015-05-29 17:13:30,657][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810655|Timestamp:20150529171330|Transaction-Type:201|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:30,659][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011333" isMannul="0"/>
[2015-05-29 17:13:30,659][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810655|Timestamp:20150529171330|Transaction-Type:201|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011333" isMannul="0"/>,hash=-1297011199), get digest:203793e583f02022e2a17dba8de6f151
[2015-05-29 17:13:30,659][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/CancelTicket_Req.xml) by key(1.transtype.201).
[2015-05-29 17:13:30,659][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/lotto/CancelTicket_Req.xml
[2015-05-29 17:13:30,659][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/CancelTicket_Req.xml) by key(1.transtype.201).
[2015-05-29 17:13:30,672][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_201_1.5.0).
[2015-05-29 17:13:30,672][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_201_).
[2015-05-29 17:13:30,672][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(1_201_), found controller(com.mpos.lottery.te.gameimpl.lotto.LottoController@388c6589) and method(public void com.mpos.lottery.te.gameimpl.lotto.LottoController.cancelByTicket(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:30,677][Test worker][DEBUG][ReversalOrCancelStrategyFactory] Found ReversalStrategy(class com.mpos.lottery.te.gameimpl.lotto.sale.service.impl.LottoTicketServiceImpl) to cancel transaction(gameType=1,terminalId=111,transType=200,protocolVersion=1.5.0).
[2015-05-29 17:13:30,690][Test worker][DEBUG][DefaultBalanceService] Operator before transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=199998400, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:30,690][Test worker][DEBUG][DefaultBalanceService] Found balance strategy:com.mpos.lottery.te.merchant.service.balance.SaleBalanceStrategy@e1f8aba
[2015-05-29 17:13:30,690][Test worker][DEBUG][DefaultBalanceService] Operator after transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:30,702][Test worker][DEBUG][CommonFacadeService] Prepare to publish message to exchange[TE.200] with routing key[TE.CANCEL.200.1]: origTrans {
  id: "0115052900000000001587"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890810000
  trans_type: 200
  game_id: "GAME-111"
  game_type: 1
  total_amount: "1600"
}
cancelTrans {
  id: "0115052900000000001592"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890810000
  trans_type: 201
  game_id: "GAME-111"
  game_type: 1
  total_amount: "1600"
}

[2015-05-29 17:13:30,702][Test worker][DEBUG][CommonFacadeService] Publish message successfully
[2015-05-29 17:13:30,702][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810655|Timestamp:20150529171330|Transaction-Type:4201|Transaction-Id:0115052900000000001592|Response-Code:200|):099d3e0b0ab41182f02a46d71c4fcf0c
[2015-05-29 17:13:30,702][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=0): 
[2015-05-29 17:13:30,703][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/CancelTicket_Req.xml) by key(1.transtype.201).
[2015-05-29 17:13:30,703][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/CancelTicket_Req.xml).
[2015-05-29 17:13:30,704][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810703|Timestamp:20150529171330|Transaction-Type:201|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011333" isMannul="0"/>,hash=-1662362531), get digest:44387eaf1273182aff42e05900565181
[2015-05-29 17:13:30,704][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=201).
[2015-05-29 17:13:30,704][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:30,704][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171330).
[2015-05-29 17:13:30,704][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:30,704][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890810703).
[2015-05-29 17:13:30,704][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:30,704][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:30,704][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=44387eaf1273182aff42e05900565181).
[2015-05-29 17:13:30,704][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=1).
[2015-05-29 17:13:30,704][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:30,704][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:30,705][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6ttFDFcpmi1MamgAomcAmY7eTM16XgcUTsY0pFSZpEpJ6R2aU8dnmEe+gRFrutgby7ME7z6kIhcz.
[2015-05-29 17:13:30,705][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810703|Timestamp:20150529171330|Transaction-Type:201|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:30,706][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011333" isMannul="0"/>
[2015-05-29 17:13:30,706][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810703|Timestamp:20150529171330|Transaction-Type:201|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011333" isMannul="0"/>,hash=-1662362531), get digest:44387eaf1273182aff42e05900565181
[2015-05-29 17:13:30,706][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/CancelTicket_Req.xml) by key(1.transtype.201).
[2015-05-29 17:13:30,706][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/lotto/CancelTicket_Req.xml
[2015-05-29 17:13:30,706][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/CancelTicket_Req.xml) by key(1.transtype.201).
[2015-05-29 17:13:30,718][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_201_1.5.0).
[2015-05-29 17:13:30,718][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_201_).
[2015-05-29 17:13:30,718][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(1_201_), found controller(com.mpos.lottery.te.gameimpl.lotto.LottoController@388c6589) and method(public void com.mpos.lottery.te.gameimpl.lotto.LottoController.cancelByTicket(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:30,721][Test worker][INFO ][TransactionServiceImpl] NO need to rollback transaction(id=0115052900000000001587), it has been rollbacked.
[2015-05-29 17:13:30,722][Test worker][ERROR][TEPortServlet] The transaction(id=0115052900000000001587) has been reversed, no need to reverse repeatedly.
com.mpos.lottery.te.config.exception.ApplicationException: The transaction(id=0115052900000000001587) has been reversed, no need to reverse repeatedly.
	at com.mpos.lottery.te.trans.service.impl.TransactionServiceImpl.reverseOrCancel(TransactionServiceImpl.java:166)
	at com.mpos.lottery.te.trans.service.impl.TransactionServiceImpl.reverseOrCancel(TransactionServiceImpl.java:227)
	at sun.reflect.GeneratedMethodAccessor288.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:190)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:157)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:98)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:262)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:95)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:92)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:207)
	at com.sun.proxy.$Proxy55.reverseOrCancel(Unknown Source)
	at com.mpos.lottery.te.gameimpl.lotto.LottoController.cancelByTicket(LottoController.java:43)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at com.mpos.lottery.common.router.RoutineRegistry.route(RoutineRegistry.java:57)
	at com.mpos.lottery.te.port.service.CommonFacadeService.routeRequest(CommonFacadeService.java:237)
	at com.mpos.lottery.te.port.service.CommonFacadeService.facade(CommonFacadeService.java:96)
	at sun.reflect.GeneratedMethodAccessor83.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:190)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:157)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:98)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:262)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:95)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:92)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:207)
	at com.sun.proxy.$Proxy85.facade(Unknown Source)
	at com.mpos.lottery.te.port.TEPortServlet.doPost(TEPortServlet.java:121)
	at com.mpos.lottery.te.test.integration.BaseServletIntegrationTest.doPost(BaseServletIntegrationTest.java:80)
	at com.mpos.lottery.te.gameimpl.lotto.sale.TicketCancellationIntegrationTest.testCancelByTicket_Repeatedly(TicketCancellationIntegrationTest.java:148)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:74)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
	at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:83)
	at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:72)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:233)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:87)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:71)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:176)
	at org.junit.runners.Suite.runChild(Suite.java:127)
	at org.junit.runners.Suite.runChild(Suite.java:26)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecuter.runTestClass(JUnitTestClassExecuter.java:86)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecuter.execute(JUnitTestClassExecuter.java:49)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassProcessor.processTestClass(JUnitTestClassProcessor.java:69)
	at org.gradle.api.internal.tasks.testing.SuiteTestClassProcessor.processTestClass(SuiteTestClassProcessor.java:48)
	at sun.reflect.GeneratedMethodAccessor8.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:35)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)
	at org.gradle.messaging.dispatch.ContextClassLoaderDispatch.dispatch(ContextClassLoaderDispatch.java:32)
	at org.gradle.messaging.dispatch.ProxyDispatchAdapter$DispatchingInvocationHandler.invoke(ProxyDispatchAdapter.java:93)
	at com.sun.proxy.$Proxy2.processTestClass(Unknown Source)
	at org.gradle.api.internal.tasks.testing.worker.TestWorker.processTestClass(TestWorker.java:105)
	at sun.reflect.GeneratedMethodAccessor7.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:35)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)
	at org.gradle.messaging.remote.internal.hub.MessageHub$Handler.run(MessageHub.java:360)
	at org.gradle.internal.concurrent.DefaultExecutorFactory$StoppableExecutorImpl$1.run(DefaultExecutorFactory.java:64)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
	at java.lang.Thread.run(Thread.java:745)
[2015-05-29 17:13:30,723][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810703|Timestamp:20150529171330|Transaction-Type:4201|Transaction-Id:0115052900000000001593|Response-Code:321|):5bdd14f3c88439dc3d0c52d91c50cc0c
[2015-05-29 17:13:30,723][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=321,length=0): 
[2015-05-29 17:13:30,734][Test worker][DEBUG][TEPortServlet] Startup job scheduer(org.quartz.impl.StdScheduler@4d1e5820) successfully.
[2015-05-29 17:13:30,735][Test worker][WARN ][TEPortServlet] can NOT find META file:F:\project\M.Lottery\TE\TRUNK_TE\sourcecode\build\classes\main\META-INF\MANIFEST.MF
[2015-05-29 17:13:30,735][Test worker][DEBUG][TEPortServlet] Register MBean(com.mpos.lottery.te.common.jmx.TransactionTimeout@4925c506) with name(com.mpos.lottery.te:type=TransactionTimeoutMBean) successfully.
[2015-05-29 17:13:30,735][Test worker][DEBUG][BaseTransactionalIntegrationTest] Retrieve a ApplicationContext(org.springframework.web.context.support.GenericWebApplicationContext@34f645a8: startup date [Fri May 29 17:12:38 CST 2015]; root of context hierarchy).
[2015-05-29 17:13:30,735][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:30,735][Test worker][INFO ][BaseTransactionalIntegrationTest] | TicketCancellationIntegrationTest.testCancelByTrans_CancelDelined                                                      |
[2015-05-29 17:13:30,735][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:30,738][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:30,739][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/SellTicket_Req.xml).
[2015-05-29 17:13:30,740][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810738|Timestamp:20150529171330|Transaction-Type:200|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>,hash=-1261673849), get digest:c20cc0f0f7d1ce864e4426599da2785f
[2015-05-29 17:13:30,740][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=200).
[2015-05-29 17:13:30,740][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:30,740][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171330).
[2015-05-29 17:13:30,740][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:30,740][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890810738).
[2015-05-29 17:13:30,740][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:30,740][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:30,740][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=c20cc0f0f7d1ce864e4426599da2785f).
[2015-05-29 17:13:30,740][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=1).
[2015-05-29 17:13:30,740][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:30,740][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:30,741][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6vvj1C28m6E+ybhcq2GHfncNCEmxnE1Ou0qcmJ+qutg9pDpTDScnIWI62pEFB0SGtKkhmSVtwRhObbaRtENvsKgd1vgEj9cakrUbLVxBSMJqciae7U9vnZ9gkPZ+TiqwdRl/00lYrPXIRF649XUAfZ/u7Ik8R7r7YZCfSM8Dq3Lk3E+I+8dy5FMq1JBSOx+CBYDZ3n4iWwIrRwN3i9ic9EHYxaBXmh5eMdb+eYfmG3rw7BmwCbT+5YlwzT8o+qK8+x+tCRF0yCaqlMPxlqr0c+eFde9h31TBTgqMtIWk2Ux1nb1TPJ2uDK+Ee2oZ5RgoEzb/nuc9f7RCFw4/R0o1FObopbRaJ9qpV2PI6XK6rtTl1lpL4o22ySC7lKR344K/b+MKthKWb3jb.
[2015-05-29 17:13:30,742][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810738|Timestamp:20150529171330|Transaction-Type:200|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:30,742][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>
[2015-05-29 17:13:30,742][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810738|Timestamp:20150529171330|Transaction-Type:200|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>,hash=-1261673849), get digest:c20cc0f0f7d1ce864e4426599da2785f
[2015-05-29 17:13:30,742][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:30,742][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/lotto/SellTicket_Req.xml
[2015-05-29 17:13:30,742][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:30,756][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_200_1.5.0).
[2015-05-29 17:13:30,756][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_200_).
[2015-05-29 17:13:30,756][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(1_200_), found controller(com.mpos.lottery.te.gameimpl.lotto.LottoController@388c6589) and method(public void com.mpos.lottery.te.gameimpl.lotto.LottoController.sell(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:30,762][Test worker][DEBUG][BaseJpaDao] Query future game instance(class com.mpos.lottery.te.gameimpl.lotto.draw.domain.LottoGameInstance) by(number=20090408,gameId=GAME-111, multipleDraws=2, state=1||2):1
[2015-05-29 17:13:30,767][Test worker][DEBUG][AbstractGameInstanceService] Use channel game instance time definition(IGPE-1).
[2015-05-29 17:13:30,767][Test worker][DEBUG][UUIDServiceImpl] Assemble a new ticket serial number:01110745119300011492
[2015-05-29 17:13:30,773][Test worker][DEBUG][DefaultTicketValidator] THe max allowed multi-draw of operation parameter is 10, merchant limit to 3, the smaller 3 will be used.
[2015-05-29 17:13:30,773][Test worker][DEBUG][DefaultSelectedNumberValidatorFactory] Found ticket validator(com.mpos.lottery.te.gamespec.sale.support.validator.SingleSelectedNumberValidator@2d7cffda) for bet option:1
[2015-05-29 17:13:30,773][Test worker][DEBUG][DefaultSelectedNumberValidatorFactory] Found ticket validator(com.mpos.lottery.te.gamespec.sale.support.validator.MultipleSelectedNumberValidator@6981588a) for bet option:2
[2015-05-29 17:13:30,786][Test worker][DEBUG][DefaultBalanceService] Operator before transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:30,786][Test worker][DEBUG][DefaultBalanceService] Found balance strategy:com.mpos.lottery.te.merchant.service.balance.SaleBalanceStrategy@e1f8aba
[2015-05-29 17:13:30,786][Test worker][DEBUG][DefaultBalanceService] Operator after transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=199998400, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:30,796][Test worker][DEBUG][CommonFacadeService] Prepare to publish message to exchange[TE.200] with routing key[TE.200.1]: transaction {
  id: "0115052900000000001594"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890810000
  trans_type: 200
  game_id: "GAME-111"
  game_type: 1
  total_amount: "1600"
}
multi_draw: 2
total_amount: "1600"
serial_no: "aHhDkgTyIu7OH55EgjjAP+glX9FOuv1/"
game_instance {
  id: "GII-113"
}
entries {
  selected_number: "1,2,3,6,7,13"
  bet_option: 1
  total_bets: 1
  entry_amount: "100"
  input_channel: "1"
}
entries {
  selected_number: "3,11,14,16,22,25,36"
  bet_option: 2
  total_bets: 7
  entry_amount: "700"
  input_channel: "1"
}

[2015-05-29 17:13:30,796][Test worker][DEBUG][CommonFacadeService] Publish message successfully
[2015-05-29 17:13:30,796][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:30,796][Test worker][DEBUG][ProtocolSerializer] Start to serialize model(class com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket),mappingFile=xml-mapping/game/lotto/SellTicket_Res.xml
[2015-05-29 17:13:30,796][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:30,797][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/SellTicket_Res.xml).
[2015-05-29 17:13:30,797][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810738|Timestamp:20150529171330|Transaction-Type:4200|Transaction-Id:0115052900000000001594|Response-Code:200|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011492" type="1" lastDrawNo="20090416" barcode="01cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt8eRiXxElYKctyxR2V9Li0tC5DzwKB/AAs=" validationCode="046779" multipleDraws="2" totalBets="16" totalAmount="1600"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" entryAmount="100" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" entryAmount="700" boostAmount="0"/></Ticket>):257ac3fb2b453b5cf504eac5b3d2e4e7
[2015-05-29 17:13:30,797][Test worker][DEBUG][TEPortServlet] Write response to client(host1=localhost,sizeOfPack=736) succesfully.
[2015-05-29 17:13:30,798][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=736): <?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011492" type="1" lastDrawNo="20090416" barcode="01cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt8eRiXxElYKctyxR2V9Li0tC5DzwKB/AAs=" validationCode="046779" multipleDraws="2" totalBets="16" totalAmount="1600"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" entryAmount="100" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" entryAmount="700" boostAmount="0"/></Ticket>
[2015-05-29 17:13:30,798][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:30,803][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/TransactionEnquiry_Req.xml) by key(transtype.206).
[2015-05-29 17:13:30,804][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.trans.domain.Transaction, mappingFile=xml-mapping/TransactionEnquiry_Req.xml).
[2015-05-29 17:13:30,804][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810803|Timestamp:20150529171330|Transaction-Type:206|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Transaction terminalId="111" traceMessageId="1432890810738"/>,hash=-1511212068), get digest:1cd5cb5c71764dd622a2aa414a6f85e5
[2015-05-29 17:13:30,804][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=206).
[2015-05-29 17:13:30,804][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:30,804][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171330).
[2015-05-29 17:13:30,804][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:30,804][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890810803).
[2015-05-29 17:13:30,804][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:30,804][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:30,804][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=1cd5cb5c71764dd622a2aa414a6f85e5).
[2015-05-29 17:13:30,804][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=-1).
[2015-05-29 17:13:30,804][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:30,804][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:30,806][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6jcIE4b0pl+ogrA4SMNVUFtCb0VnctvqFZ4g+Dv1D5Fz4ERoX4gVmzFJ1yZK27DdH67KOBNBNnYAfphJuoGAcIY=.
[2015-05-29 17:13:30,806][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810803|Timestamp:20150529171330|Transaction-Type:206|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:30,806][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Transaction terminalId="111" traceMessageId="1432890810738"/>
[2015-05-29 17:13:30,806][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810803|Timestamp:20150529171330|Transaction-Type:206|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Transaction terminalId="111" traceMessageId="1432890810738"/>,hash=-1511212068), get digest:1cd5cb5c71764dd622a2aa414a6f85e5
[2015-05-29 17:13:30,806][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/TransactionEnquiry_Req.xml) by key(transtype.206).
[2015-05-29 17:13:30,806][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/TransactionEnquiry_Req.xml
[2015-05-29 17:13:30,806][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/TransactionEnquiry_Req.xml) by key(transtype.206).
[2015-05-29 17:13:30,816][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(-1_206_1.5.0).
[2015-05-29 17:13:30,816][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(-1_206_).
[2015-05-29 17:13:30,816][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(-1_206_), found controller(com.mpos.lottery.te.trans.TransactionController@53ddecd8) and method(public void com.mpos.lottery.te.trans.TransactionController.cancelByTrans(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:30,823][Test worker][DEBUG][ReversalOrCancelStrategyFactory] Found ReversalStrategy(class com.mpos.lottery.te.gameimpl.lotto.sale.service.impl.LottoTicketServiceImpl) to cancel transaction(gameType=1,terminalId=111,transType=200,protocolVersion=1.5.0).
[2015-05-29 17:13:30,837][Test worker][DEBUG][DefaultBalanceService] Operator before transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=199998400, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:30,837][Test worker][DEBUG][DefaultBalanceService] Found balance strategy:com.mpos.lottery.te.merchant.service.balance.SaleBalanceStrategy@e1f8aba
[2015-05-29 17:13:30,837][Test worker][DEBUG][DefaultBalanceService] Operator after transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:30,848][Test worker][DEBUG][CommonFacadeService] Prepare to publish message to exchange[TE.200] with routing key[TE.CANCEL.200.1]: origTrans {
  id: "0115052900000000001594"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890810000
  trans_type: 200
  game_id: "GAME-111"
  game_type: 1
  total_amount: "1600"
}
cancelTrans {
  id: "0115052900000000001599"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890810000
  trans_type: 206
  game_id: "GAME-111"
  game_type: 1
  total_amount: "1600"
}

[2015-05-29 17:13:30,848][Test worker][DEBUG][CommonFacadeService] Publish message successfully
[2015-05-29 17:13:30,848][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810803|Timestamp:20150529171330|Transaction-Type:4206|Transaction-Id:0115052900000000001599|Response-Code:333|):9a04d837bfda02bbae5ddb3f40380931
[2015-05-29 17:13:30,848][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=333,length=0): 
[2015-05-29 17:13:30,870][Test worker][DEBUG][TEPortServlet] Startup job scheduer(org.quartz.impl.StdScheduler@4d1e5820) successfully.
[2015-05-29 17:13:30,870][Test worker][WARN ][TEPortServlet] can NOT find META file:F:\project\M.Lottery\TE\TRUNK_TE\sourcecode\build\classes\main\META-INF\MANIFEST.MF
[2015-05-29 17:13:30,870][Test worker][DEBUG][TEPortServlet] Register MBean(com.mpos.lottery.te.common.jmx.TransactionTimeout@40c9d967) with name(com.mpos.lottery.te:type=TransactionTimeoutMBean) successfully.
[2015-05-29 17:13:30,871][Test worker][DEBUG][BaseTransactionalIntegrationTest] Retrieve a ApplicationContext(org.springframework.web.context.support.GenericWebApplicationContext@34f645a8: startup date [Fri May 29 17:12:38 CST 2015]; root of context hierarchy).
[2015-05-29 17:13:30,871][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:30,871][Test worker][INFO ][BaseTransactionalIntegrationTest] | TicketCancellationIntegrationTest.testCancelByTrans_Repeatedly                                                         |
[2015-05-29 17:13:30,871][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:30,874][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:30,875][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/SellTicket_Req.xml).
[2015-05-29 17:13:30,875][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810874|Timestamp:20150529171330|Transaction-Type:200|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>,hash=-408784512), get digest:b6ce36b20960995a482484860c84c5a5
[2015-05-29 17:13:30,875][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=200).
[2015-05-29 17:13:30,875][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:30,875][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171330).
[2015-05-29 17:13:30,875][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:30,875][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890810874).
[2015-05-29 17:13:30,875][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:30,876][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:30,876][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=b6ce36b20960995a482484860c84c5a5).
[2015-05-29 17:13:30,876][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=1).
[2015-05-29 17:13:30,876][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:30,876][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:30,878][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6vvj1C28m6E+ybhcq2GHfncNCEmxnE1Ou0qcmJ+qutg9pDpTDScnIWI62pEFB0SGtKkhmSVtwRhObbaRtENvsKgd1vgEj9cakrUbLVxBSMJqciae7U9vnZ9gkPZ+TiqwdRl/00lYrPXIRF649XUAfZ/u7Ik8R7r7YZCfSM8Dq3Lk3E+I+8dy5FMq1JBSOx+CBYDZ3n4iWwIrRwN3i9ic9EHYxaBXmh5eMdb+eYfmG3rw7BmwCbT+5YlwzT8o+qK8+x+tCRF0yCaqlMPxlqr0c+eFde9h31TBTgqMtIWk2Ux1nb1TPJ2uDK+Ee2oZ5RgoEzb/nuc9f7RCFw4/R0o1FObopbRaJ9qpV2PI6XK6rtTl1lpL4o22ySC7lKR344K/b+MKthKWb3jb.
[2015-05-29 17:13:30,878][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810874|Timestamp:20150529171330|Transaction-Type:200|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:30,878][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>
[2015-05-29 17:13:30,878][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810874|Timestamp:20150529171330|Transaction-Type:200|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>,hash=-408784512), get digest:b6ce36b20960995a482484860c84c5a5
[2015-05-29 17:13:30,878][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:30,878][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/lotto/SellTicket_Req.xml
[2015-05-29 17:13:30,878][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:30,889][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_200_1.5.0).
[2015-05-29 17:13:30,889][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_200_).
[2015-05-29 17:13:30,889][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(1_200_), found controller(com.mpos.lottery.te.gameimpl.lotto.LottoController@388c6589) and method(public void com.mpos.lottery.te.gameimpl.lotto.LottoController.sell(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:30,895][Test worker][DEBUG][BaseJpaDao] Query future game instance(class com.mpos.lottery.te.gameimpl.lotto.draw.domain.LottoGameInstance) by(number=20090408,gameId=GAME-111, multipleDraws=2, state=1||2):1
[2015-05-29 17:13:30,900][Test worker][DEBUG][AbstractGameInstanceService] Use channel game instance time definition(IGPE-1).
[2015-05-29 17:13:30,900][Test worker][DEBUG][UUIDServiceImpl] Assemble a new ticket serial number:01110745119300011588
[2015-05-29 17:13:30,906][Test worker][DEBUG][DefaultTicketValidator] THe max allowed multi-draw of operation parameter is 10, merchant limit to 3, the smaller 3 will be used.
[2015-05-29 17:13:30,906][Test worker][DEBUG][DefaultSelectedNumberValidatorFactory] Found ticket validator(com.mpos.lottery.te.gamespec.sale.support.validator.SingleSelectedNumberValidator@1ce32304) for bet option:1
[2015-05-29 17:13:30,906][Test worker][DEBUG][DefaultSelectedNumberValidatorFactory] Found ticket validator(com.mpos.lottery.te.gamespec.sale.support.validator.MultipleSelectedNumberValidator@40fea6d) for bet option:2
[2015-05-29 17:13:30,918][Test worker][DEBUG][DefaultBalanceService] Operator before transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:30,918][Test worker][DEBUG][DefaultBalanceService] Found balance strategy:com.mpos.lottery.te.merchant.service.balance.SaleBalanceStrategy@e1f8aba
[2015-05-29 17:13:30,919][Test worker][DEBUG][DefaultBalanceService] Operator after transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=199998400, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:30,928][Test worker][DEBUG][CommonFacadeService] Prepare to publish message to exchange[TE.200] with routing key[TE.200.1]: transaction {
  id: "0115052900000000001600"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890810000
  trans_type: 200
  game_id: "GAME-111"
  game_type: 1
  total_amount: "1600"
}
multi_draw: 2
total_amount: "1600"
serial_no: "aHhDkgTyIu7OH55EgjjAP01WcnG2Sl/m"
game_instance {
  id: "GII-113"
}
entries {
  selected_number: "1,2,3,6,7,13"
  bet_option: 1
  total_bets: 1
  entry_amount: "100"
  input_channel: "1"
}
entries {
  selected_number: "3,11,14,16,22,25,36"
  bet_option: 2
  total_bets: 7
  entry_amount: "700"
  input_channel: "1"
}

[2015-05-29 17:13:30,928][Test worker][DEBUG][CommonFacadeService] Publish message successfully
[2015-05-29 17:13:30,928][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:30,928][Test worker][DEBUG][ProtocolSerializer] Start to serialize model(class com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket),mappingFile=xml-mapping/game/lotto/SellTicket_Res.xml
[2015-05-29 17:13:30,929][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:30,929][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/SellTicket_Res.xml).
[2015-05-29 17:13:30,929][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810874|Timestamp:20150529171330|Transaction-Type:4200|Transaction-Id:0115052900000000001600|Response-Code:200|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011588" type="1" lastDrawNo="20090416" barcode="01cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt8eRiXxElYKctyxR2V9Li0t8920Q1bW6Aw=" validationCode="575020" multipleDraws="2" totalBets="16" totalAmount="1600"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" entryAmount="100" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" entryAmount="700" boostAmount="0"/></Ticket>):836c6219a28ae16569d24fc4a75eec1f
[2015-05-29 17:13:30,930][Test worker][DEBUG][TEPortServlet] Write response to client(host1=localhost,sizeOfPack=736) succesfully.
[2015-05-29 17:13:30,930][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=736): <?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011588" type="1" lastDrawNo="20090416" barcode="01cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt8eRiXxElYKctyxR2V9Li0t8920Q1bW6Aw=" validationCode="575020" multipleDraws="2" totalBets="16" totalAmount="1600"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" entryAmount="100" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" entryAmount="700" boostAmount="0"/></Ticket>
[2015-05-29 17:13:30,930][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:30,934][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/TransactionEnquiry_Req.xml) by key(transtype.206).
[2015-05-29 17:13:30,935][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.trans.domain.Transaction, mappingFile=xml-mapping/TransactionEnquiry_Req.xml).
[2015-05-29 17:13:30,935][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810934|Timestamp:20150529171330|Transaction-Type:206|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Transaction terminalId="111" traceMessageId="1432890810874"/>,hash=-1427947900), get digest:b97d95992f67b74a4c8a4365b4119ffe
[2015-05-29 17:13:30,935][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=206).
[2015-05-29 17:13:30,935][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:30,935][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171330).
[2015-05-29 17:13:30,935][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:30,935][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890810934).
[2015-05-29 17:13:30,935][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:30,935][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:30,935][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=b97d95992f67b74a4c8a4365b4119ffe).
[2015-05-29 17:13:30,935][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=-1).
[2015-05-29 17:13:30,936][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:30,936][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:30,938][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6jcIE4b0pl+ogrA4SMNVUFtCb0VnctvqFZ4g+Dv1D5Fz4ERoX4gVmzFJ1yZK27DdHxN42h9w4mSiFlGUnJ9JX+g=.
[2015-05-29 17:13:30,938][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810934|Timestamp:20150529171330|Transaction-Type:206|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:30,938][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Transaction terminalId="111" traceMessageId="1432890810874"/>
[2015-05-29 17:13:30,939][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810934|Timestamp:20150529171330|Transaction-Type:206|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Transaction terminalId="111" traceMessageId="1432890810874"/>,hash=-1427947900), get digest:b97d95992f67b74a4c8a4365b4119ffe
[2015-05-29 17:13:30,939][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/TransactionEnquiry_Req.xml) by key(transtype.206).
[2015-05-29 17:13:30,939][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/TransactionEnquiry_Req.xml
[2015-05-29 17:13:30,939][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/TransactionEnquiry_Req.xml) by key(transtype.206).
[2015-05-29 17:13:30,951][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(-1_206_1.5.0).
[2015-05-29 17:13:30,951][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(-1_206_).
[2015-05-29 17:13:30,951][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(-1_206_), found controller(com.mpos.lottery.te.trans.TransactionController@53ddecd8) and method(public void com.mpos.lottery.te.trans.TransactionController.cancelByTrans(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:30,956][Test worker][DEBUG][ReversalOrCancelStrategyFactory] Found ReversalStrategy(class com.mpos.lottery.te.gameimpl.lotto.sale.service.impl.LottoTicketServiceImpl) to cancel transaction(gameType=1,terminalId=111,transType=200,protocolVersion=1.5.0).
[2015-05-29 17:13:30,969][Test worker][DEBUG][DefaultBalanceService] Operator before transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=199998400, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:30,969][Test worker][DEBUG][DefaultBalanceService] Found balance strategy:com.mpos.lottery.te.merchant.service.balance.SaleBalanceStrategy@e1f8aba
[2015-05-29 17:13:30,969][Test worker][DEBUG][DefaultBalanceService] Operator after transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:30,980][Test worker][DEBUG][CommonFacadeService] Prepare to publish message to exchange[TE.200] with routing key[TE.CANCEL.200.1]: origTrans {
  id: "0115052900000000001600"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890810000
  trans_type: 200
  game_id: "GAME-111"
  game_type: 1
  total_amount: "1600"
}
cancelTrans {
  id: "0115052900000000001605"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890810000
  trans_type: 206
  game_id: "GAME-111"
  game_type: 1
  total_amount: "1600"
}

[2015-05-29 17:13:30,981][Test worker][DEBUG][CommonFacadeService] Publish message successfully
[2015-05-29 17:13:30,981][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810934|Timestamp:20150529171330|Transaction-Type:4206|Transaction-Id:0115052900000000001605|Response-Code:200|):5a38cb2bfae6ed6144f6f09d90e00624
[2015-05-29 17:13:30,981][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=0): 
[2015-05-29 17:13:30,982][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/TransactionEnquiry_Req.xml) by key(transtype.206).
[2015-05-29 17:13:30,982][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.trans.domain.Transaction, mappingFile=xml-mapping/TransactionEnquiry_Req.xml).
[2015-05-29 17:13:30,982][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810982|Timestamp:20150529171330|Transaction-Type:206|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Transaction terminalId="111" traceMessageId="1432890810874"/>,hash=346296651), get digest:fea83b55beace02e0ce1243618357091
[2015-05-29 17:13:30,983][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=206).
[2015-05-29 17:13:30,983][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:30,983][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171330).
[2015-05-29 17:13:30,983][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:30,983][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890810982).
[2015-05-29 17:13:30,983][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:30,983][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:30,983][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=fea83b55beace02e0ce1243618357091).
[2015-05-29 17:13:30,983][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=-1).
[2015-05-29 17:13:30,983][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:30,983][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:30,984][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6jcIE4b0pl+ogrA4SMNVUFtCb0VnctvqFZ4g+Dv1D5Fz4ERoX4gVmzFJ1yZK27DdHxN42h9w4mSiFlGUnJ9JX+g=.
[2015-05-29 17:13:30,984][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810982|Timestamp:20150529171330|Transaction-Type:206|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:30,984][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Transaction terminalId="111" traceMessageId="1432890810874"/>
[2015-05-29 17:13:30,985][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810982|Timestamp:20150529171330|Transaction-Type:206|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Transaction terminalId="111" traceMessageId="1432890810874"/>,hash=346296651), get digest:fea83b55beace02e0ce1243618357091
[2015-05-29 17:13:30,985][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/TransactionEnquiry_Req.xml) by key(transtype.206).
[2015-05-29 17:13:30,985][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/TransactionEnquiry_Req.xml
[2015-05-29 17:13:30,985][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/TransactionEnquiry_Req.xml) by key(transtype.206).
[2015-05-29 17:13:30,995][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(-1_206_1.5.0).
[2015-05-29 17:13:30,995][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(-1_206_).
[2015-05-29 17:13:30,995][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(-1_206_), found controller(com.mpos.lottery.te.trans.TransactionController@53ddecd8) and method(public void com.mpos.lottery.te.trans.TransactionController.cancelByTrans(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:30,998][Test worker][INFO ][TransactionServiceImpl] NO need to rollback transaction(id=0115052900000000001600), it has been rollbacked.
[2015-05-29 17:13:30,998][Test worker][ERROR][TEPortServlet] The transaction(id=0115052900000000001600) has been reversed, no need to reverse repeatedly.
com.mpos.lottery.te.config.exception.ApplicationException: The transaction(id=0115052900000000001600) has been reversed, no need to reverse repeatedly.
	at com.mpos.lottery.te.trans.service.impl.TransactionServiceImpl.reverseOrCancel(TransactionServiceImpl.java:166)
	at sun.reflect.GeneratedMethodAccessor273.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:190)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:157)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:98)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:262)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:95)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:92)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:207)
	at com.sun.proxy.$Proxy55.reverseOrCancel(Unknown Source)
	at com.mpos.lottery.te.trans.TransactionController.cancelByTrans(TransactionController.java:30)
	at sun.reflect.GeneratedMethodAccessor274.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at com.mpos.lottery.common.router.RoutineRegistry.route(RoutineRegistry.java:57)
	at com.mpos.lottery.te.port.service.CommonFacadeService.routeRequest(CommonFacadeService.java:237)
	at com.mpos.lottery.te.port.service.CommonFacadeService.facade(CommonFacadeService.java:96)
	at sun.reflect.GeneratedMethodAccessor83.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:190)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:157)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:98)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:262)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:95)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:92)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:207)
	at com.sun.proxy.$Proxy85.facade(Unknown Source)
	at com.mpos.lottery.te.port.TEPortServlet.doPost(TEPortServlet.java:121)
	at com.mpos.lottery.te.test.integration.BaseServletIntegrationTest.doPost(BaseServletIntegrationTest.java:80)
	at com.mpos.lottery.te.gameimpl.lotto.sale.TicketCancellationIntegrationTest.testCancelByTrans_Repeatedly(TicketCancellationIntegrationTest.java:449)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:74)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
	at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:83)
	at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:72)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:233)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:87)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:71)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:176)
	at org.junit.runners.Suite.runChild(Suite.java:127)
	at org.junit.runners.Suite.runChild(Suite.java:26)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecuter.runTestClass(JUnitTestClassExecuter.java:86)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecuter.execute(JUnitTestClassExecuter.java:49)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassProcessor.processTestClass(JUnitTestClassProcessor.java:69)
	at org.gradle.api.internal.tasks.testing.SuiteTestClassProcessor.processTestClass(SuiteTestClassProcessor.java:48)
	at sun.reflect.GeneratedMethodAccessor8.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:35)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)
	at org.gradle.messaging.dispatch.ContextClassLoaderDispatch.dispatch(ContextClassLoaderDispatch.java:32)
	at org.gradle.messaging.dispatch.ProxyDispatchAdapter$DispatchingInvocationHandler.invoke(ProxyDispatchAdapter.java:93)
	at com.sun.proxy.$Proxy2.processTestClass(Unknown Source)
	at org.gradle.api.internal.tasks.testing.worker.TestWorker.processTestClass(TestWorker.java:105)
	at sun.reflect.GeneratedMethodAccessor7.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:35)
	at org.gradle.messaging.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)
	at org.gradle.messaging.remote.internal.hub.MessageHub$Handler.run(MessageHub.java:360)
	at org.gradle.internal.concurrent.DefaultExecutorFactory$StoppableExecutorImpl$1.run(DefaultExecutorFactory.java:64)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
	at java.lang.Thread.run(Thread.java:745)
[2015-05-29 17:13:30,999][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890810982|Timestamp:20150529171330|Transaction-Type:4206|Transaction-Id:0115052900000000001606|Response-Code:321|):9d2af77205c1d4719c5497343e40b702
[2015-05-29 17:13:30,999][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=321,length=0): 
[2015-05-29 17:13:31,019][Test worker][DEBUG][TEPortServlet] Startup job scheduer(org.quartz.impl.StdScheduler@4d1e5820) successfully.
[2015-05-29 17:13:31,019][Test worker][WARN ][TEPortServlet] can NOT find META file:F:\project\M.Lottery\TE\TRUNK_TE\sourcecode\build\classes\main\META-INF\MANIFEST.MF
[2015-05-29 17:13:31,019][Test worker][DEBUG][TEPortServlet] Register MBean(com.mpos.lottery.te.common.jmx.TransactionTimeout@43a33b4) with name(com.mpos.lottery.te:type=TransactionTimeoutMBean) successfully.
[2015-05-29 17:13:31,020][Test worker][DEBUG][BaseTransactionalIntegrationTest] Retrieve a ApplicationContext(org.springframework.web.context.support.GenericWebApplicationContext@34f645a8: startup date [Fri May 29 17:12:38 CST 2015]; root of context hierarchy).
[2015-05-29 17:13:31,020][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:31,020][Test worker][INFO ][BaseTransactionalIntegrationTest] | TicketCancellationIntegrationTest.testCancelByTicket_OK                                                                |
[2015-05-29 17:13:31,020][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:31,023][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:31,025][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/SellTicket_Req.xml).
[2015-05-29 17:13:31,025][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890811023|Timestamp:20150529171331|Transaction-Type:200|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>,hash=1295442842), get digest:f1c4a10329a075e5abb6c75e5f80f4f8
[2015-05-29 17:13:31,025][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=200).
[2015-05-29 17:13:31,025][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:31,025][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171331).
[2015-05-29 17:13:31,025][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:31,025][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890811023).
[2015-05-29 17:13:31,025][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:31,025][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:31,025][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=f1c4a10329a075e5abb6c75e5f80f4f8).
[2015-05-29 17:13:31,025][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=1).
[2015-05-29 17:13:31,025][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:31,025][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:31,027][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6vvj1C28m6E+ybhcq2GHfncNCEmxnE1Ou0qcmJ+qutg9pDpTDScnIWI62pEFB0SGtKkhmSVtwRhObbaRtENvsKgd1vgEj9cakrUbLVxBSMJqciae7U9vnZ9gkPZ+TiqwdRl/00lYrPXIRF649XUAfZ/u7Ik8R7r7YZCfSM8Dq3Lk3E+I+8dy5FMq1JBSOx+CBYDZ3n4iWwIrRwN3i9ic9EHYxaBXmh5eMdb+eYfmG3rw7BmwCbT+5YlwzT8o+qK8+x+tCRF0yCaqlMPxlqr0c+eFde9h31TBTgqMtIWk2Ux1nb1TPJ2uDK+Ee2oZ5RgoEzb/nuc9f7RCFw4/R0o1FObopbRaJ9qpV2PI6XK6rtTl1lpL4o22ySC7lKR344K/b+MKthKWb3jb.
[2015-05-29 17:13:31,027][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890811023|Timestamp:20150529171331|Transaction-Type:200|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:31,027][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>
[2015-05-29 17:13:31,027][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890811023|Timestamp:20150529171331|Transaction-Type:200|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>,hash=1295442842), get digest:f1c4a10329a075e5abb6c75e5f80f4f8
[2015-05-29 17:13:31,027][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:31,027][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/lotto/SellTicket_Req.xml
[2015-05-29 17:13:31,027][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:31,038][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_200_1.5.0).
[2015-05-29 17:13:31,038][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_200_).
[2015-05-29 17:13:31,038][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(1_200_), found controller(com.mpos.lottery.te.gameimpl.lotto.LottoController@388c6589) and method(public void com.mpos.lottery.te.gameimpl.lotto.LottoController.sell(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:31,044][Test worker][DEBUG][BaseJpaDao] Query future game instance(class com.mpos.lottery.te.gameimpl.lotto.draw.domain.LottoGameInstance) by(number=20090408,gameId=GAME-111, multipleDraws=2, state=1||2):1
[2015-05-29 17:13:31,049][Test worker][DEBUG][AbstractGameInstanceService] Use channel game instance time definition(IGPE-1).
[2015-05-29 17:13:31,049][Test worker][DEBUG][UUIDServiceImpl] Assemble a new ticket serial number:01110745119300011641
[2015-05-29 17:13:31,055][Test worker][DEBUG][DefaultTicketValidator] THe max allowed multi-draw of operation parameter is 10, merchant limit to 3, the smaller 3 will be used.
[2015-05-29 17:13:31,055][Test worker][DEBUG][DefaultSelectedNumberValidatorFactory] Found ticket validator(com.mpos.lottery.te.gamespec.sale.support.validator.SingleSelectedNumberValidator@6434ec2d) for bet option:1
[2015-05-29 17:13:31,055][Test worker][DEBUG][DefaultSelectedNumberValidatorFactory] Found ticket validator(com.mpos.lottery.te.gamespec.sale.support.validator.MultipleSelectedNumberValidator@4e7db1c0) for bet option:2
[2015-05-29 17:13:31,069][Test worker][DEBUG][DefaultBalanceService] Operator before transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:31,069][Test worker][DEBUG][DefaultBalanceService] Found balance strategy:com.mpos.lottery.te.merchant.service.balance.SaleBalanceStrategy@e1f8aba
[2015-05-29 17:13:31,069][Test worker][DEBUG][DefaultBalanceService] Operator after transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=199998400, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:31,078][Test worker][DEBUG][CommonFacadeService] Prepare to publish message to exchange[TE.200] with routing key[TE.200.1]: transaction {
  id: "0115052900000000001607"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890811000
  trans_type: 200
  game_id: "GAME-111"
  game_type: 1
  total_amount: "1600"
}
multi_draw: 2
total_amount: "1600"
serial_no: "aHhDkgTyIu7OH55EgjjAP3IIBv8Gai+6"
game_instance {
  id: "GII-113"
}
entries {
  selected_number: "1,2,3,6,7,13"
  bet_option: 1
  total_bets: 1
  entry_amount: "100"
  input_channel: "1"
}
entries {
  selected_number: "3,11,14,16,22,25,36"
  bet_option: 2
  total_bets: 7
  entry_amount: "700"
  input_channel: "1"
}

[2015-05-29 17:13:31,079][Test worker][DEBUG][CommonFacadeService] Publish message successfully
[2015-05-29 17:13:31,079][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:31,079][Test worker][DEBUG][ProtocolSerializer] Start to serialize model(class com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket),mappingFile=xml-mapping/game/lotto/SellTicket_Res.xml
[2015-05-29 17:13:31,079][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:31,079][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/SellTicket_Res.xml).
[2015-05-29 17:13:31,080][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890811023|Timestamp:20150529171331|Transaction-Type:4200|Transaction-Id:0115052900000000001607|Response-Code:200|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011641" type="1" lastDrawNo="20090416" barcode="01cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt8eRiXxElYKctyxR2V9Li0ttgsceeGH1kI=" validationCode="212880" multipleDraws="2" totalBets="16" totalAmount="1600"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" entryAmount="100" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" entryAmount="700" boostAmount="0"/></Ticket>):34f2f32a41ab6da540775c1de998fe99
[2015-05-29 17:13:31,080][Test worker][DEBUG][TEPortServlet] Write response to client(host1=localhost,sizeOfPack=736) succesfully.
[2015-05-29 17:13:31,080][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=736): <?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011641" type="1" lastDrawNo="20090416" barcode="01cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt8eRiXxElYKctyxR2V9Li0ttgsceeGH1kI=" validationCode="212880" multipleDraws="2" totalBets="16" totalAmount="1600"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" entryAmount="100" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" entryAmount="700" boostAmount="0"/></Ticket>
[2015-05-29 17:13:31,080][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:31,089][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/CancelTicket_Req.xml) by key(1.transtype.201).
[2015-05-29 17:13:31,089][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/CancelTicket_Req.xml).
[2015-05-29 17:13:31,090][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890811089|Timestamp:20150529171331|Transaction-Type:201|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011641" isMannul="0"/>,hash=-1717687128), get digest:7dc6edfd58e3e9b45c629c4312dadad9
[2015-05-29 17:13:31,090][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=201).
[2015-05-29 17:13:31,090][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:31,090][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171331).
[2015-05-29 17:13:31,090][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:31,090][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890811089).
[2015-05-29 17:13:31,090][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:31,090][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:31,090][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=7dc6edfd58e3e9b45c629c4312dadad9).
[2015-05-29 17:13:31,090][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=1).
[2015-05-29 17:13:31,090][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:31,090][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:31,093][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6ttFDFcpmi1MamgAomcAmY7eTM16XgcUTsY0pFSZpEpJby+kLDjs+GxRlydaHuUUVPivhp4JmmFW.
[2015-05-29 17:13:31,093][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890811089|Timestamp:20150529171331|Transaction-Type:201|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:31,093][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011641" isMannul="0"/>
[2015-05-29 17:13:31,094][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890811089|Timestamp:20150529171331|Transaction-Type:201|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011641" isMannul="0"/>,hash=-1717687128), get digest:7dc6edfd58e3e9b45c629c4312dadad9
[2015-05-29 17:13:31,094][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/CancelTicket_Req.xml) by key(1.transtype.201).
[2015-05-29 17:13:31,094][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/lotto/CancelTicket_Req.xml
[2015-05-29 17:13:31,094][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/CancelTicket_Req.xml) by key(1.transtype.201).
[2015-05-29 17:13:31,109][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_201_1.5.0).
[2015-05-29 17:13:31,109][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_201_).
[2015-05-29 17:13:31,109][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(1_201_), found controller(com.mpos.lottery.te.gameimpl.lotto.LottoController@388c6589) and method(public void com.mpos.lottery.te.gameimpl.lotto.LottoController.cancelByTicket(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:31,115][Test worker][DEBUG][ReversalOrCancelStrategyFactory] Found ReversalStrategy(class com.mpos.lottery.te.gameimpl.lotto.sale.service.impl.LottoTicketServiceImpl) to cancel transaction(gameType=1,terminalId=111,transType=200,protocolVersion=1.5.0).
[2015-05-29 17:13:31,132][Test worker][DEBUG][DefaultBalanceService] Operator before transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=199998400, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:31,132][Test worker][DEBUG][DefaultBalanceService] Found balance strategy:com.mpos.lottery.te.merchant.service.balance.SaleBalanceStrategy@e1f8aba
[2015-05-29 17:13:31,132][Test worker][DEBUG][DefaultBalanceService] Operator after transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:31,143][Test worker][DEBUG][CommonFacadeService] Prepare to publish message to exchange[TE.200] with routing key[TE.CANCEL.200.1]: origTrans {
  id: "0115052900000000001607"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890811000
  trans_type: 200
  game_id: "GAME-111"
  game_type: 1
  total_amount: "1600"
}
cancelTrans {
  id: "0115052900000000001612"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890811000
  trans_type: 201
  game_id: "GAME-111"
  game_type: 1
  total_amount: "1600"
}

[2015-05-29 17:13:31,143][Test worker][DEBUG][CommonFacadeService] Publish message successfully
[2015-05-29 17:13:31,144][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890811089|Timestamp:20150529171331|Transaction-Type:4201|Transaction-Id:0115052900000000001612|Response-Code:200|):f5c576ae9ebfc06a306e6947a568c605
[2015-05-29 17:13:31,144][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=0): 
[2015-05-29 17:13:31,167][Test worker][DEBUG][TEPortServlet] Startup job scheduer(org.quartz.impl.StdScheduler@4d1e5820) successfully.
[2015-05-29 17:13:31,167][Test worker][WARN ][TEPortServlet] can NOT find META file:F:\project\M.Lottery\TE\TRUNK_TE\sourcecode\build\classes\main\META-INF\MANIFEST.MF
[2015-05-29 17:13:31,167][Test worker][DEBUG][TEPortServlet] Register MBean(com.mpos.lottery.te.common.jmx.TransactionTimeout@62e24681) with name(com.mpos.lottery.te:type=TransactionTimeoutMBean) successfully.
[2015-05-29 17:13:31,168][Test worker][DEBUG][BaseTransactionalIntegrationTest] Retrieve a ApplicationContext(org.springframework.web.context.support.GenericWebApplicationContext@34f645a8: startup date [Fri May 29 17:12:38 CST 2015]; root of context hierarchy).
[2015-05-29 17:13:31,168][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:31,168][Test worker][INFO ][BaseTransactionalIntegrationTest] | TicketCancellationIntegrationTest.testCancelByTicket_RemovedOperator                                                   |
[2015-05-29 17:13:31,168][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:31,168][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:31,169][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/SellTicket_Req.xml).
[2015-05-29 17:13:31,169][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890811168|Timestamp:20150529171331|Transaction-Type:200|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>,hash=-1551509156), get digest:d6b96298b128608ca9966e156e3b3609
[2015-05-29 17:13:31,170][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=200).
[2015-05-29 17:13:31,170][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:31,170][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171331).
[2015-05-29 17:13:31,170][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:31,170][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890811168).
[2015-05-29 17:13:31,170][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:31,170][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:31,170][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=d6b96298b128608ca9966e156e3b3609).
[2015-05-29 17:13:31,170][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=1).
[2015-05-29 17:13:31,170][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:31,170][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:31,172][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6vvj1C28m6E+ybhcq2GHfncNCEmxnE1Ou0qcmJ+qutg9pDpTDScnIWI62pEFB0SGtKkhmSVtwRhObbaRtENvsKgd1vgEj9cakrUbLVxBSMJqciae7U9vnZ9gkPZ+TiqwdRl/00lYrPXIRF649XUAfZ/u7Ik8R7r7YZCfSM8Dq3Lk3E+I+8dy5FMq1JBSOx+CBYDZ3n4iWwIrRwN3i9ic9EHYxaBXmh5eMdb+eYfmG3rw7BmwCbT+5YlwzT8o+qK8+x+tCRF0yCaqlMPxlqr0c+eFde9h31TBTgqMtIWk2Ux1nb1TPJ2uDK+Ee2oZ5RgoEzb/nuc9f7RCFw4/R0o1FObopbRaJ9qpV2PI6XK6rtTl1lpL4o22ySC7lKR344K/b+MKthKWb3jb.
[2015-05-29 17:13:31,172][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890811168|Timestamp:20150529171331|Transaction-Type:200|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:31,172][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>
[2015-05-29 17:13:31,172][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890811168|Timestamp:20150529171331|Transaction-Type:200|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>,hash=-1551509156), get digest:d6b96298b128608ca9966e156e3b3609
[2015-05-29 17:13:31,173][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:31,173][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/lotto/SellTicket_Req.xml
[2015-05-29 17:13:31,173][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:31,187][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_200_1.5.0).
[2015-05-29 17:13:31,187][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_200_).
[2015-05-29 17:13:31,187][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(1_200_), found controller(com.mpos.lottery.te.gameimpl.lotto.LottoController@388c6589) and method(public void com.mpos.lottery.te.gameimpl.lotto.LottoController.sell(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:31,193][Test worker][DEBUG][BaseJpaDao] Query future game instance(class com.mpos.lottery.te.gameimpl.lotto.draw.domain.LottoGameInstance) by(number=20090408,gameId=GAME-111, multipleDraws=2, state=1||2):1
[2015-05-29 17:13:31,198][Test worker][DEBUG][AbstractGameInstanceService] Use channel game instance time definition(IGPE-1).
[2015-05-29 17:13:31,198][Test worker][DEBUG][UUIDServiceImpl] Assemble a new ticket serial number:01110745119300011735
[2015-05-29 17:13:31,204][Test worker][DEBUG][DefaultTicketValidator] THe max allowed multi-draw of operation parameter is 10, merchant limit to 3, the smaller 3 will be used.
[2015-05-29 17:13:31,204][Test worker][DEBUG][DefaultSelectedNumberValidatorFactory] Found ticket validator(com.mpos.lottery.te.gamespec.sale.support.validator.SingleSelectedNumberValidator@148f3a1b) for bet option:1
[2015-05-29 17:13:31,204][Test worker][DEBUG][DefaultSelectedNumberValidatorFactory] Found ticket validator(com.mpos.lottery.te.gamespec.sale.support.validator.MultipleSelectedNumberValidator@472fcd28) for bet option:2
[2015-05-29 17:13:31,217][Test worker][DEBUG][DefaultBalanceService] Operator before transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:31,217][Test worker][DEBUG][DefaultBalanceService] Found balance strategy:com.mpos.lottery.te.merchant.service.balance.SaleBalanceStrategy@e1f8aba
[2015-05-29 17:13:31,217][Test worker][DEBUG][DefaultBalanceService] Operator after transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=199998400, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:31,228][Test worker][DEBUG][CommonFacadeService] Prepare to publish message to exchange[TE.200] with routing key[TE.200.1]: transaction {
  id: "0115052900000000001613"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890811000
  trans_type: 200
  game_id: "GAME-111"
  game_type: 1
  total_amount: "1600"
}
multi_draw: 2
total_amount: "1600"
serial_no: "aHhDkgTyIu7OH55EgjjAP4myM0Z/Y3ej"
game_instance {
  id: "GII-113"
}
entries {
  selected_number: "1,2,3,6,7,13"
  bet_option: 1
  total_bets: 1
  entry_amount: "100"
  input_channel: "1"
}
entries {
  selected_number: "3,11,14,16,22,25,36"
  bet_option: 2
  total_bets: 7
  entry_amount: "700"
  input_channel: "1"
}

[2015-05-29 17:13:31,228][Test worker][DEBUG][CommonFacadeService] Publish message successfully
[2015-05-29 17:13:31,228][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:31,228][Test worker][DEBUG][ProtocolSerializer] Start to serialize model(class com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket),mappingFile=xml-mapping/game/lotto/SellTicket_Res.xml
[2015-05-29 17:13:31,228][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:31,229][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/SellTicket_Res.xml).
[2015-05-29 17:13:31,229][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890811168|Timestamp:20150529171331|Transaction-Type:4200|Transaction-Id:0115052900000000001613|Response-Code:200|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011735" type="1" lastDrawNo="20090416" barcode="01cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt8eRiXxElYKctyxR2V9Li0tcErWr0HVMz0=" validationCode="726421" multipleDraws="2" totalBets="16" totalAmount="1600"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" entryAmount="100" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" entryAmount="700" boostAmount="0"/></Ticket>):9f1689b3e0752e9c1b22a9254f752d3b
[2015-05-29 17:13:31,230][Test worker][DEBUG][TEPortServlet] Write response to client(host1=localhost,sizeOfPack=736) succesfully.
[2015-05-29 17:13:31,230][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=736): <?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011735" type="1" lastDrawNo="20090416" barcode="01cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt8eRiXxElYKctyxR2V9Li0tcErWr0HVMz0=" validationCode="726421" multipleDraws="2" totalBets="16" totalAmount="1600"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" entryAmount="100" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" entryAmount="700" boostAmount="0"/></Ticket>
[2015-05-29 17:13:31,231][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:31,242][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/CancelTicket_Req.xml) by key(1.transtype.201).
[2015-05-29 17:13:31,243][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/CancelTicket_Req.xml).
[2015-05-29 17:13:31,243][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890811242|Timestamp:20150529171331|Transaction-Type:201|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011735" isMannul="0"/>,hash=-1837612049), get digest:5d2a78879caed6975eee8058e4560a2d
[2015-05-29 17:13:31,243][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=201).
[2015-05-29 17:13:31,244][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:31,244][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171331).
[2015-05-29 17:13:31,244][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:31,244][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890811242).
[2015-05-29 17:13:31,244][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:31,244][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:31,244][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=5d2a78879caed6975eee8058e4560a2d).
[2015-05-29 17:13:31,244][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=1).
[2015-05-29 17:13:31,244][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:31,244][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:31,246][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6ttFDFcpmi1MamgAomcAmY7eTM16XgcUTsY0pFSZpEpJehhixgBbjV0gvr3aTs53QZo0umqWzCF2.
[2015-05-29 17:13:31,246][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890811242|Timestamp:20150529171331|Transaction-Type:201|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:31,247][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011735" isMannul="0"/>
[2015-05-29 17:13:31,247][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890811242|Timestamp:20150529171331|Transaction-Type:201|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011735" isMannul="0"/>,hash=-1837612049), get digest:5d2a78879caed6975eee8058e4560a2d
[2015-05-29 17:13:31,247][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/CancelTicket_Req.xml) by key(1.transtype.201).
[2015-05-29 17:13:31,247][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/lotto/CancelTicket_Req.xml
[2015-05-29 17:13:31,247][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/CancelTicket_Req.xml) by key(1.transtype.201).
[2015-05-29 17:13:31,264][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_201_1.5.0).
[2015-05-29 17:13:31,264][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_201_).
[2015-05-29 17:13:31,265][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(1_201_), found controller(com.mpos.lottery.te.gameimpl.lotto.LottoController@388c6589) and method(public void com.mpos.lottery.te.gameimpl.lotto.LottoController.cancelByTicket(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:31,274][Test worker][DEBUG][ReversalOrCancelStrategyFactory] Found ReversalStrategy(class com.mpos.lottery.te.gameimpl.lotto.sale.service.impl.LottoTicketServiceImpl) to cancel transaction(gameType=1,terminalId=111,transType=200,protocolVersion=1.5.0).
[2015-05-29 17:13:31,289][Test worker][DEBUG][DefaultBalanceService] Operator before transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=199998400, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:31,289][Test worker][DEBUG][DefaultBalanceService] Found balance strategy:com.mpos.lottery.te.merchant.service.balance.SaleBalanceStrategy@e1f8aba
[2015-05-29 17:13:31,289][Test worker][DEBUG][DefaultBalanceService] Operator after transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:31,301][Test worker][DEBUG][CommonFacadeService] Prepare to publish message to exchange[TE.200] with routing key[TE.CANCEL.200.1]: origTrans {
  id: "0115052900000000001613"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890811000
  trans_type: 200
  game_id: "GAME-111"
  game_type: 1
  total_amount: "1600"
}
cancelTrans {
  id: "0115052900000000001618"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890811000
  trans_type: 201
  game_id: "GAME-111"
  game_type: 1
  total_amount: "1600"
}

[2015-05-29 17:13:31,302][Test worker][DEBUG][CommonFacadeService] Publish message successfully
[2015-05-29 17:13:31,302][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890811242|Timestamp:20150529171331|Transaction-Type:4201|Transaction-Id:0115052900000000001618|Response-Code:200|):d3749f487e5bb52dce73fe3be13794f6
[2015-05-29 17:13:31,302][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=0): 
[2015-05-29 17:13:31,315][Test worker][DEBUG][TEPortServlet] Startup job scheduer(org.quartz.impl.StdScheduler@4d1e5820) successfully.
[2015-05-29 17:13:31,315][Test worker][WARN ][TEPortServlet] can NOT find META file:F:\project\M.Lottery\TE\TRUNK_TE\sourcecode\build\classes\main\META-INF\MANIFEST.MF
[2015-05-29 17:13:31,315][Test worker][DEBUG][TEPortServlet] Register MBean(com.mpos.lottery.te.common.jmx.TransactionTimeout@57150b9f) with name(com.mpos.lottery.te:type=TransactionTimeoutMBean) successfully.
[2015-05-29 17:13:31,316][Test worker][DEBUG][BaseTransactionalIntegrationTest] Retrieve a ApplicationContext(org.springframework.web.context.support.GenericWebApplicationContext@34f645a8: startup date [Fri May 29 17:12:38 CST 2015]; root of context hierarchy).
[2015-05-29 17:13:31,316][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:31,316][Test worker][INFO ][BaseTransactionalIntegrationTest] | TicketCancellationIntegrationTest.testCancelByTicket_CancelDelined                                                     |
[2015-05-29 17:13:31,316][Test worker][INFO ][BaseTransactionalIntegrationTest] +------------------------------------------------------------------------------------------------------------------------+
[2015-05-29 17:13:31,319][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:31,320][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/SellTicket_Req.xml).
[2015-05-29 17:13:31,321][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890811319|Timestamp:20150529171331|Transaction-Type:200|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>,hash=347999812), get digest:5318551c78b5f9edff973aa2110eba08
[2015-05-29 17:13:31,321][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=200).
[2015-05-29 17:13:31,321][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:31,321][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171331).
[2015-05-29 17:13:31,321][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:31,321][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890811319).
[2015-05-29 17:13:31,321][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:31,321][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:31,321][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=5318551c78b5f9edff973aa2110eba08).
[2015-05-29 17:13:31,321][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=1).
[2015-05-29 17:13:31,321][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:31,321][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:31,323][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6vvj1C28m6E+ybhcq2GHfncNCEmxnE1Ou0qcmJ+qutg9pDpTDScnIWI62pEFB0SGtKkhmSVtwRhObbaRtENvsKgd1vgEj9cakrUbLVxBSMJqciae7U9vnZ9gkPZ+TiqwdRl/00lYrPXIRF649XUAfZ/u7Ik8R7r7YZCfSM8Dq3Lk3E+I+8dy5FMq1JBSOx+CBYDZ3n4iWwIrRwN3i9ic9EHYxaBXmh5eMdb+eYfmG3rw7BmwCbT+5YlwzT8o+qK8+x+tCRF0yCaqlMPxlqr0c+eFde9h31TBTgqMtIWk2Ux1nb1TPJ2uDK+Ee2oZ5RgoEzb/nuc9f7RCFw4/R0o1FObopbRaJ9qpV2PI6XK6rtTl1lpL4o22ySC7lKR344K/b+MKthKWb3jb.
[2015-05-29 17:13:31,323][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890811319|Timestamp:20150529171331|Transaction-Type:200|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:31,323][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>
[2015-05-29 17:13:31,323][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890811319|Timestamp:20150529171331|Transaction-Type:200|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket multipleDraws="2" totalAmount="1600" PIN="123456"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" boostAmount="0"/></Ticket>,hash=347999812), get digest:5318551c78b5f9edff973aa2110eba08
[2015-05-29 17:13:31,323][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:31,323][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/lotto/SellTicket_Req.xml
[2015-05-29 17:13:31,323][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Req.xml) by key(1.transtype.200).
[2015-05-29 17:13:31,334][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_200_1.5.0).
[2015-05-29 17:13:31,334][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_200_).
[2015-05-29 17:13:31,334][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(1_200_), found controller(com.mpos.lottery.te.gameimpl.lotto.LottoController@388c6589) and method(public void com.mpos.lottery.te.gameimpl.lotto.LottoController.sell(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:31,341][Test worker][DEBUG][BaseJpaDao] Query future game instance(class com.mpos.lottery.te.gameimpl.lotto.draw.domain.LottoGameInstance) by(number=20090408,gameId=GAME-111, multipleDraws=2, state=1||2):1
[2015-05-29 17:13:31,345][Test worker][DEBUG][AbstractGameInstanceService] Use channel game instance time definition(IGPE-1).
[2015-05-29 17:13:31,346][Test worker][DEBUG][UUIDServiceImpl] Assemble a new ticket serial number:01110745119300011863
[2015-05-29 17:13:31,351][Test worker][DEBUG][DefaultTicketValidator] THe max allowed multi-draw of operation parameter is 10, merchant limit to 3, the smaller 3 will be used.
[2015-05-29 17:13:31,351][Test worker][DEBUG][DefaultSelectedNumberValidatorFactory] Found ticket validator(com.mpos.lottery.te.gamespec.sale.support.validator.SingleSelectedNumberValidator@55912701) for bet option:1
[2015-05-29 17:13:31,351][Test worker][DEBUG][DefaultSelectedNumberValidatorFactory] Found ticket validator(com.mpos.lottery.te.gamespec.sale.support.validator.MultipleSelectedNumberValidator@2c97de8a) for bet option:2
[2015-05-29 17:13:31,366][Test worker][DEBUG][DefaultBalanceService] Operator before transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:31,366][Test worker][DEBUG][DefaultBalanceService] Found balance strategy:com.mpos.lottery.te.merchant.service.balance.SaleBalanceStrategy@e1f8aba
[2015-05-29 17:13:31,366][Test worker][DEBUG][DefaultBalanceService] Operator after transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=199998400, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:31,376][Test worker][DEBUG][CommonFacadeService] Prepare to publish message to exchange[TE.200] with routing key[TE.200.1]: transaction {
  id: "0115052900000000001619"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890811000
  trans_type: 200
  game_id: "GAME-111"
  game_type: 1
  total_amount: "1600"
}
multi_draw: 2
total_amount: "1600"
serial_no: "aHhDkgTyIu7OH55EgjjAP23yxqTMgMFo"
game_instance {
  id: "GII-113"
}
entries {
  selected_number: "1,2,3,6,7,13"
  bet_option: 1
  total_bets: 1
  entry_amount: "100"
  input_channel: "1"
}
entries {
  selected_number: "3,11,14,16,22,25,36"
  bet_option: 2
  total_bets: 7
  entry_amount: "700"
  input_channel: "1"
}

[2015-05-29 17:13:31,376][Test worker][DEBUG][CommonFacadeService] Publish message successfully
[2015-05-29 17:13:31,376][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:31,376][Test worker][DEBUG][ProtocolSerializer] Start to serialize model(class com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket),mappingFile=xml-mapping/game/lotto/SellTicket_Res.xml
[2015-05-29 17:13:31,377][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:31,377][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/SellTicket_Res.xml).
[2015-05-29 17:13:31,377][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890811319|Timestamp:20150529171331|Transaction-Type:4200|Transaction-Id:0115052900000000001619|Response-Code:200|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011863" type="1" lastDrawNo="20090416" barcode="01cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt8eRiXxElYKctyxR2V9Li0tyrw1PG5PlB4=" validationCode="443492" multipleDraws="2" totalBets="16" totalAmount="1600"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" entryAmount="100" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" entryAmount="700" boostAmount="0"/></Ticket>):cfcfafd13e8c0f4f60caa0fff91e322b
[2015-05-29 17:13:31,378][Test worker][DEBUG][TEPortServlet] Write response to client(host1=localhost,sizeOfPack=736) succesfully.
[2015-05-29 17:13:31,378][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=200,length=736): <?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011863" type="1" lastDrawNo="20090416" barcode="01cK/u9hwZY2Rogq4k24Oeg4G3HSlAl9EbjLdf+UJJlt8eRiXxElYKctyxR2V9Li0tyrw1PG5PlB4=" validationCode="443492" multipleDraws="2" totalBets="16" totalAmount="1600"><GameDraw number="20090408" gameId="GAME-111"/><Entry selectedNumber="1,2,3,6,7,13" betOption="1" inputChannel="1" entryAmount="100" boostAmount="100"/><Entry selectedNumber="3,11,14,16,22,25,36" betOption="2" inputChannel="1" entryAmount="700" boostAmount="0"/></Ticket>
[2015-05-29 17:13:31,378][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/SellTicket_Res.xml) by key(1.transtype.4200).
[2015-05-29 17:13:31,386][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/CancelTicket_Req.xml) by key(1.transtype.201).
[2015-05-29 17:13:31,386][Test worker][DEBUG][CastorHelper] Finish marshaling input(typeclass com.mpos.lottery.te.gameimpl.lotto.sale.domain.LottoTicket, mappingFile=xml-mapping/game/lotto/CancelTicket_Req.xml).
[2015-05-29 17:13:31,387][Test worker][DEBUG][BaseServletIntegrationTest] Do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890811386|Timestamp:20150529171331|Transaction-Type:201|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011863" isMannul="0"/>,hash=-1887445718), get digest:785fc77995a7e81b227a97c81691c5ba
[2015-05-29 17:13:31,387][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Transaction-Type, value=201).
[2015-05-29 17:13:31,387][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Protocal-Version, value=1.5).
[2015-05-29 17:13:31,387][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Timestamp, value=20150529171331).
[2015-05-29 17:13:31,387][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPE-Id, value=GPE-111).
[2015-05-29 17:13:31,387][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trace-Message-Id, value=1432890811386).
[2015-05-29 17:13:31,387][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Operator-Id, value=OPERATOR-111).
[2015-05-29 17:13:31,387][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Terminal-Id, value=111).
[2015-05-29 17:13:31,387][Test worker][DEBUG][TEPortServlet] Got request header(name=X-MAC, value=785fc77995a7e81b227a97c81691c5ba).
[2015-05-29 17:13:31,387][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Game-Type-Id, value=1).
[2015-05-29 17:13:31,387][Test worker][DEBUG][TEPortServlet] Got request header(name=X-Trans-BatchNumber, value=20150529).
[2015-05-29 17:13:31,387][Test worker][DEBUG][TEPortServlet] Got request header(name=X-GPS-Location, value=40.714353,-74.005973).
[2015-05-29 17:13:31,389][Test worker][DEBUG][TEPortServlet] Got request from localhost, and the message body is:pq3FqO8HCcAnaobA+xpVnADmrnwj1vrK59BGhqvtskYFWTsa2cbe6ttFDFcpmi1MamgAomcAmY7eTM16XgcUTsY0pFSZpEpJi3fGqvdNE/nq3tSydlx09k8c4s9Kt0W4.
[2015-05-29 17:13:31,389][Test worker][DEBUG][ProtocolSerializer] Start to deserialize request context(Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890811386|Timestamp:20150529171331|Transaction-Type:201|Transaction-Id:|Response-Code:|).
[2015-05-29 17:13:31,389][Test worker][DEBUG][ProtocolSerializer] Finish decrypting cipher into original xml:<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011863" isMannul="0"/>
[2015-05-29 17:13:31,389][Test worker][DEBUG][ProtocolSerializer] Start to do MAC(key=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF) on (Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890811386|Timestamp:20150529171331|Transaction-Type:201|Transaction-Id:|Response-Code:|<?xml version="1.0" encoding="UTF-8"?>
<Ticket serialNo="01110745119300011863" isMannul="0"/>,hash=-1887445718), get digest:785fc77995a7e81b227a97c81691c5ba
[2015-05-29 17:13:31,389][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/CancelTicket_Req.xml) by key(1.transtype.201).
[2015-05-29 17:13:31,389][Test worker][DEBUG][ProtocolSerializer] Start to deserialize model: model=null,mappingFile=xml-mapping/game/lotto/CancelTicket_Req.xml
[2015-05-29 17:13:31,389][Test worker][DEBUG][MLotteryContext] find mapping file definition(xml-mapping/game/lotto/CancelTicket_Req.xml) by key(1.transtype.201).
[2015-05-29 17:13:31,403][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_201_1.5.0).
[2015-05-29 17:13:31,403][Test worker][DEBUG][RoutineRegistry] Try to lookup handler by routine key(1_201_).
[2015-05-29 17:13:31,403][Test worker][DEBUG][RoutineRegistry] Lookup controller by key(1_201_), found controller(com.mpos.lottery.te.gameimpl.lotto.LottoController@388c6589) and method(public void com.mpos.lottery.te.gameimpl.lotto.LottoController.cancelByTicket(com.mpos.lottery.te.port.Context,com.mpos.lottery.te.port.Context) throws com.mpos.lottery.te.config.exception.ApplicationException).
[2015-05-29 17:13:31,408][Test worker][DEBUG][ReversalOrCancelStrategyFactory] Found ReversalStrategy(class com.mpos.lottery.te.gameimpl.lotto.sale.service.impl.LottoTicketServiceImpl) to cancel transaction(gameType=1,terminalId=111,transType=200,protocolVersion=1.5.0).
[2015-05-29 17:13:31,422][Test worker][DEBUG][DefaultBalanceService] Operator before transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=199998400, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:31,422][Test worker][DEBUG][DefaultBalanceService] Found balance strategy:com.mpos.lottery.te.merchant.service.balance.SaleBalanceStrategy@e1f8aba
[2015-05-29 17:13:31,422][Test worker][DEBUG][DefaultBalanceService] Operator after transaction -  Operator [id=OPERATOR-111, loginName=OPERATOR-LOGIN, creditType=1, saleCreditLevel=200000000, payoutCreditLevel=1000, cashoutBalance=0, commisionBalance=0]
[2015-05-29 17:13:31,433][Test worker][DEBUG][CommonFacadeService] Prepare to publish message to exchange[TE.200] with routing key[TE.CANCEL.200.1]: origTrans {
  id: "0115052900000000001619"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890811000
  trans_type: 200
  game_id: "GAME-111"
  game_type: 1
  total_amount: "1600"
}
cancelTrans {
  id: "0115052900000000001624"
  dev_id: "111"
  operator_id: "OPERATOR-111"
  merchant_id: "111"
  create_time: 1432890811000
  trans_type: 201
  game_id: "GAME-111"
  game_type: 1
  total_amount: "1600"
}

[2015-05-29 17:13:31,433][Test worker][DEBUG][CommonFacadeService] Publish message successfully
[2015-05-29 17:13:31,433][Test worker][DEBUG][ProtocolSerializer] Finish mac(macKey=P2Bbo6+bSSR9O2Qc89f3b4oHTyE1V2gF,macString=Protocal-Version:1.5|GPE_Id:GPE-111|Terminal-Id:111|Operator-Id:OPERATOR-111|Trans-BatchNumber:20150529|TractMsg-Id:1432890811386|Timestamp:20150529171331|Transaction-Type:4201|Transaction-Id:0115052900000000001624|Response-Code:333|):ac4b6b2ef8b4302dec0888e28bc9252b
[2015-05-29 17:13:31,434][Test worker][DEBUG][BaseServletIntegrationTest] Got response(code=333,length=0): 
]]></system-out>
  <system-err><![CDATA[]]></system-err>
</testsuite>
